var e={307:(e,t,r)=>{r.d(t,{P2:()=>i,ZZ:()=>o});const a="ReplayDB",n=3,o={replays:"Replays",lists:"ReplayLists",meta:"ReplayMeta",config:"Config",directoryHandles:"DirectoryHandles"};let s=null;function i(){return new Promise((e,t)=>{if(s)return void e(s);const r=indexedDB.open(a,n);r.onupgradeneeded=e=>{const t=e.target.result,r=e.target.transaction;for(let a=e.oldVersion;a<n;a++){const e=l[a];e?.schema&&e.schema(t,r)}},r.onsuccess=()=>{s=r.result,e(s)},r.onerror=()=>t(r.error)})}const c={schema:(e,t)=>{const r=e.objectStoreNames.contains(o.replays)?t.objectStore(o.replays):e.createObjectStore(o.replays,{keyPath:"replayHash"});r.indexNames.contains("gametime")||r.createIndex("gametime","gametime",{unique:!1});const a=e.objectStoreNames.contains(o.lists)?t.objectStore(o.lists):e.createObjectStore(o.lists,{keyPath:"replayHash"});if(a.indexNames.contains("gametime")||a.createIndex("gametime","gametime",{unique:!1}),a.indexNames.contains("gameMode")||a.createIndex("gameMode","gameMode",{unique:!1}),a.indexNames.contains("playerNames")||a.createIndex("playerNames","playerNames",{multiEntry:!0}),a.indexNames.contains("commandersTeam1")||a.createIndex("commandersTeam1","commandersTeam1",{multiEntry:!0}),a.indexNames.contains("commandersTeam2")||a.createIndex("commandersTeam2","commandersTeam2",{multiEntry:!0}),!e.objectStoreNames.contains(o.meta)){const t=e.createObjectStore(o.meta,{keyPath:"replayHash"});t.createIndex("uploaded","uploaded",{unique:!1}),t.createIndex("filePath","filePath",{unique:!1}),t.createIndex("skip","skip",{unique:!1})}e.objectStoreNames.contains(o.config)||e.createObjectStore(o.config)}},d={schema:(e,t)=>{e.objectStoreNames.contains(o.directoryHandles)||e.createObjectStore(o.directoryHandles)}},l={0:c,1:{data:e=>{const t=e.stores[o.meta];if(t)for(const e of t)"boolean"==typeof e.uploaded&&(e.uploaded=e.uploaded?1:0);const r=e.stores[o.lists];if(r)for(const e of r)e.playerNames||(e.playerNames=[]);return e.__meta.dbVersion=2,e}},2:d}},395:(e,t,r)=>{r.d(t,{LB:()=>n,sf:()=>o,xV:()=>s});var a=r(307);async function n(e,t){const r=await(0,a.P2)();return new Promise((n,o)=>{const s=r.transaction(a.ZZ.directoryHandles,"readwrite").objectStore(a.ZZ.directoryHandles).put(t,e);s.onsuccess=()=>n(),s.onerror=()=>o(s.error)})}async function o(e,t="read"){if(!e)return!1;const r={mode:t};if("granted"===await(e.queryPermission?.(r)))return!0;return"granted"===await(e.requestPermission?.(r))}async function s(){if(!("showDirectoryPicker"in window))return console.warn("showDirectoryPicker is not supported in this browser."),null;try{return await window.showDirectoryPicker()}catch(e){return"AbortError"===e.name||console.error("Error picking directory:",e),null}}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};r.d(a,{A:()=>i,p:()=>s});var n=r(395);const o=new Map;async function s(e,t,r,a,s){o.clear();const i=new Set(r),c=[];try{if("showDirectoryPicker"in window){if(null==s){if(null==(s=await(0,n.xV)()))return[];await(0,n.LB)(`${s.name}_${e}`,s)}else await(0,n.sf)(s);async function l(e,t=""){for await(const[r,a]of e.entries()){const e=t?`${t}/${r}`:r;if("file"===a.kind){const t=await a.getFile();c.push({rec:{path:e,name:t.name,size:t.size,lastModified:t.lastModified},file:t})}else"directory"===a.kind&&await l(a,e)}}await l(s,s?.name)}else{const m=await new Promise(e=>{const t=document.createElement("input");t.type="file",t.webkitdirectory=!0,t.multiple=!0,t.onchange=()=>e(Array.from(t.files||[])),t.click()});for(const u of m){const f=u.webkitRelativePath||u.name;c.push({rec:{path:f,name:u.name,size:u.size,lastModified:u.lastModified},file:u})}}const d=c.filter(({rec:e})=>e.name.startsWith(t)).filter(({rec:e})=>!i.has(e.path)).sort((e,t)=>t.rec.lastModified-e.rec.lastModified).slice(0,a);for(const{rec:p,file:y}of d)o.set(p.path,y);return d.map(({rec:e})=>e)}catch(w){return console.log("Failed getting file infos: "+w.message),[]}}async function i(e){const t=o.get(e);if(!t)throw new Error(`File not found: ${e}`);return t}const c=a.p,d=a.A;export{c as getReplaysFromFolder,d as readFileContentStream};