var e={307(e,t,r){r.d(t,{P2:()=>o,ZZ:()=>a});const a={replays:"Replays",lists:"ReplayLists",meta:"ReplayMeta",config:"Config",directoryHandles:"DirectoryHandles"};let n=null;function o(){return new Promise((e,t)=>{if(n)return void e(n);const r=indexedDB.open("ReplayDB",3);r.onupgradeneeded=e=>{const t=e.target.result,r=e.target.transaction;for(let a=e.oldVersion;a<3;a++){const e=c[a];e?.schema&&e.schema(t,r)}},r.onsuccess=()=>{n=r.result,e(n)},r.onerror=()=>t(r.error)})}const s={schema:(e,t)=>{const r=e.objectStoreNames.contains(a.replays)?t.objectStore(a.replays):e.createObjectStore(a.replays,{keyPath:"replayHash"});r.indexNames.contains("gametime")||r.createIndex("gametime","gametime",{unique:!1});const n=e.objectStoreNames.contains(a.lists)?t.objectStore(a.lists):e.createObjectStore(a.lists,{keyPath:"replayHash"});if(n.indexNames.contains("gametime")||n.createIndex("gametime","gametime",{unique:!1}),n.indexNames.contains("gameMode")||n.createIndex("gameMode","gameMode",{unique:!1}),n.indexNames.contains("playerNames")||n.createIndex("playerNames","playerNames",{multiEntry:!0}),n.indexNames.contains("commandersTeam1")||n.createIndex("commandersTeam1","commandersTeam1",{multiEntry:!0}),n.indexNames.contains("commandersTeam2")||n.createIndex("commandersTeam2","commandersTeam2",{multiEntry:!0}),!e.objectStoreNames.contains(a.meta)){const t=e.createObjectStore(a.meta,{keyPath:"replayHash"});t.createIndex("uploaded","uploaded",{unique:!1}),t.createIndex("filePath","filePath",{unique:!1}),t.createIndex("skip","skip",{unique:!1})}e.objectStoreNames.contains(a.config)||e.createObjectStore(a.config)}},i={schema:(e,t)=>{e.objectStoreNames.contains(a.directoryHandles)||e.createObjectStore(a.directoryHandles)}},c={0:s,1:{data:e=>{const t=e.stores[a.meta];if(t)for(const e of t)"boolean"==typeof e.uploaded&&(e.uploaded=e.uploaded?1:0);const r=e.stores[a.lists];if(r)for(const e of r)e.playerNames||(e.playerNames=[]);return e.__meta.dbVersion=2,e}},2:i}},395(e,t,r){r.d(t,{LB:()=>n,sf:()=>o,xV:()=>s});var a=r(307);async function n(e,t){const r=await(0,a.P2)();return new Promise((n,o)=>{const s=r.transaction(a.ZZ.directoryHandles,"readwrite").objectStore(a.ZZ.directoryHandles).put(t,e);s.onsuccess=()=>n(),s.onerror=()=>o(s.error)})}async function o(e,t="read"){if(!e)return!1;const r={mode:t};if("granted"===await(e.queryPermission?.(r)))return!0;return"granted"===await(e.requestPermission?.(r))}async function s(){if(!("showDirectoryPicker"in window))throw new Error("showDirectoryPicker is not supported in this browser. File selection requires a Chromium-based browser.");try{return await window.showDirectoryPicker()}catch(e){if("AbortError"===e?.name)return null;throw new Error(`Failed to pick directory: ${e?.message??e}`)}}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};r.d(a,{A:()=>c,p:()=>s});var n=r(395);const o=new Map;async function s(e,t,r,a,s){o.clear();const c=new Set(r);try{if(null==s){if(null==(s=await(0,n.xV)()))return[];await(0,n.LB)(`${s.name}_${e}`,s)}else await(0,n.sf)(s);const r=await i(s,c,t,!0,s.name),d=r.sort((e,t)=>t.record.lastModified-e.record.lastModified).slice(0,a);for(const{record:e,file:t}of d)o.set(e.path,t);return d.map(({record:e})=>e)}catch(e){return console.log("Failed getting file infos: "+e.message),[]}}async function i(e,t,r,a,n){const o=[];for await(const[s,c]of e.entries()){const e=n?`${n}/${s}`:s;if("directory"!==c.kind){if("file"===c.kind){if(!s.startsWith(r))continue;if(t.has(e))continue;const a=await c.getFile();o.push({record:{path:e,name:a.name,size:a.size,lastModified:a.lastModified},file:a})}}else if(a){const n=await i(c,t,r,a,e);o.push(...n)}}return o}async function c(e){const t=o.get(e);if(!t)throw new Error(`File not found: ${e}`);return t}const d=a.p,m=a.A;export{d as getReplaysFromFolder,m as readFileContentStream};
//# sourceMappingURL=pick-replays.js.map