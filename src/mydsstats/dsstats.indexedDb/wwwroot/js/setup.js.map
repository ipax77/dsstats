{"version":3,"file":"setup.js","mappings":"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","sources":["webpack://dsstats10/webpack/bootstrap","webpack://dsstats10/webpack/runtime/global","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/errors.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/isSharedArrayBuffer.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/valueToKeyWithoutThrowing.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/valueToKey.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/cmp.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBKeyRange.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/extractKey.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/cloneValueForInsertion.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBCursor.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBCursorWithValue.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/FakeEventTarget.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBRequest.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/FakeDOMStringList.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/valueToKeyRange.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/getKeyPath.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/isPotentiallyValidKeyRange.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/enforceRange.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/extractGetAllOptions.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBIndex.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/canInjectKey.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBRecord.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/binarySearchTree.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/RecordStore.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/Index.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/validateKeyPath.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBObjectStore.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/FakeEvent.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/scheduling.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBTransaction.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/KeyGenerator.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/ObjectStore.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/closeConnection.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBDatabase.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBOpenDBRequest.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBVersionChangeEvent.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/intersection.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/Database.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/lib/validateRequiredArguments.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/FDBFactory.js","webpack://dsstats10/./node_modules/fake-indexeddb/build/esm/fakeIndexedDB.js","webpack://dsstats10/./node_modules/fake-indexeddb/auto/index.mjs","webpack://dsstats10/./Client/setup.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","const messages = {\n  AbortError: \"A request was aborted, for example through a call to IDBTransaction.abort.\",\n  ConstraintError: \"A mutation operation in the transaction failed because a constraint was not satisfied. For example, an object such as an object store or index already exists and a request attempted to create a new one.\",\n  DataCloneError: \"The data being stored could not be cloned by the internal structured cloning algorithm.\",\n  DataError: \"Data provided to an operation does not meet requirements.\",\n  InvalidAccessError: \"An invalid operation was performed on an object. For example transaction creation attempt was made, but an empty scope was provided.\",\n  InvalidStateError: \"An operation was called on an object on which it is not allowed or at a time when it is not allowed. Also occurs if a request is made on a source object that has been deleted or removed. Use TransactionInactiveError or ReadOnlyError when possible, as they are more specific variations of InvalidStateError.\",\n  NotFoundError: \"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.\",\n  ReadOnlyError: 'The mutating operation was attempted in a \"readonly\" transaction.',\n  TransactionInactiveError: \"A request was placed against a transaction which is currently not active, or which is finished.\",\n  SyntaxError: \"The keypath argument contains an invalid key path\",\n  VersionError: \"An attempt was made to open a database using a lower version than the existing version.\"\n};\n\n// Cannot set an error code on an error using the normal setter;\n// this leads to \"Cannot set property code of  which has only a getter\"\nconst setErrorCode = (error, value) => {\n  Object.defineProperty(error, 'code', {\n    value,\n    writable: false,\n    enumerable: true,\n    configurable: false\n  });\n};\nexport class AbortError extends DOMException {\n  constructor(message = messages.AbortError) {\n    super(message, \"AbortError\");\n  }\n}\nexport class ConstraintError extends DOMException {\n  constructor(message = messages.ConstraintError) {\n    super(message, \"ConstraintError\");\n  }\n}\nexport class DataCloneError extends DOMException {\n  constructor(message = messages.DataCloneError) {\n    super(message, \"DataCloneError\");\n  }\n}\nexport class DataError extends DOMException {\n  constructor(message = messages.DataError) {\n    super(message, \"DataError\");\n    setErrorCode(this, 0);\n  }\n}\nexport class InvalidAccessError extends DOMException {\n  constructor(message = messages.InvalidAccessError) {\n    super(message, \"InvalidAccessError\");\n  }\n}\nexport class InvalidStateError extends DOMException {\n  constructor(message = messages.InvalidStateError) {\n    super(message, \"InvalidStateError\");\n    setErrorCode(this, 11);\n  }\n}\nexport class NotFoundError extends DOMException {\n  constructor(message = messages.NotFoundError) {\n    super(message, \"NotFoundError\");\n  }\n}\nexport class ReadOnlyError extends DOMException {\n  constructor(message = messages.ReadOnlyError) {\n    super(message, \"ReadOnlyError\");\n  }\n}\nexport class SyntaxError extends DOMException {\n  constructor(message = messages.VersionError) {\n    super(message, \"SyntaxError\");\n    setErrorCode(this, 12);\n  }\n}\nexport class TransactionInactiveError extends DOMException {\n  constructor(message = messages.TransactionInactiveError) {\n    super(message, \"TransactionInactiveError\");\n    setErrorCode(this, 0);\n  }\n}\nexport class VersionError extends DOMException {\n  constructor(message = messages.VersionError) {\n    super(message, \"VersionError\");\n  }\n}","export default function isSharedArrayBuffer(input) {\n  return typeof SharedArrayBuffer !== \"undefined\" && input instanceof SharedArrayBuffer;\n}","import isSharedArrayBuffer from \"./isSharedArrayBuffer.js\";\nexport const INVALID_TYPE = Symbol(\"INVALID_TYPE\");\nexport const INVALID_VALUE = Symbol(\"INVALID_VALUE\");\n\n// https://w3c.github.io/IndexedDB/#convert-value-to-key\n// The \"without exceptions\" version is because we typically want to throw exceptions (DataError) but not for\n// the \"is potentially valid key range\" routine.\nconst valueToKeyWithoutThrowing = (input, seen) => {\n  if (typeof input === \"number\") {\n    if (isNaN(input)) {\n      // If input is NaN then return \"invalid value\".\n      return INVALID_VALUE;\n    }\n    return input;\n  } else if (Object.prototype.toString.call(input) === \"[object Date]\") {\n    const ms = input.valueOf();\n    if (isNaN(ms)) {\n      // If ms is NaN then return \"invalid value\".\n      return INVALID_VALUE;\n    }\n    return new Date(ms);\n  } else if (typeof input === \"string\") {\n    return input;\n  } else if (\n  // https://w3c.github.io/IndexedDB/#ref-for-dfn-buffer-source-type\n  input instanceof ArrayBuffer || isSharedArrayBuffer(input) || typeof ArrayBuffer !== \"undefined\" && ArrayBuffer.isView && ArrayBuffer.isView(input)) {\n    // We can't consistently test detachedness, so instead we check if byteLength === 0\n    // This isn't foolproof, but there's no perfect way to detect if Uint8Arrays or\n    // SharedArrayBuffers are detached\n    if (\"detached\" in input ? input.detached : input.byteLength === 0) {\n      // If input is detached then return \"invalid value\".\n      return INVALID_VALUE;\n    }\n    let arrayBuffer;\n    let offset = 0;\n    let length = 0;\n    if (input instanceof ArrayBuffer || isSharedArrayBuffer(input)) {\n      arrayBuffer = input;\n      length = input.byteLength;\n    } else {\n      arrayBuffer = input.buffer;\n      offset = input.byteOffset;\n      length = input.byteLength;\n    }\n    return arrayBuffer.slice(offset, offset + length);\n  } else if (Array.isArray(input)) {\n    if (seen === undefined) {\n      seen = new Set();\n    } else if (seen.has(input)) {\n      // If seen contains input, then return \"invalid value\".\n      return INVALID_VALUE;\n    }\n    seen.add(input);\n\n    // This algorithm is tricky to account for `bindings-inject-keys-bypass.any.js`. We _should_ return early when\n    // encountering an invalid key/type, but we also need to avoid triggering `Object.prototype['10']` if it's been\n    // overridden. One simple way to do this (and which doesn't rely on sparse arrays or other exotic solutions that\n    // could cause de-opts) is to use `Array.from()` with a mapper function, which does not trigger the prototype\n    // setter [1]. It does prevent an early return, but we can at least short-circuit inside the mapper function\n    // (which isn't strictly necessary to pass the WPTs, but is closer to the spec).\n    // [1]: See https://tc39.es/ecma262/multipage/indexed-collections.html#sec-array.from, specifically\n    //      the chain CreateDataPropertyOrThrow -> CreateDataProperty -> DefineOwnProperty which defines\n    //      the array element as an \"own\" property.\n    let hasInvalid = false;\n    const keys = Array.from({\n      length: input.length\n    }, (_, i) => {\n      if (hasInvalid) {\n        return;\n      }\n      const hop = Object.hasOwn(input, i);\n      if (!hop) {\n        // If hop is false, return \"invalid value\".\n        hasInvalid = true;\n        return;\n      }\n      const entry = input[i];\n      const key = valueToKeyWithoutThrowing(entry, seen);\n      // If key is \"invalid value\" or \"invalid type\" abort these steps and return \"invalid value\".\n      if (key === INVALID_VALUE || key === INVALID_TYPE) {\n        hasInvalid = true;\n        return;\n      }\n      return key;\n    });\n    if (hasInvalid) {\n      return INVALID_VALUE;\n    }\n    return keys;\n  } else {\n    // Otherwise: Return \"invalid type\".\n    return INVALID_TYPE;\n  }\n};\nexport default valueToKeyWithoutThrowing;","import { DataError } from \"./errors.js\";\nimport valueToKeyWithoutThrowing, { INVALID_TYPE, INVALID_VALUE } from \"./valueToKeyWithoutThrowing.js\";\n// https://w3c.github.io/IndexedDB/#convert-value-to-key\n// Plus throwing a DataError for invalid value/invalid key, which is commonly done\n// in lots of IndexedDB operations\nconst valueToKey = (input, seen) => {\n  const result = valueToKeyWithoutThrowing(input, seen);\n  if (result === INVALID_VALUE || result === INVALID_TYPE) {\n    // If key is \"invalid value\" or \"invalid type\", throw a \"DataError\" DOMException\n    throw new DataError();\n  }\n  return result;\n};\nexport default valueToKey;","import { DataError } from \"./errors.js\";\nimport valueToKey from \"./valueToKey.js\";\nconst getType = x => {\n  if (typeof x === \"number\") {\n    return \"Number\";\n  }\n  if (Object.prototype.toString.call(x) === \"[object Date]\") {\n    return \"Date\";\n  }\n  if (Array.isArray(x)) {\n    return \"Array\";\n  }\n  if (typeof x === \"string\") {\n    return \"String\";\n  }\n  if (x instanceof ArrayBuffer) {\n    return \"Binary\";\n  }\n  throw new DataError();\n};\n\n// https://w3c.github.io/IndexedDB/#compare-two-keys\nconst cmp = (first, second) => {\n  if (second === undefined) {\n    throw new TypeError();\n  }\n  first = valueToKey(first);\n  second = valueToKey(second);\n  const t1 = getType(first);\n  const t2 = getType(second);\n  if (t1 !== t2) {\n    if (t1 === \"Array\") {\n      return 1;\n    }\n    if (t1 === \"Binary\" && (t2 === \"String\" || t2 === \"Date\" || t2 === \"Number\")) {\n      return 1;\n    }\n    if (t1 === \"String\" && (t2 === \"Date\" || t2 === \"Number\")) {\n      return 1;\n    }\n    if (t1 === \"Date\" && t2 === \"Number\") {\n      return 1;\n    }\n    return -1;\n  }\n  if (t1 === \"Binary\") {\n    first = new Uint8Array(first);\n    second = new Uint8Array(second);\n  }\n  if (t1 === \"Array\" || t1 === \"Binary\") {\n    const length = Math.min(first.length, second.length);\n    for (let i = 0; i < length; i++) {\n      const result = cmp(first[i], second[i]);\n      if (result !== 0) {\n        return result;\n      }\n    }\n    if (first.length > second.length) {\n      return 1;\n    }\n    if (first.length < second.length) {\n      return -1;\n    }\n    return 0;\n  }\n  if (t1 === \"Date\") {\n    if (first.getTime() === second.getTime()) {\n      return 0;\n    }\n  } else {\n    if (first === second) {\n      return 0;\n    }\n  }\n  return first > second ? 1 : -1;\n};\nexport default cmp;","import cmp from \"./lib/cmp.js\";\nimport { DataError } from \"./lib/errors.js\";\nimport valueToKey from \"./lib/valueToKey.js\";\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#range-concept\nclass FDBKeyRange {\n  static only(value) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    value = valueToKey(value);\n    return new FDBKeyRange(value, value, false, false);\n  }\n  static lowerBound(lower, open = false) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    lower = valueToKey(lower);\n    return new FDBKeyRange(lower, undefined, open, true);\n  }\n  static upperBound(upper, open = false) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    upper = valueToKey(upper);\n    return new FDBKeyRange(undefined, upper, true, open);\n  }\n  static bound(lower, upper, lowerOpen = false, upperOpen = false) {\n    if (arguments.length < 2) {\n      throw new TypeError();\n    }\n    const cmpResult = cmp(lower, upper);\n    if (cmpResult === 1 || cmpResult === 0 && (lowerOpen || upperOpen)) {\n      throw new DataError();\n    }\n    lower = valueToKey(lower);\n    upper = valueToKey(upper);\n    return new FDBKeyRange(lower, upper, lowerOpen, upperOpen);\n  }\n  constructor(lower, upper, lowerOpen, upperOpen) {\n    this.lower = lower;\n    this.upper = upper;\n    this.lowerOpen = lowerOpen;\n    this.upperOpen = upperOpen;\n  }\n\n  // https://w3c.github.io/IndexedDB/#dom-idbkeyrange-includes\n  includes(key) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    key = valueToKey(key);\n    if (this.lower !== undefined) {\n      const cmpResult = cmp(this.lower, key);\n      if (cmpResult === 1 || cmpResult === 0 && this.lowerOpen) {\n        return false;\n      }\n    }\n    if (this.upper !== undefined) {\n      const cmpResult = cmp(this.upper, key);\n      if (cmpResult === -1 || cmpResult === 0 && this.upperOpen) {\n        return false;\n      }\n    }\n    return true;\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBKeyRange\";\n  }\n}\nexport default FDBKeyRange;","import valueToKey from \"./valueToKey.js\";\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-extracting-a-key-from-a-value-using-a-key-path\nconst extractKey = (keyPath, value) => {\n  if (Array.isArray(keyPath)) {\n    const result = [];\n    for (let item of keyPath) {\n      // This doesn't make sense to me based on the spec, but it is needed to pass the W3C KeyPath tests (see same\n      // comment in validateKeyPath)\n      if (item !== undefined && item !== null && typeof item !== \"string\" && item.toString) {\n        item = item.toString();\n      }\n      const key = extractKey(item, value).key;\n      result.push(valueToKey(key));\n    }\n    return {\n      type: \"found\",\n      key: result\n    };\n  }\n  if (keyPath === \"\") {\n    return {\n      type: \"found\",\n      key: value\n    };\n  }\n  let remainingKeyPath = keyPath;\n  let object = value;\n  while (remainingKeyPath !== null) {\n    let identifier;\n    const i = remainingKeyPath.indexOf(\".\");\n    if (i >= 0) {\n      identifier = remainingKeyPath.slice(0, i);\n      remainingKeyPath = remainingKeyPath.slice(i + 1);\n    } else {\n      identifier = remainingKeyPath;\n      remainingKeyPath = null;\n    }\n\n    // special cases: https://w3c.github.io/IndexedDB/#evaluate-a-key-path-on-a-value\n    const isSpecialIdentifier = identifier === \"length\" && (typeof object === \"string\" || Array.isArray(object)) || (identifier === \"size\" || identifier === \"type\") && typeof Blob !== \"undefined\" && object instanceof Blob || (identifier === \"name\" || identifier === \"lastModified\") && typeof File !== \"undefined\" && object instanceof File;\n    if (!isSpecialIdentifier && (typeof object !== \"object\" || object === null || !Object.hasOwn(object, identifier))) {\n      return {\n        type: \"notFound\"\n      };\n    }\n    object = object[identifier];\n  }\n  return {\n    type: \"found\",\n    key: object\n  };\n};\nexport default extractKey;","// https://w3c.github.io/IndexedDB/#clone-value\n// Note that we only need to call this during insertions because the spec does not expect any cloning during retrieval,\n// only `StructuredDeserialize()` (e.g. see [1]). This is also only required for values, not keys, since keys do not\n// require cloning during insertion (e.g. see [2]).\n// [1]: https://w3c.github.io/IndexedDB/#retrieve-multiple-items-from-an-object-store\n// [2]: https://w3c.github.io/IndexedDB/#add-or-put\nexport function cloneValueForInsertion(value, transaction) {\n  // Assert: transactions state is active.\n  if (transaction._state !== \"active\") {\n    throw new Error(\"Assert: transaction state is active\");\n  }\n\n  // Set transactions state to inactive.\n  transaction._state = \"inactive\";\n  try {\n    // Let serialized be StructuredSerializeForStorage(value).\n    // Let clone be ? StructuredDeserialize(serialized, targetRealm).\n    // Return clone.\n    return structuredClone(value);\n  } finally {\n    // Set transactions state to active.\n    transaction._state = \"active\";\n  }\n}","import FDBKeyRange from \"./FDBKeyRange.js\";\nimport FDBObjectStore from \"./FDBObjectStore.js\";\nimport cmp from \"./lib/cmp.js\";\nimport { DataError, InvalidAccessError, InvalidStateError, ReadOnlyError, TransactionInactiveError } from \"./lib/errors.js\";\nimport extractKey from \"./lib/extractKey.js\";\nimport valueToKey from \"./lib/valueToKey.js\";\nimport { cloneValueForInsertion } from \"./lib/cloneValueForInsertion.js\";\nconst getEffectiveObjectStore = cursor => {\n  if (cursor.source instanceof FDBObjectStore) {\n    return cursor.source;\n  }\n  return cursor.source.objectStore;\n};\n\n// This takes a key range, a list of lower bounds, and a list of upper bounds and combines them all into a single key\n// range. It does not handle gt/gte distinctions, because it doesn't really matter much anyway, since for next/prev\n// cursor iteration it'd also have to look at values to be precise, which would be complicated. This should get us 99%\n// of the way there.\nconst makeKeyRange = (range, lowers, uppers) => {\n  // Start with bounds from range\n  let lower = range !== undefined ? range.lower : undefined;\n  let upper = range !== undefined ? range.upper : undefined;\n\n  // Augment with values from lowers and uppers\n  for (const lowerTemp of lowers) {\n    if (lowerTemp === undefined) {\n      continue;\n    }\n    if (lower === undefined || cmp(lower, lowerTemp) === 1) {\n      lower = lowerTemp;\n    }\n  }\n  for (const upperTemp of uppers) {\n    if (upperTemp === undefined) {\n      continue;\n    }\n    if (upper === undefined || cmp(upper, upperTemp) === -1) {\n      upper = upperTemp;\n    }\n  }\n  if (lower !== undefined && upper !== undefined) {\n    return FDBKeyRange.bound(lower, upper);\n  }\n  if (lower !== undefined) {\n    return FDBKeyRange.lowerBound(lower);\n  }\n  if (upper !== undefined) {\n    return FDBKeyRange.upperBound(upper);\n  }\n};\n\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#cursor\nclass FDBCursor {\n  _gotValue = false;\n  _position = undefined; // Key of previously returned record\n  _objectStorePosition = undefined;\n  _keyOnly = false;\n  _key = undefined;\n  _primaryKey = undefined;\n  constructor(source, range, direction = \"next\", request, keyOnly = false) {\n    this._range = range;\n    this._source = source;\n    this._direction = direction;\n    this._request = request;\n    this._keyOnly = keyOnly;\n  }\n\n  // Read only properties\n  get source() {\n    return this._source;\n  }\n  set source(val) {\n    /* For babel */\n  }\n  get request() {\n    return this._request;\n  }\n  set request(val) {\n    /* For babel */\n  }\n  get direction() {\n    return this._direction;\n  }\n  set direction(val) {\n    /* For babel */\n  }\n  get key() {\n    return this._key;\n  }\n  set key(val) {\n    /* For babel */\n  }\n  get primaryKey() {\n    return this._primaryKey;\n  }\n  set primaryKey(val) {\n    /* For babel */\n  }\n\n  // https://w3c.github.io/IndexedDB/#iterate-a-cursor\n  _iterate(key, primaryKey) {\n    const sourceIsObjectStore = this.source instanceof FDBObjectStore;\n\n    // Can't use sourceIsObjectStore because TypeScript\n    const records = this.source instanceof FDBObjectStore ? this.source._rawObjectStore.records : this.source._rawIndex.records;\n    let foundRecord;\n    if (this.direction === \"next\") {\n      const range = makeKeyRange(this._range, [key, this._position], []);\n      for (const record of records.values(range)) {\n        const cmpResultKey = key !== undefined ? cmp(record.key, key) : undefined;\n        const cmpResultPosition = this._position !== undefined ? cmp(record.key, this._position) : undefined;\n        if (key !== undefined) {\n          if (cmpResultKey === -1) {\n            continue;\n          }\n        }\n        if (primaryKey !== undefined) {\n          if (cmpResultKey === -1) {\n            continue;\n          }\n          const cmpResultPrimaryKey = cmp(record.value, primaryKey);\n          if (cmpResultKey === 0 && cmpResultPrimaryKey === -1) {\n            continue;\n          }\n        }\n        if (this._position !== undefined && sourceIsObjectStore) {\n          if (cmpResultPosition !== 1) {\n            continue;\n          }\n        }\n        if (this._position !== undefined && !sourceIsObjectStore) {\n          if (cmpResultPosition === -1) {\n            continue;\n          }\n          if (cmpResultPosition === 0 && cmp(record.value, this._objectStorePosition) !== 1) {\n            continue;\n          }\n        }\n        if (this._range !== undefined) {\n          if (!this._range.includes(record.key)) {\n            continue;\n          }\n        }\n        foundRecord = record;\n        break;\n      }\n    } else if (this.direction === \"nextunique\") {\n      // This could be done without iterating, if the range was defined slightly better (to handle gt/gte cases).\n      // But the performance difference should be small, and that wouldn't work anyway for directions where the\n      // value needs to be used (like next and prev).\n      const range = makeKeyRange(this._range, [key, this._position], []);\n      for (const record of records.values(range)) {\n        if (key !== undefined) {\n          if (cmp(record.key, key) === -1) {\n            continue;\n          }\n        }\n        if (this._position !== undefined) {\n          if (cmp(record.key, this._position) !== 1) {\n            continue;\n          }\n        }\n        if (this._range !== undefined) {\n          if (!this._range.includes(record.key)) {\n            continue;\n          }\n        }\n        foundRecord = record;\n        break;\n      }\n    } else if (this.direction === \"prev\") {\n      const range = makeKeyRange(this._range, [], [key, this._position]);\n      for (const record of records.values(range, \"prev\")) {\n        const cmpResultKey = key !== undefined ? cmp(record.key, key) : undefined;\n        const cmpResultPosition = this._position !== undefined ? cmp(record.key, this._position) : undefined;\n        if (key !== undefined) {\n          if (cmpResultKey === 1) {\n            continue;\n          }\n        }\n        if (primaryKey !== undefined) {\n          if (cmpResultKey === 1) {\n            continue;\n          }\n          const cmpResultPrimaryKey = cmp(record.value, primaryKey);\n          if (cmpResultKey === 0 && cmpResultPrimaryKey === 1) {\n            continue;\n          }\n        }\n        if (this._position !== undefined && sourceIsObjectStore) {\n          if (cmpResultPosition !== -1) {\n            continue;\n          }\n        }\n        if (this._position !== undefined && !sourceIsObjectStore) {\n          if (cmpResultPosition === 1) {\n            continue;\n          }\n          if (cmpResultPosition === 0 && cmp(record.value, this._objectStorePosition) !== -1) {\n            continue;\n          }\n        }\n        if (this._range !== undefined) {\n          if (!this._range.includes(record.key)) {\n            continue;\n          }\n        }\n        foundRecord = record;\n        break;\n      }\n    } else if (this.direction === \"prevunique\") {\n      let tempRecord;\n      const range = makeKeyRange(this._range, [], [key, this._position]);\n      for (const record of records.values(range, \"prev\")) {\n        if (key !== undefined) {\n          if (cmp(record.key, key) === 1) {\n            continue;\n          }\n        }\n        if (this._position !== undefined) {\n          if (cmp(record.key, this._position) !== -1) {\n            continue;\n          }\n        }\n        if (this._range !== undefined) {\n          if (!this._range.includes(record.key)) {\n            continue;\n          }\n        }\n        tempRecord = record;\n        break;\n      }\n      if (tempRecord) {\n        foundRecord = records.get(tempRecord.key);\n      }\n    }\n    let result;\n    if (!foundRecord) {\n      this._key = undefined;\n      if (!sourceIsObjectStore) {\n        this._objectStorePosition = undefined;\n      }\n\n      // \"this instanceof FDBCursorWithValue\" would be better and not require (this as any), but causes runtime\n      // error due to circular dependency.\n      if (!this._keyOnly && this.toString() === \"[object IDBCursorWithValue]\") {\n        this.value = undefined;\n      }\n      result = null;\n    } else {\n      this._position = foundRecord.key;\n      if (!sourceIsObjectStore) {\n        this._objectStorePosition = foundRecord.value;\n      }\n      this._key = foundRecord.key;\n      if (sourceIsObjectStore) {\n        this._primaryKey = structuredClone(foundRecord.key);\n        if (!this._keyOnly && this.toString() === \"[object IDBCursorWithValue]\") {\n          this.value = structuredClone(foundRecord.value);\n        }\n      } else {\n        this._primaryKey = structuredClone(foundRecord.value);\n        if (!this._keyOnly && this.toString() === \"[object IDBCursorWithValue]\") {\n          if (this.source instanceof FDBObjectStore) {\n            // Can't use sourceIsObjectStore because TypeScript\n            throw new Error(\"This should never happen\");\n          }\n          const value = this.source.objectStore._rawObjectStore.getValue(foundRecord.value);\n          this.value = structuredClone(value);\n        }\n      }\n      this._gotValue = true;\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      result = this;\n    }\n    return result;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBCursor-update-IDBRequest-any-value\n  update(value) {\n    if (value === undefined) {\n      throw new TypeError();\n    }\n    const effectiveObjectStore = getEffectiveObjectStore(this);\n    const effectiveKey = Object.hasOwn(this.source, \"_rawIndex\") ? this.primaryKey : this._position;\n    const transaction = effectiveObjectStore.transaction;\n    if (transaction._state !== \"active\") {\n      throw new TransactionInactiveError();\n    }\n    if (transaction.mode === \"readonly\") {\n      throw new ReadOnlyError();\n    }\n    if (effectiveObjectStore._rawObjectStore.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!(this.source instanceof FDBObjectStore) && this.source._rawIndex.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!this._gotValue || !Object.hasOwn(this, \"value\")) {\n      throw new InvalidStateError();\n    }\n    const clone = cloneValueForInsertion(value, transaction);\n    if (effectiveObjectStore.keyPath !== null) {\n      let tempKey;\n      try {\n        tempKey = extractKey(effectiveObjectStore.keyPath, clone).key;\n      } catch (err) {\n        /* Handled immediately below */\n      }\n      if (cmp(tempKey, effectiveKey) !== 0) {\n        throw new DataError();\n      }\n    }\n    const record = {\n      key: effectiveKey,\n      value: clone\n    };\n    return transaction._execRequestAsync({\n      operation: effectiveObjectStore._rawObjectStore.storeRecord.bind(effectiveObjectStore._rawObjectStore, record, false, transaction._rollbackLog),\n      source: this\n    });\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBCursor-advance-void-unsigned-long-count\n  advance(count) {\n    if (!Number.isInteger(count) || count <= 0) {\n      throw new TypeError();\n    }\n    const effectiveObjectStore = getEffectiveObjectStore(this);\n    const transaction = effectiveObjectStore.transaction;\n    if (transaction._state !== \"active\") {\n      throw new TransactionInactiveError();\n    }\n    if (effectiveObjectStore._rawObjectStore.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!(this.source instanceof FDBObjectStore) && this.source._rawIndex.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!this._gotValue) {\n      throw new InvalidStateError();\n    }\n    if (this._request) {\n      this._request.readyState = \"pending\";\n    }\n    transaction._execRequestAsync({\n      operation: () => {\n        let result;\n        for (let i = 0; i < count; i++) {\n          result = this._iterate();\n\n          // Not sure why this is needed\n          if (!result) {\n            break;\n          }\n        }\n        return result;\n      },\n      request: this._request,\n      source: this.source\n    });\n    this._gotValue = false;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBCursor-continue-void-any-key\n  continue(key) {\n    const effectiveObjectStore = getEffectiveObjectStore(this);\n    const transaction = effectiveObjectStore.transaction;\n    if (transaction._state !== \"active\") {\n      throw new TransactionInactiveError();\n    }\n    if (effectiveObjectStore._rawObjectStore.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!(this.source instanceof FDBObjectStore) && this.source._rawIndex.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!this._gotValue) {\n      throw new InvalidStateError();\n    }\n    if (key !== undefined) {\n      key = valueToKey(key);\n      const cmpResult = cmp(key, this._position);\n      if (cmpResult <= 0 && (this.direction === \"next\" || this.direction === \"nextunique\") || cmpResult >= 0 && (this.direction === \"prev\" || this.direction === \"prevunique\")) {\n        throw new DataError();\n      }\n    }\n    if (this._request) {\n      this._request.readyState = \"pending\";\n    }\n    transaction._execRequestAsync({\n      operation: this._iterate.bind(this, key),\n      request: this._request,\n      source: this.source\n    });\n    this._gotValue = false;\n  }\n\n  // hthttps://w3c.github.io/IndexedDB/#dom-idbcursor-continueprimarykey\n  continuePrimaryKey(key, primaryKey) {\n    const effectiveObjectStore = getEffectiveObjectStore(this);\n    const transaction = effectiveObjectStore.transaction;\n    if (transaction._state !== \"active\") {\n      throw new TransactionInactiveError();\n    }\n    if (effectiveObjectStore._rawObjectStore.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!(this.source instanceof FDBObjectStore) && this.source._rawIndex.deleted) {\n      throw new InvalidStateError();\n    }\n    if (this.source instanceof FDBObjectStore || this.direction !== \"next\" && this.direction !== \"prev\") {\n      throw new InvalidAccessError();\n    }\n    if (!this._gotValue) {\n      throw new InvalidStateError();\n    }\n\n    // Not sure about this\n    if (key === undefined || primaryKey === undefined) {\n      throw new DataError();\n    }\n    key = valueToKey(key);\n    const cmpResult = cmp(key, this._position);\n    if (cmpResult === -1 && this.direction === \"next\" || cmpResult === 1 && this.direction === \"prev\") {\n      throw new DataError();\n    }\n    const cmpResult2 = cmp(primaryKey, this._objectStorePosition);\n    if (cmpResult === 0) {\n      if (cmpResult2 <= 0 && this.direction === \"next\" || cmpResult2 >= 0 && this.direction === \"prev\") {\n        throw new DataError();\n      }\n    }\n    if (this._request) {\n      this._request.readyState = \"pending\";\n    }\n    transaction._execRequestAsync({\n      operation: this._iterate.bind(this, key, primaryKey),\n      request: this._request,\n      source: this.source\n    });\n    this._gotValue = false;\n  }\n  delete() {\n    const effectiveObjectStore = getEffectiveObjectStore(this);\n    const effectiveKey = Object.hasOwn(this.source, \"_rawIndex\") ? this.primaryKey : this._position;\n    const transaction = effectiveObjectStore.transaction;\n    if (transaction._state !== \"active\") {\n      throw new TransactionInactiveError();\n    }\n    if (transaction.mode === \"readonly\") {\n      throw new ReadOnlyError();\n    }\n    if (effectiveObjectStore._rawObjectStore.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!(this.source instanceof FDBObjectStore) && this.source._rawIndex.deleted) {\n      throw new InvalidStateError();\n    }\n    if (!this._gotValue || !Object.hasOwn(this, \"value\")) {\n      throw new InvalidStateError();\n    }\n    return transaction._execRequestAsync({\n      operation: effectiveObjectStore._rawObjectStore.deleteRecord.bind(effectiveObjectStore._rawObjectStore, effectiveKey, transaction._rollbackLog),\n      source: this\n    });\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBCursor\";\n  }\n}\nexport default FDBCursor;","import FDBCursor from \"./FDBCursor.js\";\nclass FDBCursorWithValue extends FDBCursor {\n  value = undefined;\n  constructor(source, range, direction, request) {\n    super(source, range, direction, request);\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBCursorWithValue\";\n  }\n}\nexport default FDBCursorWithValue;","import { InvalidStateError } from \"./errors.js\";\nconst stopped = (event, listener) => {\n  return event.immediatePropagationStopped || event.eventPhase === event.CAPTURING_PHASE && listener.capture === false || event.eventPhase === event.BUBBLING_PHASE && listener.capture === true;\n};\n\n// http://www.w3.org/TR/dom/#concept-event-listener-invoke\nconst invokeEventListeners = (event, obj) => {\n  event.currentTarget = obj;\n  const errors = [];\n  const invoke = callbackOrObject => {\n    try {\n      const callback = typeof callbackOrObject === \"function\" ? callbackOrObject : callbackOrObject.handleEvent;\n      // @ts-expect-error EventCallback's types are not quite right here\n      callback.call(event.currentTarget, event);\n    } catch (err) {\n      errors.push(err);\n    }\n  };\n\n  // The callback might cause obj.listeners to mutate as we traverse it.\n  // Take a copy of the array so that nothing sneaks in and we don't lose\n  // our place.\n  for (const listener of obj.listeners.slice()) {\n    if (event.type !== listener.type || stopped(event, listener)) {\n      continue;\n    }\n    invoke(listener.callback);\n  }\n  const typeToProp = {\n    abort: \"onabort\",\n    blocked: \"onblocked\",\n    close: \"onclose\",\n    complete: \"oncomplete\",\n    error: \"onerror\",\n    success: \"onsuccess\",\n    upgradeneeded: \"onupgradeneeded\",\n    versionchange: \"onversionchange\"\n  };\n  const prop = typeToProp[event.type];\n  if (prop === undefined) {\n    throw new Error(`Unknown event type: \"${event.type}\"`);\n  }\n  const callback = event.currentTarget[prop];\n  if (callback) {\n    const listener = {\n      callback,\n      capture: false,\n      type: event.type\n    };\n    if (!stopped(event, listener)) {\n      invoke(listener.callback);\n    }\n  }\n\n  // we want to execute all listeners before deciding if we want to throw, because there could be an error thrown by\n  // the first listener, but the second should still be invoked\n  if (errors.length) {\n    throw new AggregateError(errors);\n  }\n};\nclass FakeEventTarget {\n  listeners = [];\n\n  // These will be overridden in individual subclasses and made not readonly\n\n  addEventListener(type, callback, options) {\n    const capture = !!(typeof options === \"object\" && options ? options.capture : options);\n    this.listeners.push({\n      callback,\n      capture,\n      type\n    });\n  }\n  removeEventListener(type, callback, options) {\n    const capture = !!(typeof options === \"object\" && options ? options.capture : options);\n    const i = this.listeners.findIndex(listener => {\n      return listener.type === type && listener.callback === callback && listener.capture === capture;\n    });\n    this.listeners.splice(i, 1);\n  }\n\n  // http://www.w3.org/TR/dom/#dispatching-events\n  dispatchEvent(event) {\n    if (event.dispatched || !event.initialized) {\n      throw new InvalidStateError(\"The object is in an invalid state.\");\n    }\n    event.isTrusted = false;\n    event.dispatched = true;\n    event.target = this;\n    // NOT SURE WHEN THIS SHOULD BE SET        event.eventPath = [];\n\n    event.eventPhase = event.CAPTURING_PHASE;\n    for (const obj of event.eventPath) {\n      if (!event.propagationStopped) {\n        invokeEventListeners(event, obj);\n      }\n    }\n    event.eventPhase = event.AT_TARGET;\n    if (!event.propagationStopped) {\n      invokeEventListeners(event, event.target);\n    }\n    if (event.bubbles) {\n      event.eventPath.reverse();\n      event.eventPhase = event.BUBBLING_PHASE;\n      for (const obj of event.eventPath) {\n        if (!event.propagationStopped) {\n          invokeEventListeners(event, obj);\n        }\n      }\n    }\n    event.dispatched = false;\n    event.eventPhase = event.NONE;\n    event.currentTarget = null;\n    if (event.canceled) {\n      return false;\n    }\n    return true;\n  }\n}\nexport default FakeEventTarget;","import { InvalidStateError } from \"./lib/errors.js\";\nimport FakeEventTarget from \"./lib/FakeEventTarget.js\";\nclass FDBRequest extends FakeEventTarget {\n  _result = null;\n  _error = null;\n  source = null;\n  transaction = null;\n  readyState = \"pending\";\n  onsuccess = null;\n  onerror = null;\n  get error() {\n    if (this.readyState === \"pending\") {\n      throw new InvalidStateError();\n    }\n    return this._error;\n  }\n  set error(value) {\n    this._error = value;\n  }\n  get result() {\n    if (this.readyState === \"pending\") {\n      throw new InvalidStateError();\n    }\n    return this._result;\n  }\n  set result(value) {\n    this._result = value;\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBRequest\";\n  }\n}\nexport default FDBRequest;","class FakeDOMStringList {\n  constructor(...values) {\n    this._values = values;\n    for (let i = 0; i < values.length; i++) {\n      this[i] = values[i];\n    }\n  }\n  contains(value) {\n    return this._values.includes(value);\n  }\n  item(i) {\n    if (i < 0 || i >= this._values.length) {\n      return null;\n    }\n    return this._values[i];\n  }\n  get length() {\n    return this._values.length;\n  }\n  [Symbol.iterator]() {\n    return this._values[Symbol.iterator]();\n  }\n\n  // Handled by proxy\n\n  // Used internally, should not be used by others. I could maybe get rid of these and replace rather than mutate, but too lazy to check the spec.\n  _push(...values) {\n    for (let i = 0; i < values.length; i++) {\n      this[this._values.length + i] = values[i];\n    }\n    this._values.push(...values);\n  }\n  _sort(...values) {\n    this._values.sort(...values);\n    for (let i = 0; i < this._values.length; i++) {\n      this[i] = this._values[i];\n    }\n    return this;\n  }\n}\nexport default FakeDOMStringList;","import FDBKeyRange from \"../FDBKeyRange.js\";\nimport { DataError } from \"./errors.js\";\nimport valueToKey from \"./valueToKey.js\";\n\n// http://w3c.github.io/IndexedDB/#convert-a-value-to-a-key-range\nconst valueToKeyRange = (value, nullDisallowedFlag = false) => {\n  if (value instanceof FDBKeyRange) {\n    return value;\n  }\n  if (value === null || value === undefined) {\n    if (nullDisallowedFlag) {\n      throw new DataError();\n    }\n    return new FDBKeyRange(undefined, undefined, false, false);\n  }\n  const key = valueToKey(value);\n  return FDBKeyRange.only(key);\n};\nexport default valueToKeyRange;","// Keys provided as functions or arrays or objects need to be stringified\nconst convertKey = key => typeof key === 'object' && key ? key + '' : key;\n\n// https://www.w3.org/TR/IndexedDB/#dom-idbobjectstore-keypath\nexport function getKeyPath(keyPath) {\n  // It's important to clone the Array here because of the WPT test:\n  // \"Different instances are returned from different store instances.\"\n  // Also note that the same instance must be returned across multiple gets\n  return Array.isArray(keyPath) ? keyPath.map(convertKey) : convertKey(keyPath);\n}","import FDBKeyRange from \"../FDBKeyRange.js\";\nimport valueToKeyWithoutThrowing, { INVALID_TYPE } from \"./valueToKeyWithoutThrowing.js\";\n\n// https://www.w3.org/TR/IndexedDB/#is-a-potentially-valid-key-range\nconst isPotentiallyValidKeyRange = value => {\n  // If value is a key range, return true.\n  if (value instanceof FDBKeyRange) {\n    return true;\n  }\n\n  // Let key be the result of converting a value to a key with value.\n  const key = valueToKeyWithoutThrowing(value);\n\n  // If key is \"invalid type\" return false.\n  // Else return true.\n  return key !== INVALID_TYPE;\n};\nexport default isPotentiallyValidKeyRange;","// https://heycam.github.io/webidl/#EnforceRange\n\nconst enforceRange = (num, type) => {\n  const min = 0;\n  const max = type === \"unsigned long\" ? 4294967295 : 9007199254740991;\n  if (isNaN(num) || num < min || num > max) {\n    throw new TypeError();\n  }\n  if (num >= 0) {\n    return Math.floor(num);\n  }\n};\nexport default enforceRange;","import isPotentiallyValidKeyRange from \"./isPotentiallyValidKeyRange.js\";\nimport enforceRange from \"./enforceRange.js\";\n// https://www.w3.org/TR/IndexedDB/#create-request-to-retrieve-multiple-items\nconst extractGetAllOptions = (queryOrOptions, count, numArguments) => {\n  let query;\n  let direction;\n  if (queryOrOptions === undefined || queryOrOptions === null || isPotentiallyValidKeyRange(queryOrOptions)) {\n    // queryOrOptions is FDBKeyRange | Key | null | undefined\n    query = queryOrOptions;\n    if (numArguments > 1 && count !== undefined) {\n      count = enforceRange(count, \"unsigned long\");\n    }\n  } else {\n    // queryOrOptions is FDBGetAllOptions\n    const getAllOptions = queryOrOptions;\n    if (getAllOptions.query !== undefined) {\n      query = getAllOptions.query;\n    }\n    if (getAllOptions.count !== undefined) {\n      count = enforceRange(getAllOptions.count, \"unsigned long\");\n    }\n    if (getAllOptions.direction !== undefined) {\n      direction = getAllOptions.direction;\n    }\n  }\n  return {\n    query,\n    count,\n    direction\n  };\n};\nexport default extractGetAllOptions;","import FDBCursor from \"./FDBCursor.js\";\nimport FDBCursorWithValue from \"./FDBCursorWithValue.js\";\nimport FDBKeyRange from \"./FDBKeyRange.js\";\nimport FDBRequest from \"./FDBRequest.js\";\nimport { ConstraintError, InvalidStateError, TransactionInactiveError } from \"./lib/errors.js\";\nimport FakeDOMStringList from \"./lib/FakeDOMStringList.js\";\nimport valueToKey from \"./lib/valueToKey.js\";\nimport valueToKeyRange from \"./lib/valueToKeyRange.js\";\nimport { getKeyPath } from \"./lib/getKeyPath.js\";\nimport extractGetAllOptions from \"./lib/extractGetAllOptions.js\";\nimport enforceRange from \"./lib/enforceRange.js\";\nconst confirmActiveTransaction = index => {\n  if (index._rawIndex.deleted || index.objectStore._rawObjectStore.deleted) {\n    throw new InvalidStateError();\n  }\n  if (index.objectStore.transaction._state !== \"active\") {\n    throw new TransactionInactiveError();\n  }\n};\n\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#idl-def-IDBIndex\nclass FDBIndex {\n  constructor(objectStore, rawIndex) {\n    this._rawIndex = rawIndex;\n    this._name = rawIndex.name;\n    this.objectStore = objectStore;\n    this.keyPath = getKeyPath(rawIndex.keyPath);\n    this.multiEntry = rawIndex.multiEntry;\n    this.unique = rawIndex.unique;\n  }\n  get name() {\n    return this._name;\n  }\n\n  // https://w3c.github.io/IndexedDB/#dom-idbindex-name\n  set name(name) {\n    const transaction = this.objectStore.transaction;\n    if (!transaction.db._runningVersionchangeTransaction) {\n      throw transaction._state === \"active\" ? new InvalidStateError() : new TransactionInactiveError();\n    }\n    if (transaction._state !== \"active\") {\n      throw new TransactionInactiveError();\n    }\n    if (this._rawIndex.deleted || this.objectStore._rawObjectStore.deleted) {\n      throw new InvalidStateError();\n    }\n    name = String(name);\n    if (name === this._name) {\n      return;\n    }\n    if (this.objectStore.indexNames.contains(name)) {\n      throw new ConstraintError();\n    }\n    const oldName = this._name;\n    const oldIndexNames = [...this.objectStore.indexNames];\n    this._name = name;\n    this._rawIndex.name = name;\n    this.objectStore._indexesCache.delete(oldName);\n    this.objectStore._indexesCache.set(name, this);\n    this.objectStore._rawObjectStore.rawIndexes.delete(oldName);\n    this.objectStore._rawObjectStore.rawIndexes.set(name, this._rawIndex);\n    this.objectStore.indexNames = new FakeDOMStringList(...Array.from(this.objectStore._rawObjectStore.rawIndexes.keys()).filter(indexName => {\n      const index = this.objectStore._rawObjectStore.rawIndexes.get(indexName);\n      return index && !index.deleted;\n    }).sort());\n\n    // https://www.w3.org/TR/IndexedDB/#abort-an-upgrade-transaction - \"If handles index was not newly created during transaction, set handles name to its indexs name.\"\n    if (!this.objectStore.transaction._createdIndexes.has(this._rawIndex)) {\n      transaction._rollbackLog.push(() => {\n        this._name = oldName;\n        this._rawIndex.name = oldName;\n        this.objectStore._indexesCache.delete(name);\n        this.objectStore._indexesCache.set(oldName, this);\n        this.objectStore._rawObjectStore.rawIndexes.delete(name);\n        this.objectStore._rawObjectStore.rawIndexes.set(oldName, this._rawIndex);\n        this.objectStore.indexNames = new FakeDOMStringList(...oldIndexNames);\n      });\n    }\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBIndex-openCursor-IDBRequest-any-range-IDBCursorDirection-direction\n  openCursor(range, direction) {\n    confirmActiveTransaction(this);\n    if (range === null) {\n      range = undefined;\n    }\n    if (range !== undefined && !(range instanceof FDBKeyRange)) {\n      range = FDBKeyRange.only(valueToKey(range));\n    }\n    const request = new FDBRequest();\n    request.source = this;\n    request.transaction = this.objectStore.transaction;\n    const cursor = new FDBCursorWithValue(this, range, direction, request);\n    return this.objectStore.transaction._execRequestAsync({\n      operation: cursor._iterate.bind(cursor),\n      request,\n      source: this\n    });\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBIndex-openKeyCursor-IDBRequest-any-range-IDBCursorDirection-direction\n  openKeyCursor(range, direction) {\n    confirmActiveTransaction(this);\n    if (range === null) {\n      range = undefined;\n    }\n    if (range !== undefined && !(range instanceof FDBKeyRange)) {\n      range = FDBKeyRange.only(valueToKey(range));\n    }\n    const request = new FDBRequest();\n    request.source = this;\n    request.transaction = this.objectStore.transaction;\n    const cursor = new FDBCursor(this, range, direction, request, true);\n    return this.objectStore.transaction._execRequestAsync({\n      operation: cursor._iterate.bind(cursor),\n      request,\n      source: this\n    });\n  }\n  get(key) {\n    confirmActiveTransaction(this);\n    if (!(key instanceof FDBKeyRange)) {\n      key = valueToKey(key);\n    }\n    return this.objectStore.transaction._execRequestAsync({\n      operation: this._rawIndex.getValue.bind(this._rawIndex, key),\n      source: this\n    });\n  }\n\n  // http://w3c.github.io/IndexedDB/#dom-idbindex-getall\n  getAll(queryOrOptions, count) {\n    const options = extractGetAllOptions(queryOrOptions, count, arguments.length);\n    confirmActiveTransaction(this);\n    const range = valueToKeyRange(options.query);\n    return this.objectStore.transaction._execRequestAsync({\n      operation: this._rawIndex.getAllValues.bind(this._rawIndex, range, options.count, options.direction),\n      source: this\n    });\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBIndex-getKey-IDBRequest-any-key\n  getKey(key) {\n    confirmActiveTransaction(this);\n    if (!(key instanceof FDBKeyRange)) {\n      key = valueToKey(key);\n    }\n    return this.objectStore.transaction._execRequestAsync({\n      operation: this._rawIndex.getKey.bind(this._rawIndex, key),\n      source: this\n    });\n  }\n\n  // http://w3c.github.io/IndexedDB/#dom-idbindex-getallkeys\n  getAllKeys(queryOrOptions, count) {\n    const options = extractGetAllOptions(queryOrOptions, count, arguments.length);\n    confirmActiveTransaction(this);\n    const range = valueToKeyRange(options.query);\n    return this.objectStore.transaction._execRequestAsync({\n      operation: this._rawIndex.getAllKeys.bind(this._rawIndex, range, options.count, options.direction),\n      source: this\n    });\n  }\n\n  // https://www.w3.org/TR/IndexedDB/#dom-idbobjectstore-getallrecords\n  getAllRecords(options) {\n    let query;\n    let count;\n    let direction;\n    if (options !== undefined) {\n      if (options.query !== undefined) {\n        query = options.query;\n      }\n      if (options.count !== undefined) {\n        count = enforceRange(options.count, \"unsigned long\");\n      }\n      if (options.direction !== undefined) {\n        direction = options.direction;\n      }\n    }\n    confirmActiveTransaction(this);\n    const range = valueToKeyRange(query);\n    return this.objectStore.transaction._execRequestAsync({\n      operation: this._rawIndex.getAllRecords.bind(this._rawIndex, range, count, direction),\n      source: this\n    });\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBIndex-count-IDBRequest-any-key\n  count(key) {\n    confirmActiveTransaction(this);\n    if (key === null) {\n      key = undefined;\n    }\n    if (key !== undefined && !(key instanceof FDBKeyRange)) {\n      key = FDBKeyRange.only(valueToKey(key));\n    }\n    return this.objectStore.transaction._execRequestAsync({\n      operation: () => {\n        return this._rawIndex.count(key);\n      },\n      source: this\n    });\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBIndex\";\n  }\n}\nexport default FDBIndex;","// http://w3c.github.io/IndexedDB/#check-that-a-key-could-be-injected-into-a-value\nconst canInjectKey = (keyPath, value) => {\n  if (Array.isArray(keyPath)) {\n    throw new Error(\"The key paths used in this section are always strings and never sequences, since it is not possible to create a object store which has a key generator and also has a key path that is a sequence.\");\n  }\n  const identifiers = keyPath.split(\".\");\n  if (identifiers.length === 0) {\n    throw new Error(\"Assert: identifiers is not empty\");\n  }\n  identifiers.pop();\n  for (const identifier of identifiers) {\n    if (typeof value !== \"object\" && !Array.isArray(value)) {\n      return false;\n    }\n    const hop = Object.hasOwn(value, identifier);\n    if (!hop) {\n      return true;\n    }\n    value = value[identifier];\n  }\n  return typeof value === \"object\" || Array.isArray(value);\n};\nexport default canInjectKey;","class FDBRecord {\n  constructor(key, primaryKey, value) {\n    this._key = key;\n    this._primaryKey = primaryKey;\n    this._value = value;\n  }\n  get key() {\n    return this._key;\n  }\n  set key(_) {\n    /* for babel */\n  }\n  get primaryKey() {\n    return this._primaryKey;\n  }\n  set primaryKey(_) {\n    /* for babel */\n  }\n  get value() {\n    return this._value;\n  }\n  set value(_) {\n    /* for babel */\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBRecord\";\n  }\n}\nexport default FDBRecord;","import FDBKeyRange from \"../FDBKeyRange.js\";\nimport cmp from \"./cmp.js\";\nimport { ConstraintError } from \"./errors.js\";\n// what fraction of the total number of nodes are allowed to be deleted tombstones?\nconst MAX_TOMBSTONE_FACTOR = 2 / 3;\nconst EVERYTHING_KEY_RANGE = new FDBKeyRange(undefined, undefined, false, false);\n/**\n * Simple red-black binary tree with some aspects of a scapegoat tree. The main goal here is simplicity of\n * implementation, tailored to the needs of IndexedDB.\n *\n * Basically this implements a [red-black tree][1] for insertions, but uses the much simpler [scapegoat tree][2]\n * strategy for deletions. Deletions are a simple matter of rebuilding the tree from scratch if more than 2/3 of the\n * tree is full of deleted (tombstone) markers.\n *\n * [1]: https://en.wikipedia.org/wiki/Red%E2%80%93black_tree\n * [2]: https://en.wikipedia.org/wiki/Scapegoat_tree\n */\nexport default class BinarySearchTree {\n  _numTombstones = 0;\n  _numNodes = 0;\n\n  /**\n   *\n   * @param keysAreUnique - whether keys can be unique, and thus whether we cn skip checking `record.value` when\n   * comparing. This is basically used to distinguish ObjectStores (where the value is the entire object, not used\n   * as a key) from non-unique Indexes (where both the key and the value are meaningful keys used for sorting)\n   */\n  constructor(keysAreUnique) {\n    this._keysAreUnique = !!keysAreUnique;\n  }\n  size() {\n    return this._numNodes - this._numTombstones;\n  }\n  get(record) {\n    return this._getByComparator(this._root, otherRecord => this._compare(record, otherRecord));\n  }\n  contains(record) {\n    return !!this.get(record);\n  }\n  _compare(a, b) {\n    const keyComparison = cmp(a.key, b.key);\n    if (keyComparison !== 0) {\n      return keyComparison;\n    }\n    // if keys are unique, then we can (and must) avoid comparing the values, since they may be non-comparable\n    // (e.g. in the case of an ObjectStore, they are record objects)\n    return this._keysAreUnique ? 0 : cmp(a.value, b.value);\n  }\n  _getByComparator(node, comparator) {\n    let current = node;\n    while (current) {\n      const comparison = comparator(current.record);\n      if (comparison < 0) {\n        current = current.left;\n      } else if (comparison > 0) {\n        current = current.right;\n      } else {\n        return current.record;\n      }\n    }\n  }\n\n  /**\n   * Put a new record, and return the overwritten record if an overwrite occurred.\n   * @param record\n   * @param noOverwrite - throw a ConstraintError in case of overwrite\n   */\n  put(record, noOverwrite = false) {\n    if (!this._root) {\n      this._root = {\n        record,\n        left: undefined,\n        right: undefined,\n        parent: undefined,\n        deleted: false,\n        // the root is always black in a red-black tree\n        red: false\n      };\n      this._numNodes++;\n      return;\n    }\n    return this._put(this._root, record, noOverwrite);\n  }\n  _put(node, record, noOverwrite) {\n    const comparison = this._compare(record, node.record);\n    if (comparison < 0) {\n      if (node.left) {\n        return this._put(node.left, record, noOverwrite);\n      } else {\n        node.left = {\n          record,\n          left: undefined,\n          right: undefined,\n          parent: node,\n          deleted: false,\n          red: true\n        };\n        this._onNewNodeInserted(node.left);\n      }\n    } else if (comparison > 0) {\n      if (node.right) {\n        return this._put(node.right, record, noOverwrite);\n      } else {\n        node.right = {\n          record,\n          left: undefined,\n          right: undefined,\n          parent: node,\n          deleted: false,\n          red: true\n        };\n        this._onNewNodeInserted(node.right);\n      }\n    } else if (node.deleted) {\n      // undelete\n      node.deleted = false;\n      node.record = record;\n      this._numTombstones--;\n    } else if (noOverwrite) {\n      // replace not allowed in case of noOverwrite\n      throw new ConstraintError();\n    } else {\n      // replace, don't add, so no need to increment. return the overwritten record\n      const overwrittenRecord = node.record;\n      node.record = record;\n      return overwrittenRecord;\n    }\n  }\n  delete(record) {\n    if (!this._root) {\n      return;\n    }\n    this._delete(this._root, record);\n    if (this._numTombstones > this._numNodes * MAX_TOMBSTONE_FACTOR) {\n      // to keep the implementation simple, and because most users of fake-indexeddb are not going to be deleting\n      // a lot of nodes, just rebuild the whole tree (defragment) if the tree is too full of tombstones,\n      // as inspired by the scapegoat tree: https://en.wikipedia.org/wiki/Scapegoat_tree#Deletion\n      const records = [...this.getAllRecords()];\n      this._root = this._rebuild(records, undefined, false);\n      this._numNodes = records.length;\n      this._numTombstones = 0;\n    }\n  }\n  _delete(node, record) {\n    if (!node) {\n      return;\n    }\n    const comparison = this._compare(record, node.record);\n    if (comparison < 0) {\n      this._delete(node.left, record);\n    } else if (comparison > 0) {\n      this._delete(node.right, record);\n    } else if (!node.deleted) {\n      this._numTombstones++;\n      node.deleted = true;\n    }\n  }\n  *getAllRecords(descending = false) {\n    yield* this.getRecords(EVERYTHING_KEY_RANGE, descending);\n  }\n  *getRecords(keyRange, descending = false) {\n    yield* this._getRecordsForNode(this._root, keyRange, descending);\n  }\n  *_getRecordsForNode(node, keyRange, descending = false) {\n    if (!node) {\n      return;\n    }\n    yield* this._findRecords(node, keyRange, descending);\n  }\n  *_findRecords(node, keyRange, descending = false) {\n    const {\n      lower,\n      upper,\n      lowerOpen,\n      upperOpen\n    } = keyRange;\n    const {\n      record: {\n        key\n      }\n    } = node;\n    const lowerComparison = lower === undefined ? -1 : cmp(lower, key);\n    const upperComparison = upper === undefined ? 1 : cmp(upper, key);\n\n    // if keys are non-unique then we need to go left/right even for equality\n    // else we can just do LT/GT rather than LTE/GTE as a slight optimization\n    const moreLeft = this._keysAreUnique ? lowerComparison < 0 : lowerComparison <= 0;\n    const moreRight = this._keysAreUnique ? upperComparison > 0 : upperComparison >= 0;\n\n    // in descending mode we start with rightmost nodes, else leftmost\n    const moreStart = descending ? moreRight : moreLeft;\n    const moreEnd = descending ? moreLeft : moreRight;\n    const start = descending ? \"right\" : \"left\";\n    const end = descending ? \"left\" : \"right\";\n\n    // does the current record actually match the key range?\n    const lowerMatches = lowerOpen ? lowerComparison < 0 : lowerComparison <= 0;\n    const upperMatches = upperOpen ? upperComparison > 0 : upperComparison >= 0;\n    if (moreStart && node[start]) {\n      yield* this._findRecords(node[start], keyRange, descending);\n    }\n    if (lowerMatches && upperMatches && !node.deleted) {\n      yield node.record;\n    }\n    if (moreEnd && node[end]) {\n      yield* this._findRecords(node[end], keyRange, descending);\n    }\n  }\n  _onNewNodeInserted(newNode) {\n    this._numNodes++;\n    this._rebalanceTree(newNode);\n  }\n\n  // based on https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#Insertion\n  _rebalanceTree(node) {\n    let parent = node.parent;\n    do {\n      // case 1 -  no red/black violation\n      if (!parent.red) {\n        return;\n      }\n      const grandparent = parent.parent;\n      if (!grandparent) {\n        // case #4 - parent is the red root, node is also red, so parent goes black\n        parent.red = false;\n        return;\n      }\n      const parentIsRightChild = parent === grandparent.right;\n      const uncle = parentIsRightChild ? grandparent.left : grandparent.right;\n      if (!uncle || !uncle.red) {\n        if (node === (parentIsRightChild ? parent.left : parent.right)) {\n          // case #5 - parent is red but uncle is black\n          this._rotateSubtree(parent, parentIsRightChild);\n          node = parent;\n          parent = parentIsRightChild ? grandparent.right : grandparent.left;\n        }\n\n        // case #6 - node is \"outer\" grandchild of grandparent\n        this._rotateSubtree(grandparent, !parentIsRightChild);\n        parent.red = false;\n        grandparent.red = true;\n        return;\n      }\n\n      // case #2 - parent and uncle are both red, so both of them go black and grandparent goes red\n      parent.red = false;\n      uncle.red = false;\n      grandparent.red = true;\n      node = grandparent;\n    } while (node.parent ? parent = node.parent : false);\n\n    // case #3 - current node is the root, all constraints satisfied\n  }\n\n  // based on https://en.wikipedia.org/wiki/Red%E2%80%93black_tree#Implementation\n  _rotateSubtree(node, right) {\n    const parent = node.parent;\n    const newRoot = right ? node.left : node.right; // opposite direction\n    const newChild = right ? newRoot.right : newRoot.left;\n    node[right ? \"left\" : \"right\"] = newChild;\n    if (newChild) {\n      newChild.parent = node;\n    }\n    newRoot[right ? \"right\" : \"left\"] = node;\n    newRoot.parent = parent;\n    node.parent = newRoot;\n    if (parent) {\n      parent[node === parent.right ? \"right\" : \"left\"] = newRoot;\n    } else {\n      this._root = newRoot;\n    }\n    return newRoot;\n  }\n\n  // rebuild the whole tree from scratch, used to avoid too many deletion tombstones accumulating\n  _rebuild(records, parent, red) {\n    const {\n      length\n    } = records;\n    if (!length) {\n      return undefined;\n    }\n    const mid = length >>> 1; // like Math.floor(records.length / 2) but fast\n\n    const node = {\n      record: records[mid],\n      left: undefined,\n      right: undefined,\n      parent,\n      deleted: false,\n      red\n    };\n    const left = this._rebuild(records.slice(0, mid), node, !red);\n    const right = this._rebuild(records.slice(mid + 1), node, !red);\n    node.left = left;\n    node.right = right;\n    return node;\n  }\n}","import FDBKeyRange from \"../FDBKeyRange.js\";\nimport cmp from \"./cmp.js\";\nimport BinarySearchTree from \"./binarySearchTree.js\";\nclass RecordStore {\n  constructor(keysAreUnique) {\n    this.keysAreUnique = keysAreUnique;\n    this.records = new BinarySearchTree(this.keysAreUnique);\n  }\n  get(key) {\n    const range = key instanceof FDBKeyRange ? key : FDBKeyRange.only(key);\n    return this.records.getRecords(range).next().value;\n  }\n\n  /**\n   * Put a new record, and return the overwritten record if an overwrite occurred.\n   * @param newRecord\n   * @param noOverwrite - throw a ConstraintError in case of overwrite\n   */\n  put(newRecord, noOverwrite = false) {\n    return this.records.put(newRecord, noOverwrite);\n  }\n  delete(key) {\n    const range = key instanceof FDBKeyRange ? key : FDBKeyRange.only(key);\n    const deletedRecords = [...this.records.getRecords(range)];\n    for (const record of deletedRecords) {\n      this.records.delete(record);\n    }\n    return deletedRecords;\n  }\n  deleteByValue(key) {\n    const range = key instanceof FDBKeyRange ? key : FDBKeyRange.only(key);\n    const deletedRecords = [];\n    for (const record of this.records.getAllRecords()) {\n      if (range.includes(record.value)) {\n        this.records.delete(record);\n        deletedRecords.push(record);\n      }\n    }\n    return deletedRecords;\n  }\n  clear() {\n    const deletedRecords = [...this.records.getAllRecords()];\n    this.records = new BinarySearchTree(this.keysAreUnique);\n    return deletedRecords;\n  }\n  values(range, direction = \"next\") {\n    const descending = direction === \"prev\" || direction === \"prevunique\";\n    const records = range ? this.records.getRecords(range, descending) : this.records.getAllRecords(descending);\n    return {\n      [Symbol.iterator]: () => {\n        const next = () => {\n          return records.next();\n        };\n        if (direction === \"next\" || direction === \"prev\") {\n          return {\n            next\n          };\n        }\n\n        // For nextunique/prevunique, return an iterator that skips seen values\n        // Note that we must return the _lowest_ value regardless of direction:\n        // > Iterating with \"prevunique\" visits the same records that \"nextunique\"\n        // > visits, but in reverse order.\n        // https://w3c.github.io/IndexedDB/#dom-idbcursordirection-prevunique\n        if (direction === \"nextunique\") {\n          let previousValue = undefined;\n          return {\n            next: () => {\n              let current = next();\n              // for nextunique, continue if we already emitted the lowest unique value\n              while (!current.done && previousValue !== undefined && cmp(previousValue.key, current.value.key) === 0) {\n                current = next();\n              }\n              previousValue = current.value;\n              return current;\n            }\n          };\n        }\n\n        // prevunique is a bit more complex due to needing to check the next value, which\n        // invokes the iterable, so we need to keep a buffer of one \"lookahead\" result\n        let current = next();\n        let nextResult = next();\n        return {\n          next: () => {\n            while (!nextResult.done && cmp(current.value.key, nextResult.value.key) === 0) {\n              // note we return the _lowest_ possible value, hence set the current\n              current = nextResult;\n              nextResult = next();\n            }\n            const result = current;\n            current = nextResult;\n            nextResult = next();\n            return result;\n          }\n        };\n      }\n    };\n  }\n  size() {\n    return this.records.size();\n  }\n}\nexport default RecordStore;","import FDBRecord from \"../FDBRecord.js\";\nimport { ConstraintError } from \"./errors.js\";\nimport extractKey from \"./extractKey.js\";\nimport RecordStore from \"./RecordStore.js\";\nimport valueToKey from \"./valueToKey.js\";\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-index\nclass Index {\n  deleted = false;\n  // Initialized should be used to decide whether to throw an error or abort the versionchange transaction when there is a\n  // constraint\n  initialized = false;\n  constructor(rawObjectStore, name, keyPath, multiEntry, unique) {\n    this.rawObjectStore = rawObjectStore;\n    this.name = name;\n    this.keyPath = keyPath;\n    this.multiEntry = multiEntry;\n    this.unique = unique;\n    this.records = new RecordStore(unique);\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-retrieving-a-value-from-an-index\n  getKey(key) {\n    const record = this.records.get(key);\n    return record !== undefined ? record.value : undefined;\n  }\n\n  // http://w3c.github.io/IndexedDB/#retrieve-multiple-referenced-values-from-an-index\n  getAllKeys(range, count, direction) {\n    if (count === undefined || count === 0) {\n      count = Infinity;\n    }\n    const records = [];\n    for (const record of this.records.values(range, direction)) {\n      records.push(structuredClone(record.value));\n      if (records.length >= count) {\n        break;\n      }\n    }\n    return records;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#index-referenced-value-retrieval-operation\n  getValue(key) {\n    const record = this.records.get(key);\n    return record !== undefined ? this.rawObjectStore.getValue(record.value) : undefined;\n  }\n\n  // http://w3c.github.io/IndexedDB/#retrieve-multiple-referenced-values-from-an-index\n  getAllValues(range, count, direction) {\n    if (count === undefined || count === 0) {\n      count = Infinity;\n    }\n    const records = [];\n    for (const record of this.records.values(range, direction)) {\n      records.push(this.rawObjectStore.getValue(record.value));\n      if (records.length >= count) {\n        break;\n      }\n    }\n    return records;\n  }\n\n  // https://www.w3.org/TR/IndexedDB/#dom-idbindex-getallrecords\n  getAllRecords(range, count, direction) {\n    if (count === undefined || count === 0) {\n      count = Infinity;\n    }\n    const records = [];\n    for (const record of this.records.values(range, direction)) {\n      records.push(new FDBRecord(structuredClone(record.key), structuredClone(this.rawObjectStore.getKey(record.value)), this.rawObjectStore.getValue(record.value)));\n      if (records.length >= count) {\n        break;\n      }\n    }\n    return records;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-storing-a-record-into-an-object-store (step 7)\n  storeRecord(newRecord) {\n    let indexKey;\n    try {\n      indexKey = extractKey(this.keyPath, newRecord.value).key;\n    } catch (err) {\n      if (err.name === \"DataError\") {\n        // Invalid key is not an actual error, just means we do not store an entry in this index\n        return;\n      }\n      throw err;\n    }\n    if (!this.multiEntry || !Array.isArray(indexKey)) {\n      try {\n        valueToKey(indexKey);\n      } catch (e) {\n        return;\n      }\n    } else {\n      // remove any elements from index key that are not valid keys and remove any duplicate elements from index\n      // key such that only one instance of the duplicate value remains.\n      const keep = [];\n      for (const part of indexKey) {\n        if (keep.indexOf(part) < 0) {\n          try {\n            keep.push(valueToKey(part));\n          } catch (err) {\n            /* Do nothing */\n          }\n        }\n      }\n      indexKey = keep;\n    }\n    if (!this.multiEntry || !Array.isArray(indexKey)) {\n      if (this.unique) {\n        const existingRecord = this.records.get(indexKey);\n        if (existingRecord) {\n          throw new ConstraintError();\n        }\n      }\n    } else {\n      if (this.unique) {\n        for (const individualIndexKey of indexKey) {\n          const existingRecord = this.records.get(individualIndexKey);\n          if (existingRecord) {\n            throw new ConstraintError();\n          }\n        }\n      }\n    }\n    if (!this.multiEntry || !Array.isArray(indexKey)) {\n      this.records.put({\n        key: indexKey,\n        value: newRecord.key\n      });\n    } else {\n      for (const individualIndexKey of indexKey) {\n        this.records.put({\n          key: individualIndexKey,\n          value: newRecord.key\n        });\n      }\n    }\n  }\n  initialize(transaction) {\n    if (this.initialized) {\n      throw new Error(\"Index already initialized\");\n    }\n    transaction._execRequestAsync({\n      operation: () => {\n        try {\n          // Create index based on current value of objectstore\n          for (const record of this.rawObjectStore.records.values()) {\n            this.storeRecord(record);\n          }\n          this.initialized = true;\n        } catch (err) {\n          // console.error(err);\n          transaction._abort(err.name);\n        }\n      },\n      source: null\n    });\n  }\n  count(range) {\n    let count = 0;\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    for (const record of this.records.values(range)) {\n      count += 1;\n    }\n    return count;\n  }\n}\nexport default Index;","import { SyntaxError } from \"./errors.js\";\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-valid-key-path\nconst validateKeyPath = (keyPath, parent) => {\n  // This doesn't make sense to me based on the spec, but it is needed to pass the W3C KeyPath tests (see same\n  // comment in extractKey)\n  if (keyPath !== undefined && keyPath !== null && typeof keyPath !== \"string\" && keyPath.toString && (parent === \"array\" || !Array.isArray(keyPath))) {\n    keyPath = keyPath.toString();\n  }\n  if (typeof keyPath === \"string\") {\n    if (keyPath === \"\" && parent !== \"string\") {\n      return;\n    }\n    try {\n      // https://mathiasbynens.be/demo/javascript-identifier-regex for ECMAScript 5.1 / Unicode v7.0.0, with\n      // reserved words at beginning removed\n      const validIdentifierRegex =\n      // eslint-disable-next-line no-misleading-character-class\n      /^(?:[$A-Z_a-z\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC])(?:[$0-9A-Z_a-z\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC])*$/;\n      if (keyPath.length >= 1 && validIdentifierRegex.test(keyPath)) {\n        return;\n      }\n    } catch (err) {\n      throw new SyntaxError(err.message);\n    }\n    if (keyPath.indexOf(\" \") >= 0) {\n      throw new SyntaxError(\"The keypath argument contains an invalid key path (no spaces allowed).\");\n    }\n  }\n  if (Array.isArray(keyPath) && keyPath.length > 0) {\n    if (parent) {\n      // No nested arrays\n      throw new SyntaxError(\"The keypath argument contains an invalid key path (nested arrays).\");\n    }\n    for (const part of keyPath) {\n      validateKeyPath(part, \"array\");\n    }\n    return;\n  } else if (typeof keyPath === \"string\" && keyPath.indexOf(\".\") >= 0) {\n    keyPath = keyPath.split(\".\");\n    for (const part of keyPath) {\n      validateKeyPath(part, \"string\");\n    }\n    return;\n  }\n  throw new SyntaxError();\n};\nexport default validateKeyPath;","import FDBCursor from \"./FDBCursor.js\";\nimport FDBCursorWithValue from \"./FDBCursorWithValue.js\";\nimport FDBIndex from \"./FDBIndex.js\";\nimport FDBKeyRange from \"./FDBKeyRange.js\";\nimport FDBRequest from \"./FDBRequest.js\";\nimport canInjectKey from \"./lib/canInjectKey.js\";\nimport { ConstraintError, DataError, InvalidAccessError, InvalidStateError, NotFoundError, ReadOnlyError, TransactionInactiveError } from \"./lib/errors.js\";\nimport extractKey from \"./lib/extractKey.js\";\nimport FakeDOMStringList from \"./lib/FakeDOMStringList.js\";\nimport Index from \"./lib/Index.js\";\nimport validateKeyPath from \"./lib/validateKeyPath.js\";\nimport valueToKey from \"./lib/valueToKey.js\";\nimport valueToKeyRange from \"./lib/valueToKeyRange.js\";\nimport { getKeyPath } from \"./lib/getKeyPath.js\";\nimport extractGetAllOptions from \"./lib/extractGetAllOptions.js\";\nimport enforceRange from \"./lib/enforceRange.js\";\nimport { cloneValueForInsertion } from \"./lib/cloneValueForInsertion.js\";\nconst confirmActiveTransaction = objectStore => {\n  if (objectStore._rawObjectStore.deleted) {\n    throw new InvalidStateError();\n  }\n  if (objectStore.transaction._state !== \"active\") {\n    throw new TransactionInactiveError();\n  }\n};\nconst buildRecordAddPut = (objectStore, value, key) => {\n  confirmActiveTransaction(objectStore);\n  if (objectStore.transaction.mode === \"readonly\") {\n    throw new ReadOnlyError();\n  }\n  if (objectStore.keyPath !== null) {\n    if (key !== undefined) {\n      throw new DataError();\n    }\n  }\n  const clone = cloneValueForInsertion(value, objectStore.transaction);\n  if (objectStore.keyPath !== null) {\n    const tempKey = extractKey(objectStore.keyPath, clone);\n    if (tempKey.type === \"found\") {\n      valueToKey(tempKey.key);\n    } else {\n      if (!objectStore._rawObjectStore.keyGenerator) {\n        throw new DataError();\n      } else if (!canInjectKey(objectStore.keyPath, clone)) {\n        throw new DataError();\n      }\n    }\n  }\n  if (objectStore.keyPath === null && objectStore._rawObjectStore.keyGenerator === null && key === undefined) {\n    throw new DataError();\n  }\n  if (key !== undefined) {\n    key = valueToKey(key);\n  }\n  return {\n    key,\n    value: clone\n  };\n};\n\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#object-store\nclass FDBObjectStore {\n  _indexesCache = new Map();\n  constructor(transaction, rawObjectStore) {\n    this._rawObjectStore = rawObjectStore;\n    this._name = rawObjectStore.name;\n    this.keyPath = getKeyPath(rawObjectStore.keyPath);\n    this.autoIncrement = rawObjectStore.autoIncrement;\n    this.transaction = transaction;\n    this.indexNames = new FakeDOMStringList(...Array.from(rawObjectStore.rawIndexes.keys()).sort());\n  }\n  get name() {\n    return this._name;\n  }\n\n  // http://w3c.github.io/IndexedDB/#dom-idbobjectstore-name\n  set name(name) {\n    const transaction = this.transaction;\n    if (!transaction.db._runningVersionchangeTransaction) {\n      throw transaction._state === \"active\" ? new InvalidStateError() : new TransactionInactiveError();\n    }\n    confirmActiveTransaction(this);\n    name = String(name);\n    if (name === this._name) {\n      return;\n    }\n    if (this._rawObjectStore.rawDatabase.rawObjectStores.has(name)) {\n      throw new ConstraintError();\n    }\n    const oldName = this._name;\n    const oldObjectStoreNames = [...transaction.db.objectStoreNames];\n    this._name = name;\n    this._rawObjectStore.name = name;\n    this.transaction._objectStoresCache.delete(oldName);\n    this.transaction._objectStoresCache.set(name, this);\n    this._rawObjectStore.rawDatabase.rawObjectStores.delete(oldName);\n    this._rawObjectStore.rawDatabase.rawObjectStores.set(name, this._rawObjectStore);\n    transaction.db.objectStoreNames = new FakeDOMStringList(...Array.from(this._rawObjectStore.rawDatabase.rawObjectStores.keys()).filter(objectStoreName => {\n      const objectStore = this._rawObjectStore.rawDatabase.rawObjectStores.get(objectStoreName);\n      return objectStore && !objectStore.deleted;\n    }).sort());\n    const oldScope = new Set(transaction._scope);\n    const oldTransactionObjectStoreNames = [...transaction.objectStoreNames];\n    this.transaction._scope.delete(oldName);\n    transaction._scope.add(name);\n    transaction.objectStoreNames = new FakeDOMStringList(...Array.from(transaction._scope).sort());\n\n    // https://www.w3.org/TR/IndexedDB/#abort-an-upgrade-transaction - \"If handles object store was not newly created during transaction, set handles name to its object stores name.\"\n    if (!this.transaction._createdObjectStores.has(this._rawObjectStore)) {\n      transaction._rollbackLog.push(() => {\n        this._name = oldName;\n        this._rawObjectStore.name = oldName;\n        this.transaction._objectStoresCache.delete(name);\n        this.transaction._objectStoresCache.set(oldName, this);\n        this._rawObjectStore.rawDatabase.rawObjectStores.delete(name);\n        this._rawObjectStore.rawDatabase.rawObjectStores.set(oldName, this._rawObjectStore);\n        transaction.db.objectStoreNames = new FakeDOMStringList(...oldObjectStoreNames);\n        transaction._scope = oldScope;\n        transaction.objectStoreNames = new FakeDOMStringList(...oldTransactionObjectStoreNames);\n      });\n    }\n  }\n  put(value, key) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    const record = buildRecordAddPut(this, value, key);\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.storeRecord.bind(this._rawObjectStore, record, false, this.transaction._rollbackLog),\n      source: this\n    });\n  }\n  add(value, key) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    const record = buildRecordAddPut(this, value, key);\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.storeRecord.bind(this._rawObjectStore, record, true, this.transaction._rollbackLog),\n      source: this\n    });\n  }\n  delete(key) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    confirmActiveTransaction(this);\n    if (this.transaction.mode === \"readonly\") {\n      throw new ReadOnlyError();\n    }\n    if (!(key instanceof FDBKeyRange)) {\n      key = valueToKey(key);\n    }\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.deleteRecord.bind(this._rawObjectStore, key, this.transaction._rollbackLog),\n      source: this\n    });\n  }\n  get(key) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    confirmActiveTransaction(this);\n    if (!(key instanceof FDBKeyRange)) {\n      key = valueToKey(key);\n    }\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.getValue.bind(this._rawObjectStore, key),\n      source: this\n    });\n  }\n\n  // http://w3c.github.io/IndexedDB/#dom-idbobjectstore-getall\n  getAll(queryOrOptions, count) {\n    const options = extractGetAllOptions(queryOrOptions, count, arguments.length);\n    confirmActiveTransaction(this);\n    const range = valueToKeyRange(options.query);\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.getAllValues.bind(this._rawObjectStore, range, options.count, options.direction),\n      source: this\n    });\n  }\n\n  // http://w3c.github.io/IndexedDB/#dom-idbobjectstore-getkey\n  getKey(key) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    confirmActiveTransaction(this);\n    if (!(key instanceof FDBKeyRange)) {\n      key = valueToKey(key);\n    }\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.getKey.bind(this._rawObjectStore, key),\n      source: this\n    });\n  }\n\n  // http://w3c.github.io/IndexedDB/#dom-idbobjectstore-getallkeys\n  getAllKeys(queryOrOptions, count) {\n    const options = extractGetAllOptions(queryOrOptions, count, arguments.length);\n    confirmActiveTransaction(this);\n    const range = valueToKeyRange(options.query);\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.getAllKeys.bind(this._rawObjectStore, range, options.count, options.direction),\n      source: this\n    });\n  }\n\n  // https://www.w3.org/TR/IndexedDB/#dom-idbobjectstore-getallrecords\n  getAllRecords(options) {\n    let query;\n    let count;\n    let direction;\n    if (options !== undefined) {\n      if (options.query !== undefined) {\n        query = options.query;\n      }\n      if (options.count !== undefined) {\n        count = enforceRange(options.count, \"unsigned long\");\n      }\n      if (options.direction !== undefined) {\n        direction = options.direction;\n      }\n    }\n    confirmActiveTransaction(this);\n    const range = valueToKeyRange(query);\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.getAllRecords.bind(this._rawObjectStore, range, count, direction),\n      source: this\n    });\n  }\n  clear() {\n    confirmActiveTransaction(this);\n    if (this.transaction.mode === \"readonly\") {\n      throw new ReadOnlyError();\n    }\n    return this.transaction._execRequestAsync({\n      operation: this._rawObjectStore.clear.bind(this._rawObjectStore, this.transaction._rollbackLog),\n      source: this\n    });\n  }\n  openCursor(range, direction) {\n    confirmActiveTransaction(this);\n    if (range === null) {\n      range = undefined;\n    }\n    if (range !== undefined && !(range instanceof FDBKeyRange)) {\n      range = FDBKeyRange.only(valueToKey(range));\n    }\n    const request = new FDBRequest();\n    request.source = this;\n    request.transaction = this.transaction;\n    const cursor = new FDBCursorWithValue(this, range, direction, request);\n    return this.transaction._execRequestAsync({\n      operation: cursor._iterate.bind(cursor),\n      request,\n      source: this\n    });\n  }\n  openKeyCursor(range, direction) {\n    confirmActiveTransaction(this);\n    if (range === null) {\n      range = undefined;\n    }\n    if (range !== undefined && !(range instanceof FDBKeyRange)) {\n      range = FDBKeyRange.only(valueToKey(range));\n    }\n    const request = new FDBRequest();\n    request.source = this;\n    request.transaction = this.transaction;\n    const cursor = new FDBCursor(this, range, direction, request, true);\n    return this.transaction._execRequestAsync({\n      operation: cursor._iterate.bind(cursor),\n      request,\n      source: this\n    });\n  }\n\n  // tslint:-next-line max-line-length\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBObjectStore-createIndex-IDBIndex-DOMString-name-DOMString-sequence-DOMString--keyPath-IDBIndexParameters-optionalParameters\n  createIndex(name, keyPath, optionalParameters = {}) {\n    if (arguments.length < 2) {\n      throw new TypeError();\n    }\n    const multiEntry = optionalParameters.multiEntry !== undefined ? optionalParameters.multiEntry : false;\n    const unique = optionalParameters.unique !== undefined ? optionalParameters.unique : false;\n    if (this.transaction.mode !== \"versionchange\") {\n      throw new InvalidStateError();\n    }\n    confirmActiveTransaction(this);\n    if (this.indexNames.contains(name)) {\n      throw new ConstraintError();\n    }\n    validateKeyPath(keyPath);\n    if (Array.isArray(keyPath) && multiEntry) {\n      throw new InvalidAccessError();\n    }\n\n    // The index that is requested to be created can contain constraints on the data allowed in the index's\n    // referenced object store, such as requiring uniqueness of the values referenced by the index's keyPath. If the\n    // referenced object store already contains data which violates these constraints, this MUST NOT cause the\n    // implementation of createIndex to throw an exception or affect what it returns. The implementation MUST still\n    // create and return an IDBIndex object. Instead the implementation must queue up an operation to abort the\n    // \"versionchange\" transaction which was used for the createIndex call.\n\n    // Save for rollbackLog\n    const indexNames = [...this.indexNames];\n    const index = new Index(this._rawObjectStore, name, keyPath, multiEntry, unique);\n    this.indexNames._push(name);\n    this.indexNames._sort();\n    this.transaction._createdIndexes.add(index);\n    this._rawObjectStore.rawIndexes.set(name, index);\n    index.initialize(this.transaction); // This is async by design\n\n    this.transaction._rollbackLog.push(() => {\n      index.deleted = true;\n      this.indexNames = new FakeDOMStringList(...indexNames);\n      this._rawObjectStore.rawIndexes.delete(index.name);\n    });\n    return new FDBIndex(this, index);\n  }\n\n  // https://w3c.github.io/IndexedDB/#dom-idbobjectstore-index\n  index(name) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    if (this._rawObjectStore.deleted || this.transaction._state === \"finished\") {\n      throw new InvalidStateError();\n    }\n    const index = this._indexesCache.get(name);\n    if (index !== undefined) {\n      return index;\n    }\n    const rawIndex = this._rawObjectStore.rawIndexes.get(name);\n    if (!this.indexNames.contains(name) || rawIndex === undefined) {\n      throw new NotFoundError();\n    }\n    const index2 = new FDBIndex(this, rawIndex);\n    this._indexesCache.set(name, index2);\n    return index2;\n  }\n  deleteIndex(name) {\n    if (arguments.length === 0) {\n      throw new TypeError();\n    }\n    if (this.transaction.mode !== \"versionchange\") {\n      throw new InvalidStateError();\n    }\n    confirmActiveTransaction(this);\n    const rawIndex = this._rawObjectStore.rawIndexes.get(name);\n    if (rawIndex === undefined) {\n      throw new NotFoundError();\n    }\n    this.transaction._rollbackLog.push(() => {\n      rawIndex.deleted = false;\n      this._rawObjectStore.rawIndexes.set(rawIndex.name, rawIndex);\n      this.indexNames._push(rawIndex.name);\n      this.indexNames._sort();\n    });\n    this.indexNames = new FakeDOMStringList(...Array.from(this.indexNames).filter(indexName => {\n      return indexName !== name;\n    }));\n    rawIndex.deleted = true; // Not sure if this is supposed to happen synchronously\n\n    this.transaction._execRequestAsync({\n      operation: () => {\n        const rawIndex2 = this._rawObjectStore.rawIndexes.get(name);\n\n        // Hack in case another index is given this name before this async request is processed. It'd be better\n        // to have a real unique ID for each index.\n        if (rawIndex === rawIndex2) {\n          this._rawObjectStore.rawIndexes.delete(name);\n        }\n      },\n      source: this\n    });\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBObjectStore-count-IDBRequest-any-key\n  count(key) {\n    confirmActiveTransaction(this);\n    if (key === null) {\n      key = undefined;\n    }\n    if (key !== undefined && !(key instanceof FDBKeyRange)) {\n      key = FDBKeyRange.only(valueToKey(key));\n    }\n    return this.transaction._execRequestAsync({\n      operation: () => {\n        return this._rawObjectStore.count(key);\n      },\n      source: this\n    });\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBObjectStore\";\n  }\n}\nexport default FDBObjectStore;","class Event {\n  eventPath = [];\n  NONE = 0;\n  CAPTURING_PHASE = 1;\n  AT_TARGET = 2;\n  BUBBLING_PHASE = 3;\n\n  // Flags\n  propagationStopped = false;\n  immediatePropagationStopped = false;\n  canceled = false;\n  initialized = true;\n  dispatched = false;\n  target = null;\n  currentTarget = null;\n  eventPhase = 0;\n  defaultPrevented = false;\n  isTrusted = false;\n  timeStamp = Date.now();\n  constructor(type, eventInitDict = {}) {\n    this.type = type;\n    this.bubbles = eventInitDict.bubbles !== undefined ? eventInitDict.bubbles : false;\n    this.cancelable = eventInitDict.cancelable !== undefined ? eventInitDict.cancelable : false;\n  }\n  preventDefault() {\n    if (this.cancelable) {\n      this.canceled = true;\n    }\n  }\n  stopPropagation() {\n    this.propagationStopped = true;\n  }\n  stopImmediatePropagation() {\n    this.propagationStopped = true;\n    this.immediatePropagationStopped = true;\n  }\n}\nexport default Event;","// When running within Node.js (including jsdom), we want to use setImmediate\n// (which runs immediately) rather than setTimeout (which enforces a minimum\n// delay of 1ms, and on Windows only has a resolution of 15ms or so).  jsdom\n// doesn't provide setImmediate (to better match the browser environment) and\n// sandboxes scripts, but its sandbox is by necessity imperfect, so we can break\n// out of it:\n//\n// - https://github.com/jsdom/jsdom#executing-scripts\n// - https://github.com/jsdom/jsdom/issues/2729\n// - https://github.com/scala-js/scala-js-macrotask-executor/pull/17\nfunction getSetImmediateFromJsdom() {\n  if (typeof navigator !== \"undefined\" && /jsdom/.test(navigator.userAgent)) {\n    const outerRealmFunctionConstructor = Node.constructor;\n    return new outerRealmFunctionConstructor(\"return setImmediate\")();\n  } else {\n    return undefined;\n  }\n}\n\n// waiting on this PR for typescript types: https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1249\n\n// 'postTask' runs right after microtasks, so equivalent to setTimeout but without the 4ms clamping.\n// Using the default priority of 'user-visible' to avoid blocking input while still running fairly quickly.\n// See: https://developer.mozilla.org/en-US/docs/Web/API/Prioritized_Task_Scheduling_API#task_priorities\nconst schedulerPostTask = typeof scheduler !== \"undefined\" && (fn => scheduler.postTask(fn));\n\n// fallback for environments that don't support any of the above\nconst doSetTimeout = fn => setTimeout(fn, 0);\n\n// Schedules a task to run later.  Use Node.js's setImmediate if available and\n// setTimeout otherwise.  Note that options like process.nextTick or\n// queueMicrotask will likely not work: IndexedDB semantics require that\n// transactions are marked as not active when the event loop runs. The next\n// tick queue and microtask queue run within the current event loop macrotask,\n// so they'd process database operations too quickly.\nexport const queueTask = fn => {\n  const setImmediate = globalThis.setImmediate || getSetImmediateFromJsdom() || schedulerPostTask || doSetTimeout;\n  setImmediate(fn);\n};","import FDBObjectStore from \"./FDBObjectStore.js\";\nimport FDBRequest from \"./FDBRequest.js\";\nimport { AbortError, InvalidStateError, NotFoundError, TransactionInactiveError } from \"./lib/errors.js\";\nimport FakeDOMStringList from \"./lib/FakeDOMStringList.js\";\nimport FakeEvent from \"./lib/FakeEvent.js\";\nimport FakeEventTarget from \"./lib/FakeEventTarget.js\";\nimport { queueTask } from \"./lib/scheduling.js\";\nconst prioritizedListenerTypes = [\"error\", \"abort\", \"complete\"];\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#transaction\nclass FDBTransaction extends FakeEventTarget {\n  _state = \"active\";\n  _started = false;\n  _rollbackLog = [];\n  _objectStoresCache = new Map();\n  _openRequest = null;\n  error = null;\n  onabort = null;\n  oncomplete = null;\n  onerror = null;\n  _prioritizedListeners = new Map();\n  _requests = [];\n  _createdIndexes = new Set();\n  _createdObjectStores = new Set();\n  constructor(storeNames, mode, durability, db) {\n    super();\n    this._scope = new Set(storeNames);\n    this.mode = mode;\n    this.durability = durability;\n    this.db = db;\n    this.objectStoreNames = new FakeDOMStringList(...Array.from(this._scope).sort());\n    for (const type of prioritizedListenerTypes) {\n      // Attach prioritized (internal) listeners before any external listeners are attached.\n      // This ensures that these listeners run with the same timing regardless of whether\n      // the user uses `on*` or `addEventListener` for event listeners.\n      this.addEventListener(type, () => {\n        this._prioritizedListeners.get(type)?.();\n      });\n    }\n  }\n\n  // https://w3c.github.io/IndexedDB/#abort-transaction\n  _abort(errName) {\n    for (const f of this._rollbackLog.reverse()) {\n      f();\n    }\n    if (errName !== null) {\n      const e = new DOMException(undefined, errName);\n      this.error = e;\n    }\n\n    // Should this directly remove from _requests?\n    for (const {\n      request\n    } of this._requests) {\n      if (request.readyState !== \"done\") {\n        request.readyState = \"done\"; // This will cancel execution of this request's operation\n        if (request.source) {\n          // https://w3c.github.io/IndexedDB/#ref-for-list-iterate%E2%91%A2\n          // For each request of transactions request list, abort the steps to asynchronously\n          // execute a request for request, set requests processed flag to true, and queue a\n          // database task to run these steps:\n          queueTask(() => {\n            // Set requests result to undefined.\n            request.result = undefined;\n            // Set requests error to a newly created \"AbortError\" DOMException.\n            request.error = new AbortError();\n\n            // Fire an event named error at request with its bubbles and cancelable attributes initialized\n            // to true.\n            const event = new FakeEvent(\"error\", {\n              bubbles: true,\n              cancelable: true\n            });\n            event.eventPath = [this.db, this];\n            try {\n              request.dispatchEvent(event);\n            } catch (_err) {\n              if (this._state === \"active\") {\n                this._abort(\"AbortError\");\n              }\n            }\n          });\n        }\n      }\n    }\n\n    // Queue a database task to run these steps:\n    queueTask(() => {\n      // If transaction is an upgrade transaction, then set transactions connections associated databases\n      // upgrade transaction to null.\n      // (i.e. remove it from the list of `db.connections`)\n      const isUpgradeTransaction = this.mode === \"versionchange\";\n      if (isUpgradeTransaction) {\n        this.db._rawDatabase.connections = this.db._rawDatabase.connections.filter(connection => !connection._rawDatabase.transactions.includes(this));\n      }\n      // Fire an event named abort at transaction with its bubbles attribute initialized to true.\n      const event = new FakeEvent(\"abort\", {\n        bubbles: true,\n        cancelable: false\n      });\n      event.eventPath = [this.db];\n      this.dispatchEvent(event);\n\n      // If transaction is an upgrade transaction, then:\n      if (isUpgradeTransaction) {\n        // Let request be the open request associated with transaction.\n        const request = this._openRequest;\n        // Set requests transaction to null.\n        request.transaction = null;\n        // Set requests result to undefined.\n        request.result = undefined;\n      }\n    });\n    this._state = \"finished\";\n  }\n  abort() {\n    if (this._state === \"committing\" || this._state === \"finished\") {\n      throw new InvalidStateError();\n    }\n    this._state = \"active\";\n    this._abort(null);\n  }\n\n  // http://w3c.github.io/IndexedDB/#dom-idbtransaction-objectstore\n  objectStore(name) {\n    if (this._state !== \"active\") {\n      throw new InvalidStateError();\n    }\n    const objectStore = this._objectStoresCache.get(name);\n    if (objectStore !== undefined) {\n      return objectStore;\n    }\n    const rawObjectStore = this.db._rawDatabase.rawObjectStores.get(name);\n    if (!this._scope.has(name) || rawObjectStore === undefined) {\n      throw new NotFoundError();\n    }\n    const objectStore2 = new FDBObjectStore(this, rawObjectStore);\n    this._objectStoresCache.set(name, objectStore2);\n    return objectStore2;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-asynchronously-executing-a-request\n  _execRequestAsync(obj) {\n    const source = obj.source;\n    const operation = obj.operation;\n    let request = Object.hasOwn(obj, \"request\") ? obj.request : null;\n    if (this._state !== \"active\") {\n      throw new TransactionInactiveError();\n    }\n\n    // Request should only be passed for cursors\n    if (!request) {\n      if (!source) {\n        // Special requests like indexes that just need to run some code\n        request = new FDBRequest();\n      } else {\n        request = new FDBRequest();\n        request.source = source;\n        request.transaction = source.transaction;\n      }\n    }\n    this._requests.push({\n      operation,\n      request\n    });\n    return request;\n  }\n  _start() {\n    this._started = true;\n\n    // Remove from request queue - cursor ones will be added back if necessary by cursor.continue and such\n    let operation;\n    let request;\n    while (this._requests.length > 0) {\n      const r = this._requests.shift();\n\n      // This should only be false if transaction was aborted\n      if (r && r.request.readyState !== \"done\") {\n        request = r.request;\n        operation = r.operation;\n        break;\n      }\n    }\n    if (request && operation) {\n      if (!request.source) {\n        // Special requests like indexes that just need to run some code, with error handling already built into\n        // operation\n        operation();\n      } else {\n        let defaultAction;\n        let event;\n        try {\n          const result = operation();\n          request.readyState = \"done\";\n          request.result = result;\n          request.error = undefined;\n\n          // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-fire-a-success-event\n          if (this._state === \"inactive\") {\n            this._state = \"active\";\n          }\n          event = new FakeEvent(\"success\", {\n            bubbles: false,\n            cancelable: false\n          });\n        } catch (err) {\n          request.readyState = \"done\";\n          request.result = undefined;\n          request.error = err;\n\n          // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-fire-an-error-event\n          if (this._state === \"inactive\") {\n            this._state = \"active\";\n          }\n          event = new FakeEvent(\"error\", {\n            bubbles: true,\n            cancelable: true\n          });\n          defaultAction = this._abort.bind(this, err.name);\n        }\n        try {\n          event.eventPath = [this.db, this];\n          request.dispatchEvent(event);\n        } catch (_err) {\n          if (this._state === \"active\") {\n            this._abort(\"AbortError\");\n            defaultAction = undefined; // do not abort again\n          }\n        }\n\n        // Default action of event\n        if (!event.canceled) {\n          if (defaultAction) {\n            defaultAction();\n          }\n        }\n      }\n\n      // Give it another chance for new handlers to be set before finishing\n      queueTask(this._start.bind(this));\n      return;\n    }\n\n    // Check if transaction complete event needs to be fired\n    if (this._state !== \"finished\") {\n      // Either aborted or committed already\n      this._state = \"finished\";\n      if (!this.error) {\n        const event = new FakeEvent(\"complete\");\n        this.dispatchEvent(event);\n      }\n    }\n  }\n  commit() {\n    if (this._state !== \"active\") {\n      throw new InvalidStateError();\n    }\n    this._state = \"committing\";\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBTransaction\";\n  }\n}\nexport default FDBTransaction;","import { ConstraintError } from \"./errors.js\";\nconst MAX_KEY = 9007199254740992;\nclass KeyGenerator {\n  // This is kind of wrong. Should start at 1 and increment only after record is saved\n  num = 0;\n  next() {\n    if (this.num >= MAX_KEY) {\n      throw new ConstraintError();\n    }\n    this.num += 1;\n    return this.num;\n  }\n\n  // https://w3c.github.io/IndexedDB/#possibly-update-the-key-generator\n  setIfLarger(num) {\n    const value = Math.floor(Math.min(num, MAX_KEY)) - 1;\n    if (value >= this.num) {\n      this.num = value + 1;\n    }\n  }\n}\nexport default KeyGenerator;","import FDBRecord from \"../FDBRecord.js\";\nimport { DataError } from \"./errors.js\";\nimport extractKey from \"./extractKey.js\";\nimport KeyGenerator from \"./KeyGenerator.js\";\nimport RecordStore from \"./RecordStore.js\";\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-object-store\nclass ObjectStore {\n  deleted = false;\n  records = new RecordStore(true);\n  rawIndexes = new Map();\n  constructor(rawDatabase, name, keyPath, autoIncrement) {\n    this.rawDatabase = rawDatabase;\n    this.keyGenerator = autoIncrement === true ? new KeyGenerator() : null;\n    this.deleted = false;\n    this.name = name;\n    this.keyPath = keyPath;\n    this.autoIncrement = autoIncrement;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-retrieving-a-value-from-an-object-store\n  getKey(key) {\n    const record = this.records.get(key);\n    return record !== undefined ? structuredClone(record.key) : undefined;\n  }\n\n  // http://w3c.github.io/IndexedDB/#retrieve-multiple-keys-from-an-object-store\n  getAllKeys(range, count, direction) {\n    if (count === undefined || count === 0) {\n      count = Infinity;\n    }\n    const records = [];\n    for (const record of this.records.values(range, direction)) {\n      records.push(structuredClone(record.key));\n      if (records.length >= count) {\n        break;\n      }\n    }\n    return records;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-retrieving-a-value-from-an-object-store\n  getValue(key) {\n    const record = this.records.get(key);\n    return record !== undefined ? structuredClone(record.value) : undefined;\n  }\n\n  // http://w3c.github.io/IndexedDB/#retrieve-multiple-values-from-an-object-store\n  getAllValues(range, count, direction) {\n    if (count === undefined || count === 0) {\n      count = Infinity;\n    }\n    const records = [];\n    for (const record of this.records.values(range, direction)) {\n      records.push(structuredClone(record.value));\n      if (records.length >= count) {\n        break;\n      }\n    }\n    return records;\n  }\n\n  // https://www.w3.org/TR/IndexedDB/#dom-idbobjectstore-getallrecords\n  getAllRecords(range, count, direction) {\n    if (count === undefined || count === 0) {\n      count = Infinity;\n    }\n    const records = [];\n    for (const record of this.records.values(range, direction)) {\n      records.push(new FDBRecord(structuredClone(record.key), structuredClone(record.key), structuredClone(record.value)));\n      if (records.length >= count) {\n        break;\n      }\n    }\n    return records;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-storing-a-record-into-an-object-store\n  storeRecord(newRecord, noOverwrite, rollbackLog) {\n    if (this.keyPath !== null) {\n      const key = extractKey(this.keyPath, newRecord.value).key;\n      if (key !== undefined) {\n        newRecord.key = key;\n      }\n    }\n    const rollbackLogForThisOperation = [];\n    if (this.keyGenerator !== null && newRecord.key === undefined) {\n      let rolledBack = false;\n      const keyGeneratorBefore = this.keyGenerator.num;\n      const rollbackKeyGenerator = () => {\n        if (rolledBack) {\n          return;\n        }\n        rolledBack = true;\n        if (this.keyGenerator) {\n          this.keyGenerator.num = keyGeneratorBefore;\n        }\n      };\n      rollbackLogForThisOperation.push(rollbackKeyGenerator);\n      if (rollbackLog) {\n        rollbackLog.push(rollbackKeyGenerator);\n      }\n      newRecord.key = this.keyGenerator.next();\n\n      // Set in value if keyPath defiend but led to no key\n      // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-to-assign-a-key-to-a-value-using-a-key-path\n      if (this.keyPath !== null) {\n        if (Array.isArray(this.keyPath)) {\n          throw new Error(\"Cannot have an array key path in an object store with a key generator\");\n        }\n        let remainingKeyPath = this.keyPath;\n        let object = newRecord.value;\n        let identifier;\n        let i = 0; // Just to run the loop at least once\n        while (i >= 0) {\n          if (typeof object !== \"object\") {\n            throw new DataError();\n          }\n          i = remainingKeyPath.indexOf(\".\");\n          if (i >= 0) {\n            identifier = remainingKeyPath.slice(0, i);\n            remainingKeyPath = remainingKeyPath.slice(i + 1);\n            if (!Object.hasOwn(object, identifier)) {\n              // Bypass prototype when setting (See `bindings-inject-values-bypass.any.js`)\n              // Equivalent to `object[identifier] = ...` without using `Object.prototype`\n              Object.defineProperty(object, identifier, {\n                configurable: true,\n                enumerable: true,\n                writable: true,\n                value: {}\n              });\n            }\n            object = object[identifier];\n          }\n        }\n        identifier = remainingKeyPath;\n\n        // Bypass prototype when setting (See `bindings-inject-values-bypass.any.js`)\n        // Equivalent to `object[identifier] = ...` without using `Object.prototype`\n        Object.defineProperty(object, identifier, {\n          configurable: true,\n          enumerable: true,\n          writable: true,\n          value: newRecord.key\n        });\n      }\n    } else if (this.keyGenerator !== null && typeof newRecord.key === \"number\") {\n      this.keyGenerator.setIfLarger(newRecord.key);\n    }\n    const existingRecord = this.records.put(newRecord, noOverwrite);\n    let rolledBack = false;\n    const rollbackStoreRecord = () => {\n      if (rolledBack) {\n        return;\n      }\n      rolledBack = true;\n      if (existingRecord) {\n        // overwrite on rollback\n        this.storeRecord(existingRecord, false);\n      } else {\n        // delete on rollback\n        this.deleteRecord(newRecord.key);\n      }\n    };\n    rollbackLogForThisOperation.push(rollbackStoreRecord);\n    if (rollbackLog) {\n      rollbackLog.push(rollbackStoreRecord);\n    }\n\n    // Delete existing indexes\n    if (existingRecord) {\n      for (const rawIndex of this.rawIndexes.values()) {\n        rawIndex.records.deleteByValue(newRecord.key);\n      }\n    }\n\n    // Update indexes\n    try {\n      for (const rawIndex of this.rawIndexes.values()) {\n        if (rawIndex.initialized) {\n          rawIndex.storeRecord(newRecord);\n        }\n      }\n    } catch (err) {\n      // If this request fails here and preventDefault is used to stop the transaction from aborting, we need to roll back the addition of this record to the store, otherwise it will be present in subsequent requests on this transaction. Same for key generator.\n      if (err.name === \"ConstraintError\") {\n        for (const rollback of rollbackLogForThisOperation) {\n          rollback();\n        }\n      }\n      throw err;\n    }\n    return newRecord.key;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-deleting-records-from-an-object-store\n  deleteRecord(key, rollbackLog) {\n    const deletedRecords = this.records.delete(key);\n    if (rollbackLog) {\n      for (const record of deletedRecords) {\n        rollbackLog.push(() => {\n          this.storeRecord(record, true);\n        });\n      }\n    }\n    for (const rawIndex of this.rawIndexes.values()) {\n      rawIndex.records.deleteByValue(key);\n    }\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-steps-for-clearing-an-object-store\n  clear(rollbackLog) {\n    const deletedRecords = this.records.clear();\n    if (rollbackLog) {\n      for (const record of deletedRecords) {\n        rollbackLog.push(() => {\n          this.storeRecord(record, true);\n        });\n      }\n    }\n    for (const rawIndex of this.rawIndexes.values()) {\n      rawIndex.records.clear();\n    }\n  }\n  count(range) {\n    // optimization: if there is no range, or if the range is everything, then we can just count the total size\n    if (range === undefined || range.lower === undefined && range.upper === undefined) {\n      return this.records.size();\n    }\n    let count = 0;\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    for (const record of this.records.values(range)) {\n      count += 1;\n    }\n    return count;\n  }\n}\nexport default ObjectStore;","import FakeEvent from \"./FakeEvent.js\";\nimport { queueTask } from \"./scheduling.js\";\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#database-closing-steps\nconst closeConnection = (connection, forced = false) => {\n  connection._closePending = true;\n  const transactionsComplete = connection._rawDatabase.transactions.every(transaction => {\n    return transaction._state === \"finished\";\n  });\n  if (transactionsComplete) {\n    connection._closed = true;\n    connection._rawDatabase.connections = connection._rawDatabase.connections.filter(otherConnection => {\n      return connection !== otherConnection;\n    });\n    if (forced) {\n      const event = new FakeEvent(\"close\", {\n        bubbles: false,\n        cancelable: false\n      });\n      event.eventPath = [];\n      connection.dispatchEvent(event);\n    }\n  } else {\n    queueTask(() => {\n      closeConnection(connection, forced);\n    });\n  }\n};\nexport default closeConnection;","import FDBTransaction from \"./FDBTransaction.js\";\nimport { ConstraintError, InvalidAccessError, InvalidStateError, NotFoundError, TransactionInactiveError } from \"./lib/errors.js\";\nimport FakeDOMStringList from \"./lib/FakeDOMStringList.js\";\nimport FakeEventTarget from \"./lib/FakeEventTarget.js\";\nimport ObjectStore from \"./lib/ObjectStore.js\";\nimport validateKeyPath from \"./lib/validateKeyPath.js\";\nimport closeConnection from \"./lib/closeConnection.js\";\n// Common first 3 steps of https://www.w3.org/TR/IndexedDB/#dom-idbdatabase-createobjectstore and https://www.w3.org/TR/IndexedDB/#dom-idbdatabase-deleteobjectstore\nconst confirmActiveVersionchangeTransaction = database => {\n  // Let transaction be databases upgrade transaction if it is not null, or throw an \"InvalidStateError\" DOMException otherwise.\n  let transaction;\n  if (database._runningVersionchangeTransaction) {\n    // Find the latest versionchange transaction\n    transaction = database._rawDatabase.transactions.findLast(tx => {\n      return tx.mode === \"versionchange\";\n    });\n  }\n  if (!transaction) {\n    throw new InvalidStateError();\n  }\n\n  // If transactions state is not active, then throw a \"TransactionInactiveError\" DOMException.\n  if (transaction._state !== \"active\") {\n    throw new TransactionInactiveError();\n  }\n  return transaction;\n};\n\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#database-interface\nclass FDBDatabase extends FakeEventTarget {\n  _closePending = false;\n  _closed = false;\n  _runningVersionchangeTransaction = false;\n  constructor(rawDatabase) {\n    super();\n    this._rawDatabase = rawDatabase;\n    this._rawDatabase.connections.push(this);\n    this.name = rawDatabase.name;\n    this.version = rawDatabase.version;\n    this.objectStoreNames = new FakeDOMStringList(...Array.from(rawDatabase.rawObjectStores.keys()).sort());\n  }\n\n  // http://w3c.github.io/IndexedDB/#dom-idbdatabase-createobjectstore\n  createObjectStore(name, options = {}) {\n    if (name === undefined) {\n      throw new TypeError();\n    }\n    const transaction = confirmActiveVersionchangeTransaction(this);\n    const keyPath = options !== null && options.keyPath !== undefined ? options.keyPath : null;\n    const autoIncrement = options !== null && options.autoIncrement !== undefined ? options.autoIncrement : false;\n    if (keyPath !== null) {\n      validateKeyPath(keyPath);\n    }\n    if (this._rawDatabase.rawObjectStores.has(name)) {\n      throw new ConstraintError();\n    }\n    if (autoIncrement && (keyPath === \"\" || Array.isArray(keyPath))) {\n      throw new InvalidAccessError();\n    }\n\n    // Save for rollbackLog\n    const objectStoreNames = [...this.objectStoreNames];\n    const transactionObjectStoreNames = [...transaction.objectStoreNames];\n    const rawObjectStore = new ObjectStore(this._rawDatabase, name, keyPath, autoIncrement);\n    this.objectStoreNames._push(name);\n    this.objectStoreNames._sort();\n    transaction._scope.add(name);\n    transaction._createdObjectStores.add(rawObjectStore);\n    this._rawDatabase.rawObjectStores.set(name, rawObjectStore);\n    transaction.objectStoreNames = new FakeDOMStringList(...this.objectStoreNames);\n    transaction._rollbackLog.push(() => {\n      rawObjectStore.deleted = true;\n      this.objectStoreNames = new FakeDOMStringList(...objectStoreNames);\n      transaction.objectStoreNames = new FakeDOMStringList(...transactionObjectStoreNames);\n      transaction._scope.delete(rawObjectStore.name);\n      this._rawDatabase.rawObjectStores.delete(rawObjectStore.name);\n    });\n    return transaction.objectStore(name);\n  }\n\n  // https://www.w3.org/TR/IndexedDB/#dom-idbdatabase-deleteobjectstore\n  deleteObjectStore(name) {\n    if (name === undefined) {\n      throw new TypeError();\n    }\n    const transaction = confirmActiveVersionchangeTransaction(this);\n\n    // Let store be the object store named name in database, or throw a \"NotFoundError\" DOMException if none.\n    const store = this._rawDatabase.rawObjectStores.get(name);\n    if (store === undefined) {\n      throw new NotFoundError();\n    }\n\n    // Remove store from thiss object store set.\n    // This method synchronously modifies the objectStoreNames property on the IDBDatabase instance on which it was called.\n    this.objectStoreNames = new FakeDOMStringList(...Array.from(this.objectStoreNames).filter(objectStoreName => {\n      return objectStoreName !== name;\n    }));\n    transaction.objectStoreNames = new FakeDOMStringList(...this.objectStoreNames);\n\n    // If there is an object store handle associated with store and transaction, remove all entries from its index set.\n    const objectStore = transaction._objectStoresCache.get(name);\n    let prevIndexNames;\n    if (objectStore) {\n      prevIndexNames = [...objectStore.indexNames];\n      objectStore.indexNames = new FakeDOMStringList();\n    }\n    transaction._rollbackLog.push(() => {\n      store.deleted = false;\n      this._rawDatabase.rawObjectStores.set(store.name, store);\n      this.objectStoreNames._push(store.name);\n      transaction.objectStoreNames._push(store.name);\n      this.objectStoreNames._sort();\n      if (objectStore && prevIndexNames) {\n        objectStore.indexNames = new FakeDOMStringList(...prevIndexNames);\n      }\n    });\n\n    // Destroy store.\n    store.deleted = true;\n    this._rawDatabase.rawObjectStores.delete(name);\n    transaction._objectStoresCache.delete(name);\n  }\n  transaction(storeNames, mode, options) {\n    mode = mode !== undefined ? mode : \"readonly\";\n    if (mode !== \"readonly\" && mode !== \"readwrite\" && mode !== \"versionchange\") {\n      throw new TypeError(\"Invalid mode: \" + mode);\n    }\n    const hasActiveVersionchange = this._rawDatabase.transactions.some(transaction => {\n      return transaction._state === \"active\" && transaction.mode === \"versionchange\" && transaction.db === this;\n    });\n    if (hasActiveVersionchange) {\n      throw new InvalidStateError();\n    }\n    if (this._closePending) {\n      throw new InvalidStateError();\n    }\n    if (!Array.isArray(storeNames)) {\n      storeNames = [storeNames];\n    }\n    if (storeNames.length === 0 && mode !== \"versionchange\") {\n      throw new InvalidAccessError();\n    }\n    for (const storeName of storeNames) {\n      if (!this.objectStoreNames.contains(storeName)) {\n        throw new NotFoundError(\"No objectStore named \" + storeName + \" in this database\");\n      }\n    }\n\n    // the actual algo is more complex but this passes the IDB tests: https://webidl.spec.whatwg.org/#es-dictionary\n    const durability = options?.durability ?? \"default\";\n    // invalid enums throw a TypeError: https://webidl.spec.whatwg.org/#es-enumeration\n    if (durability !== \"default\" && durability !== \"strict\" && durability !== \"relaxed\") {\n      throw new TypeError(\n      // based on Firefox's error message\n      `'${durability}' (value of 'durability' member of IDBTransactionOptions) ` + `is not a valid value for enumeration IDBTransactionDurability`);\n    }\n    const tx = new FDBTransaction(storeNames, mode, durability, this);\n    this._rawDatabase.transactions.push(tx);\n    this._rawDatabase.processTransactions(); // See if can start right away (async)\n\n    return tx;\n  }\n  close() {\n    closeConnection(this);\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBDatabase\";\n  }\n}\nexport default FDBDatabase;","import FDBRequest from \"./FDBRequest.js\";\nclass FDBOpenDBRequest extends FDBRequest {\n  onupgradeneeded = null;\n  onblocked = null;\n  get [Symbol.toStringTag]() {\n    return \"IDBOpenDBRequest\";\n  }\n}\nexport default FDBOpenDBRequest;","import FakeEvent from \"./lib/FakeEvent.js\";\nclass FDBVersionChangeEvent extends FakeEvent {\n  constructor(type, parameters = {}) {\n    super(type);\n    this.newVersion = parameters.newVersion !== undefined ? parameters.newVersion : null;\n    this.oldVersion = parameters.oldVersion !== undefined ? parameters.oldVersion : 0;\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBVersionChangeEvent\";\n  }\n}\nexport default FDBVersionChangeEvent;","/**\n * Minimal polyfill of `Set.prototype.intersection`, available in Node 22+.\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set/intersection\n * @param set1\n * @param set2\n */\nexport function intersection(set1, set2) {\n  if (\"intersection\" in set1) {\n    return set1.intersection(set2);\n  }\n  return new Set([...set1].filter(item => set2.has(item)));\n}","import { queueTask } from \"./scheduling.js\";\nimport { intersection } from \"./intersection.js\";\n// http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#dfn-database\nclass Database {\n  transactions = [];\n  rawObjectStores = new Map();\n  connections = [];\n  constructor(name, version) {\n    this.name = name;\n    this.version = version;\n    this.processTransactions = this.processTransactions.bind(this);\n  }\n  processTransactions() {\n    queueTask(() => {\n      const running = this.transactions.filter(transaction => transaction._started && transaction._state !== \"finished\");\n      const waiting = this.transactions.filter(transaction => !transaction._started && transaction._state !== \"finished\");\n\n      // The next transaction to run is the first waiting one that doesn't overlap with either a running one or a\n      // preceding waiting one. This allows non-overlapping transactions to run in parallel.\n      // The exception is readonly transactions, which are allowed to run in parallel with other readonly\n      // transactions, even with overlapping scopes, since no data is being modified.\n      const next = waiting.find((transaction, i) => {\n        const anyRunning = running.some(other => !(transaction.mode === \"readonly\" && other.mode === \"readonly\") && intersection(other._scope, transaction._scope).size > 0);\n        if (anyRunning) {\n          return false;\n        }\n\n        // If any _preceding_ waiting transactions are blocked, then that's also blocking.\n        // E.g. if you have 3 transactions: [a], [a,b], and [b,c], then [a] blocks [a,b] which blocks [b,c]\n        // until [a] is complete, even though [a] and [b,c] share no overlap.\n        // Note that readonly transactions do not have to be handled as a special case here,\n        // because if any transactions with overlapping scopes are blocked, then we can assume they are\n        const anyWaiting = waiting.slice(0, i).some(other => intersection(other._scope, transaction._scope).size > 0);\n        return !anyWaiting;\n      });\n      if (next) {\n        next.addEventListener(\"complete\", this.processTransactions);\n        next.addEventListener(\"abort\", this.processTransactions);\n        next._start();\n      }\n    });\n  }\n}\nexport default Database;","// WebIDL requires passing the right number of non-optional arguments, e.g. IDBFactory.open() must have at least 1 arg\nexport function validateRequiredArguments(numArguments, expectedNumArguments, methodName) {\n  if (numArguments < expectedNumArguments) {\n    // imitate Firefox's error message\n    throw new TypeError(`${methodName}: At least ${expectedNumArguments} ${expectedNumArguments === 1 ? \"argument\" : \"arguments\"} ` + `required, but only ${arguments.length} passed`);\n  }\n}","import FDBDatabase from \"./FDBDatabase.js\";\nimport FDBOpenDBRequest from \"./FDBOpenDBRequest.js\";\nimport FDBVersionChangeEvent from \"./FDBVersionChangeEvent.js\";\nimport cmp from \"./lib/cmp.js\";\nimport Database from \"./lib/Database.js\";\nimport enforceRange from \"./lib/enforceRange.js\";\nimport { AbortError, VersionError } from \"./lib/errors.js\";\nimport FakeEvent from \"./lib/FakeEvent.js\";\nimport { queueTask } from \"./lib/scheduling.js\";\nimport { validateRequiredArguments } from \"./lib/validateRequiredArguments.js\";\n// https://w3c.github.io/IndexedDB/#connection-queue\nconst runTaskInConnectionQueue = (connectionQueues, name, task) => {\n  // Let queue be the connection queue for storageKey and name.\n  // (note FakeIndexedDB does not support storageKeys currently)\n  // Add request to queue.\n  // Wait until all previous requests in queue have been processed.\n  const queue = connectionQueues.get(name) ?? Promise.resolve();\n  connectionQueues.set(name, queue.then(task));\n};\nconst waitForOthersClosedDelete = (databases, name, openDatabases, cb) => {\n  const anyOpen = openDatabases.some(openDatabase2 => {\n    return !openDatabase2._closed && !openDatabase2._closePending;\n  });\n  if (anyOpen) {\n    queueTask(() => waitForOthersClosedDelete(databases, name, openDatabases, cb));\n    return;\n  }\n  databases.delete(name);\n  cb(null);\n};\n\n// https://w3c.github.io/IndexedDB/#delete-a-database\nconst deleteDatabase = (databases, connectionQueues, name, request, cb) => {\n  const deleteDBTask = () => {\n    return new Promise(resolve => {\n      const db = databases.get(name);\n      const oldVersion = db !== undefined ? db.version : 0;\n      const onComplete = err => {\n        try {\n          if (err) {\n            cb(err);\n          } else {\n            cb(null, oldVersion);\n          }\n        } finally {\n          resolve();\n        }\n      };\n      try {\n        const db = databases.get(name);\n        if (db === undefined) {\n          onComplete(null);\n          return;\n        }\n\n        // Let openConnections be the set of all connections associated with db.\n        const openConnections = db.connections.filter(connection => {\n          return !connection._closed;\n        });\n\n        // For each entry of openConnections that does not have its close pending flag set to true, queue a\n        // database task to fire a version change event named versionchange at entry with dbs version and null.\n        for (const openDatabase2 of openConnections) {\n          if (!openDatabase2._closePending) {\n            queueTask(() => {\n              const event = new FDBVersionChangeEvent(\"versionchange\", {\n                newVersion: null,\n                oldVersion: db.version\n              });\n              openDatabase2.dispatchEvent(event);\n            });\n          }\n        }\n\n        // Wait for all of the events to be fired. (i.e. queue a task)\n        queueTask(() => {\n          // If any of the connections in openConnections are still not closed, queue a database task to\n          // fire a version change event named blocked at request with dbs version and null.\n\n          const anyOpen = openConnections.some(openDatabase3 => {\n            return !openDatabase3._closed && !openDatabase3._closePending;\n          });\n\n          // If any of the connections in openConnections are still not closed, queue a database task to\n          // fire a version change event named blocked at request with dbs version and null.\n          if (anyOpen) {\n            queueTask(() => {\n              const event = new FDBVersionChangeEvent(\"blocked\", {\n                newVersion: null,\n                oldVersion: db.version\n              });\n              request.dispatchEvent(event);\n            });\n          }\n\n          // Wait until all connections in openConnections are closed.\n          waitForOthersClosedDelete(databases, name, openConnections, onComplete);\n        });\n      } catch (err) {\n        onComplete(err);\n      }\n    });\n  };\n  runTaskInConnectionQueue(connectionQueues, name, deleteDBTask);\n};\n\n// https://w3c.github.io/IndexedDB/#ref-for-database-version%E2%91%A0%E2%91%A2\nconst runVersionchangeTransaction = (connection, version, request, cb) => {\n  connection._runningVersionchangeTransaction = true;\n  const oldVersion = connection._oldVersion = connection.version;\n\n  // Let openConnections be the set of all connections, except connection, associated with db.\n  const openConnections = connection._rawDatabase.connections.filter(otherDatabase => {\n    return connection !== otherDatabase;\n  });\n\n  // For each entry of openConnections that does not have its close pending flag set to true, queue a\n  // database task to fire a version change event named versionchange at entry with dbs version and version.\n  for (const openDatabase2 of openConnections) {\n    if (!openDatabase2._closed && !openDatabase2._closePending) {\n      queueTask(() => {\n        const event = new FDBVersionChangeEvent(\"versionchange\", {\n          newVersion: version,\n          oldVersion\n        });\n        openDatabase2.dispatchEvent(event);\n      });\n    }\n  }\n\n  // Wait for all of the events to be fired.\n  // (i.e. queue a task)\n  queueTask(() => {\n    const anyOpen = openConnections.some(openDatabase3 => {\n      return !openDatabase3._closed && !openDatabase3._closePending;\n    });\n\n    // If any of the connections in openConnections are still not closed, queue a database task to fire a version change event named blocked at request with dbs version and version.\n    if (anyOpen) {\n      queueTask(() => {\n        const event = new FDBVersionChangeEvent(\"blocked\", {\n          newVersion: version,\n          oldVersion\n        });\n        request.dispatchEvent(event);\n      });\n    }\n\n    // Wait until all connections in openConnections are closed.\n    const waitForOthersClosed = () => {\n      const anyOpen2 = openConnections.some(openDatabase2 => {\n        return !openDatabase2._closed && !openDatabase2._closePending;\n      });\n      if (anyOpen2) {\n        queueTask(waitForOthersClosed);\n        return;\n      }\n\n      // Set the version of database to version. This change is considered part of the transaction, and so if the\n      // transaction is aborted, this change is reverted.\n      connection._rawDatabase.version = version;\n      connection.version = version;\n\n      // Get rid of this setImmediate?\n      const transaction = connection.transaction(Array.from(connection.objectStoreNames), \"versionchange\");\n\n      // associate the transaction with the open request for later lookup\n      transaction._openRequest = request;\n\n      // https://w3c.github.io/IndexedDB/#upgrade-a-database\n      // Set requests result to connection.\n      request.result = connection;\n      // Set requests done flag to true.\n      request.readyState = \"done\";\n      // Set requests transaction to transaction.\n      request.transaction = transaction;\n      transaction._rollbackLog.push(() => {\n        connection._rawDatabase.version = oldVersion;\n        connection.version = oldVersion;\n      });\n\n      // Set transactions state to active.\n      transaction._state = \"active\";\n\n      // Let didThrow be the result of firing a version change event named upgradeneeded at request with old version and version.\n      const event = new FDBVersionChangeEvent(\"upgradeneeded\", {\n        newVersion: version,\n        oldVersion\n      });\n      let didThrow = false;\n      try {\n        request.dispatchEvent(event);\n      } catch (_err) {\n        didThrow = true;\n      }\n      const concludeUpgrade = () => {\n        // If transactions state is active, then:\n        if (transaction._state === \"active\") {\n          // Set transactions state to inactive.\n          transaction._state = \"inactive\";\n          if (didThrow) {\n            // If didThrow is true, run abort a transaction with transaction and a newly created \"AbortError\" DOMException.\n            transaction._abort(\"AbortError\");\n          }\n        }\n      };\n\n      // The \"upgrade a database\" steps are supposed to run as a database task on the database access task source\n      // (i.e. off the main thread), but since we're actually running on the main thread, we have to be tricky:\n      // 1. If any `upgradeneeded` event handlers errored, abort synchronously\n      // 2. Else yield to allow any microtasks to run in response to that event\n      if (didThrow) {\n        concludeUpgrade();\n      } else {\n        queueTask(concludeUpgrade);\n      }\n      transaction._prioritizedListeners.set(\"error\", () => {\n        connection._runningVersionchangeTransaction = false;\n        connection._oldVersion = undefined;\n        // throw arguments[0].target.error;\n        // console.log(\"error in versionchange transaction - not sure if anything needs to be done here\", e.target.error.name);\n      });\n      transaction._prioritizedListeners.set(\"abort\", () => {\n        connection._runningVersionchangeTransaction = false;\n        connection._oldVersion = undefined;\n        queueTask(() => {\n          // Reset transaction in a tick after onabort (upgrade-transaction-lifecycle-user-aborted.any)\n          request.transaction = null;\n          cb(new AbortError());\n        });\n      });\n      transaction._prioritizedListeners.set(\"complete\", () => {\n        connection._runningVersionchangeTransaction = false;\n        connection._oldVersion = undefined;\n        // Let other complete event handlers run before continuing\n        queueTask(() => {\n          // Reset transaction in a tick after oncomplete (upgrade-transaction-lifecycle-committed.any.js)\n          request.transaction = null;\n          if (connection._closePending) {\n            cb(new AbortError());\n          } else {\n            cb(null);\n          }\n        });\n      });\n    };\n    waitForOthersClosed();\n  });\n};\n\n// https://w3c.github.io/IndexedDB/#opening\nconst openDatabase = (databases, connectionQueues, name, version, request, cb) => {\n  const openDBTask = () => {\n    return new Promise(resolve => {\n      const onComplete = err => {\n        try {\n          if (err) {\n            // DO THIS HERE: ensure that connection is closed by running the steps for closing a database connection before these\n            // steps are aborted.\n            cb(err);\n          } else {\n            cb(null, connection);\n          }\n        } finally {\n          resolve();\n        }\n      };\n\n      // Let db be the database named name in storageKey, or null otherwise.\n      let db = databases.get(name);\n      if (db === undefined) {\n        // If db is null, let db be a new database with name `name`, version 0 (zero), and with no object stores.\n        db = new Database(name, 0);\n        databases.set(name, db);\n      }\n\n      // If version is undefined, let version be 1 if db is null, or dbs version otherwise.\n      if (version === undefined) {\n        version = db.version !== 0 ? db.version : 1;\n      }\n\n      // If dbs version is greater than version, return a newly created \"VersionError\" DOMException and abort these steps.\n      if (db.version > version) {\n        return onComplete(new VersionError());\n      }\n\n      // Let connection be a new connection to db.\n      const connection = new FDBDatabase(db);\n\n      // If dbs version is less than version, then:\n      if (db.version < version) {\n        // (run a version change transaction and resolve so that the next promise in the queue will execute)\n        runVersionchangeTransaction(connection, version, request, err => {\n          onComplete(err);\n        });\n      } else {\n        onComplete(null);\n      }\n    });\n  };\n  runTaskInConnectionQueue(connectionQueues, name, openDBTask);\n};\nclass FDBFactory {\n  _databases = new Map();\n  // https://w3c.github.io/IndexedDB/#connection-queue\n  _connectionQueues = new Map(); // promise chain as lightweight FIFO task queue\n\n  // https://w3c.github.io/IndexedDB/#dom-idbfactory-cmp\n  cmp(first, second) {\n    validateRequiredArguments(arguments.length, 2, \"IDBFactory.cmp\");\n    return cmp(first, second);\n  }\n\n  // https://w3c.github.io/IndexedDB/#dom-idbfactory-deletedatabase\n  deleteDatabase(name) {\n    validateRequiredArguments(arguments.length, 1, \"IDBFactory.deleteDatabase\");\n    const request = new FDBOpenDBRequest();\n    request.source = null;\n    queueTask(() => {\n      deleteDatabase(this._databases, this._connectionQueues, name, request, (err, oldVersion) => {\n        if (err) {\n          request.error = new DOMException(err.message, err.name);\n          request.readyState = \"done\";\n          const event = new FakeEvent(\"error\", {\n            bubbles: true,\n            cancelable: true\n          });\n          event.eventPath = [];\n          request.dispatchEvent(event);\n          return;\n        }\n        request.result = undefined;\n        request.readyState = \"done\";\n        const event2 = new FDBVersionChangeEvent(\"success\", {\n          newVersion: null,\n          oldVersion\n        });\n        request.dispatchEvent(event2);\n      });\n    });\n    return request;\n  }\n\n  // http://www.w3.org/TR/2015/REC-IndexedDB-20150108/#widl-IDBFactory-open-IDBOpenDBRequest-DOMString-name-unsigned-long-long-version\n  open(name, version) {\n    validateRequiredArguments(arguments.length, 1, \"IDBFactory.open\");\n    if (arguments.length > 1 && version !== undefined) {\n      // Based on spec, not sure why \"MAX_SAFE_INTEGER\" instead of \"unsigned long long\", but it's needed to pass\n      // tests\n      version = enforceRange(version, \"MAX_SAFE_INTEGER\");\n    }\n    if (version === 0) {\n      throw new TypeError(\"Database version cannot be 0\");\n    }\n    const request = new FDBOpenDBRequest();\n    request.source = null;\n    queueTask(() => {\n      openDatabase(this._databases, this._connectionQueues, name, version, request, (err, connection) => {\n        if (err) {\n          request.result = undefined;\n          request.readyState = \"done\";\n          request.error = new DOMException(err.message, err.name);\n          const event = new FakeEvent(\"error\", {\n            bubbles: true,\n            cancelable: true\n          });\n          event.eventPath = [];\n          request.dispatchEvent(event);\n          return;\n        }\n        request.result = connection;\n        request.readyState = \"done\";\n        const event2 = new FakeEvent(\"success\");\n        event2.eventPath = [];\n        request.dispatchEvent(event2);\n      });\n    });\n    return request;\n  }\n\n  // https://w3c.github.io/IndexedDB/#dom-idbfactory-databases\n  databases() {\n    return Promise.resolve(Array.from(this._databases.entries(), ([name, database]) => {\n      const activeVersionChangeConnection = database.connections.find(connection => connection._runningVersionchangeTransaction);\n      // If a versionchange is in progress, report the old version. See `get-databases.any.js` test:\n      // \"The result of databases() should contain the versions of databases at the time of calling,\n      // regardless of versionchange transactions currently running.\"\n      const version = activeVersionChangeConnection ? activeVersionChangeConnection._oldVersion : database.version;\n      return {\n        name,\n        version\n      };\n    }).filter(({\n      version\n    }) => {\n      // Ignore newly-created DBs with active versionchange transactions. See `get-databases.any.js` test:\n      // \"The result of databases() should be only those databases which have been created at the\n      // time of calling, regardless of versionchange transactions currently running.\"\n      return version > 0;\n    }));\n  }\n  get [Symbol.toStringTag]() {\n    return \"IDBFactory\";\n  }\n}\nexport default FDBFactory;","import FDBFactory from \"./FDBFactory.js\";\nconst fakeIndexedDB = new FDBFactory();\nexport default fakeIndexedDB;","import fakeIndexedDB from \"../build/esm/fakeIndexedDB.js\";\nimport FDBCursor from \"../build/esm/FDBCursor.js\";\nimport FDBCursorWithValue from \"../build/esm/FDBCursorWithValue.js\";\nimport FDBDatabase from \"../build/esm/FDBDatabase.js\";\nimport FDBFactory from \"../build/esm/FDBFactory.js\";\nimport FDBIndex from \"../build/esm/FDBIndex.js\";\nimport FDBKeyRange from \"../build/esm/FDBKeyRange.js\";\nimport FDBObjectStore from \"../build/esm/FDBObjectStore.js\";\nimport FDBOpenDBRequest from \"../build/esm/FDBOpenDBRequest.js\";\nimport FDBRecord from \"../build/esm/FDBRecord.js\";\nimport FDBRequest from \"../build/esm/FDBRequest.js\";\nimport FDBTransaction from \"../build/esm/FDBTransaction.js\";\nimport FDBVersionChangeEvent from \"../build/esm/FDBVersionChangeEvent.js\";\n\n// http://stackoverflow.com/a/33268326/786644 - works in browser, worker, and Node.js\nvar globalVar =\n    typeof window !== \"undefined\"\n        ? window\n        : typeof WorkerGlobalScope !== \"undefined\"\n          ? self\n          : typeof global !== \"undefined\"\n            ? global\n            : Function(\"return this;\")();\n\n// Partly match the native behavior for `globalThis.indexedDB`, `globalThis.IDBCursor`, etc.\n// Per the IDL, `indexedDB` is readonly but the others are readwrite. For us, though, we want it to still\n// be overwritable with `globalThis.<global> = ...`, so we make them all readwrite.\n// https://w3c.github.io/IndexedDB/#idl-index\nconst createPropertyDescriptor = (value) => {\n    return {\n        value,\n        enumerable: false,\n        configurable: true,\n        writable: true,\n    };\n};\n\nObject.defineProperties(globalVar, {\n    indexedDB: createPropertyDescriptor(fakeIndexedDB),\n    IDBCursor: createPropertyDescriptor(FDBCursor),\n    IDBCursorWithValue: createPropertyDescriptor(FDBCursorWithValue),\n    IDBDatabase: createPropertyDescriptor(FDBDatabase),\n    IDBFactory: createPropertyDescriptor(FDBFactory),\n    IDBIndex: createPropertyDescriptor(FDBIndex),\n    IDBKeyRange: createPropertyDescriptor(FDBKeyRange),\n    IDBObjectStore: createPropertyDescriptor(FDBObjectStore),\n    IDBOpenDBRequest: createPropertyDescriptor(FDBOpenDBRequest),\n    IDBRecord: createPropertyDescriptor(FDBRecord),\n    IDBRequest: createPropertyDescriptor(FDBRequest),\n    IDBTransaction: createPropertyDescriptor(FDBTransaction),\n    IDBVersionChangeEvent: createPropertyDescriptor(FDBVersionChangeEvent),\n});\n","import 'fake-indexeddb/auto';\r\n\r\n// pako global type is declared in global-pako.d.ts\r\n\r\n(globalThis as any).pako = {\r\n  gzip: (data: string | Uint8Array) => {\r\n    // just return Uint8Array of string bytes\r\n    if (typeof data === \"string\") {\r\n      return new TextEncoder().encode(data);\r\n    }\r\n    return new Uint8Array(data);\r\n  },\r\n  ungzip: (data: Uint8Array, options?: any) => {\r\n    if (options?.to === \"string\") {\r\n      return new TextDecoder().decode(data);\r\n    }\r\n    return data;\r\n  },\r\n};\r\n"],"names":["__webpack_require__","g","globalThis","this","Function","e","window","messages","setErrorCode","error","value","Object","defineProperty","writable","enumerable","configurable","AbortError","DOMException","constructor","message","super","ConstraintError","DataError","InvalidAccessError","InvalidStateError","NotFoundError","ReadOnlyError","SyntaxError","TransactionInactiveError","VersionError","isSharedArrayBuffer","input","SharedArrayBuffer","INVALID_TYPE","Symbol","INVALID_VALUE","valueToKeyWithoutThrowing","seen","isNaN","prototype","toString","call","ms","valueOf","Date","ArrayBuffer","isView","detached","byteLength","arrayBuffer","offset","length","buffer","byteOffset","slice","Array","isArray","undefined","Set","has","add","hasInvalid","keys","from","_","i","hasOwn","entry","key","result","getType","x","cmp","first","second","TypeError","t1","t2","Uint8Array","Math","min","getTime","FDBKeyRange","only","arguments","lowerBound","lower","open","upperBound","upper","bound","lowerOpen","upperOpen","cmpResult","includes","toStringTag","extractKey","keyPath","item","push","type","remainingKeyPath","object","identifier","indexOf","Blob","File","cloneValueForInsertion","transaction","_state","Error","structuredClone","getEffectiveObjectStore","cursor","source","objectStore","makeKeyRange","range","lowers","uppers","lowerTemp","upperTemp","FDBCursor","_gotValue","_position","_objectStorePosition","_keyOnly","_key","_primaryKey","direction","request","keyOnly","_range","_source","_direction","_request","val","primaryKey","_iterate","sourceIsObjectStore","records","_rawObjectStore","_rawIndex","foundRecord","record","values","cmpResultKey","cmpResultPosition","cmpResultPrimaryKey","tempRecord","get","getValue","update","effectiveObjectStore","effectiveKey","mode","deleted","clone","tempKey","err","_execRequestAsync","operation","storeRecord","bind","_rollbackLog","advance","count","Number","isInteger","readyState","continuePrimaryKey","cmpResult2","deleteRecord","FDBCursorWithValue","stopped","event","listener","immediatePropagationStopped","eventPhase","CAPTURING_PHASE","capture","BUBBLING_PHASE","invokeEventListeners","obj","currentTarget","errors","invoke","callbackOrObject","handleEvent","listeners","callback","prop","abort","blocked","close","complete","success","upgradeneeded","versionchange","AggregateError","addEventListener","options","removeEventListener","findIndex","splice","dispatchEvent","dispatched","initialized","isTrusted","target","eventPath","propagationStopped","AT_TARGET","bubbles","reverse","NONE","canceled","FDBRequest","_result","_error","onsuccess","onerror","FakeDOMStringList","_values","contains","iterator","_push","_sort","sort","nullDisallowedFlag","convertKey","getKeyPath","map","num","max","floor","queryOrOptions","numArguments","query","getAllOptions","confirmActiveTransaction","index","FDBIndex","rawIndex","_name","name","multiEntry","unique","db","_runningVersionchangeTransaction","String","indexNames","oldName","oldIndexNames","_indexesCache","delete","set","rawIndexes","filter","indexName","_createdIndexes","openCursor","openKeyCursor","getAll","getAllValues","getKey","getAllKeys","getAllRecords","identifiers","split","pop","FDBRecord","_value","MAX_TOMBSTONE_FACTOR","EVERYTHING_KEY_RANGE","BinarySearchTree","_numTombstones","_numNodes","keysAreUnique","_keysAreUnique","size","_getByComparator","_root","otherRecord","_compare","a","b","keyComparison","node","comparator","current","comparison","left","right","put","noOverwrite","_put","parent","red","_onNewNodeInserted","overwrittenRecord","_delete","_rebuild","descending","getRecords","keyRange","_getRecordsForNode","_findRecords","lowerComparison","upperComparison","moreLeft","moreRight","moreEnd","start","end","lowerMatches","upperMatches","newNode","_rebalanceTree","grandparent","parentIsRightChild","uncle","_rotateSubtree","newRoot","newChild","mid","next","newRecord","deletedRecords","deleteByValue","clear","previousValue","done","nextResult","rawObjectStore","Infinity","indexKey","keep","part","individualIndexKey","initialize","_abort","validateKeyPath","validIdentifierRegex","test","buildRecordAddPut","keyGenerator","FDBObjectStore","Map","autoIncrement","rawDatabase","rawObjectStores","oldObjectStoreNames","objectStoreNames","_objectStoresCache","objectStoreName","oldScope","_scope","oldTransactionObjectStoreNames","_createdObjectStores","createIndex","optionalParameters","index2","deleteIndex","rawIndex2","defaultPrevented","timeStamp","now","eventInitDict","cancelable","preventDefault","stopPropagation","stopImmediatePropagation","schedulerPostTask","scheduler","fn","postTask","doSetTimeout","setTimeout","queueTask","setImmediate","navigator","userAgent","outerRealmFunctionConstructor","Node","getSetImmediateFromJsdom","prioritizedListenerTypes","FDBTransaction","_started","_openRequest","onabort","oncomplete","_prioritizedListeners","_requests","storeNames","durability","errName","f","FakeEvent","_err","isUpgradeTransaction","_rawDatabase","connections","connection","transactions","objectStore2","_start","r","shift","defaultAction","commit","MAX_KEY","setIfLarger","rollbackLog","rollbackLogForThisOperation","rolledBack","keyGeneratorBefore","rollbackKeyGenerator","existingRecord","rollbackStoreRecord","rollback","closeConnection","forced","_closePending","every","_closed","otherConnection","confirmActiveVersionchangeTransaction","database","findLast","tx","FDBDatabase","version","createObjectStore","transactionObjectStoreNames","deleteObjectStore","store","prevIndexNames","some","storeName","processTransactions","FDBOpenDBRequest","onupgradeneeded","onblocked","FDBVersionChangeEvent","parameters","newVersion","oldVersion","intersection","set1","set2","running","waiting","find","other","validateRequiredArguments","expectedNumArguments","methodName","runTaskInConnectionQueue","connectionQueues","task","queue","Promise","resolve","then","waitForOthersClosedDelete","databases","openDatabases","cb","openDatabase2","openDatabase","onComplete","_oldVersion","openConnections","otherDatabase","openDatabase3","waitForOthersClosed","didThrow","concludeUpgrade","runVersionchangeTransaction","FDBFactory","_databases","_connectionQueues","deleteDatabase","event2","entries","activeVersionChangeConnection","globalVar","WorkerGlobalScope","self","createPropertyDescriptor","defineProperties","indexedDB","IDBCursor","IDBCursorWithValue","IDBDatabase","IDBFactory","IDBIndex","IDBKeyRange","IDBObjectStore","IDBOpenDBRequest","IDBRecord","IDBRequest","IDBTransaction","IDBVersionChangeEvent","pako","gzip","data","TextEncoder","encode","ungzip","to","TextDecoder","decode"],"ignoreList":[],"sourceRoot":""}