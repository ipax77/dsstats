var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t="A request was aborted, for example through a call to IDBTransaction.abort.",r="A mutation operation in the transaction failed because a constraint was not satisfied. For example, an object such as an object store or index already exists and a request attempted to create a new one.",u="Data provided to an operation does not meet requirements.",s="An invalid operation was performed on an object. For example transaction creation attempt was made, but an empty scope was provided.",n="An operation was called on an object on which it is not allowed or at a time when it is not allowed. Also occurs if a request is made on a source object that has been deleted or removed. Use TransactionInactiveError or ReadOnlyError when possible, as they are more specific variations of InvalidStateError.",o="The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",i='The mutating operation was attempted in a "readonly" transaction.',a="A request was placed against a transaction which is currently not active, or which is finished.",c="An attempt was made to open a database using a lower version than the existing version.",h=(e,t)=>{Object.defineProperty(e,"code",{value:t,writable:!1,enumerable:!0,configurable:!1})};class d extends DOMException{constructor(e=t){super(e,"AbortError")}}class l extends DOMException{constructor(e=r){super(e,"ConstraintError")}}DOMException;class A extends DOMException{constructor(e=u){super(e,"DataError"),h(this,0)}}class w extends DOMException{constructor(e=s){super(e,"InvalidAccessError")}}class f extends DOMException{constructor(e=n){super(e,"InvalidStateError"),h(this,11)}}class _ extends DOMException{constructor(e=o){super(e,"NotFoundError")}}class b extends DOMException{constructor(e=i){super(e,"ReadOnlyError")}}class y extends DOMException{constructor(e=c){super(e,"SyntaxError"),h(this,12)}}class p extends DOMException{constructor(e=a){super(e,"TransactionInactiveError"),h(this,0)}}class F extends DOMException{constructor(e=c){super(e,"VersionError")}}function D(e){return"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}const B=Symbol("INVALID_TYPE"),g=Symbol("INVALID_VALUE"),v=(e,t)=>{if("number"==typeof e)return isNaN(e)?g:e;if("[object Date]"===Object.prototype.toString.call(e)){const t=e.valueOf();return isNaN(t)?g:new Date(t)}if("string"==typeof e)return e;if(e instanceof ArrayBuffer||D(e)||"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)){if("detached"in e?e.detached:0===e.byteLength)return g;let t,r=0,u=0;return e instanceof ArrayBuffer||D(e)?(t=e,u=e.byteLength):(t=e.buffer,r=e.byteOffset,u=e.byteLength),t.slice(r,r+u)}if(Array.isArray(e)){if(void 0===t)t=new Set;else if(t.has(e))return g;t.add(e);let r=!1;const u=Array.from({length:e.length},(u,s)=>{if(r)return;if(!Object.hasOwn(e,s))return void(r=!0);const n=e[s],o=v(n,t);if(o!==g&&o!==B)return o;r=!0});return r?g:u}return B},C=v,E=(e,t)=>{const r=C(e,t);if(r===g||r===B)throw new A;return r},m=e=>{if("number"==typeof e)return"Number";if("[object Date]"===Object.prototype.toString.call(e))return"Date";if(Array.isArray(e))return"Array";if("string"==typeof e)return"String";if(e instanceof ArrayBuffer)return"Binary";throw new A},S=(e,t)=>{if(void 0===t)throw new TypeError;e=E(e),t=E(t);const r=m(e),u=m(t);if(r!==u)return"Array"===r?1:("Binary"!==r||"String"!==u&&"Date"!==u&&"Number"!==u)&&("String"!==r||"Date"!==u&&"Number"!==u)?"Date"===r&&"Number"===u?1:-1:1;if("Binary"===r&&(e=new Uint8Array(e),t=new Uint8Array(t)),"Array"===r||"Binary"===r){const r=Math.min(e.length,t.length);for(let u=0;u<r;u++){const r=S(e[u],t[u]);if(0!==r)return r}return e.length>t.length?1:e.length<t.length?-1:0}if("Date"===r){if(e.getTime()===t.getTime())return 0}else if(e===t)return 0;return e>t?1:-1},j=S;class x{static only(e){if(0===arguments.length)throw new TypeError;return e=E(e),new x(e,e,!1,!1)}static lowerBound(e,t=!1){if(0===arguments.length)throw new TypeError;return e=E(e),new x(e,void 0,t,!0)}static upperBound(e,t=!1){if(0===arguments.length)throw new TypeError;return e=E(e),new x(void 0,e,!0,t)}static bound(e,t,r=!1,u=!1){if(arguments.length<2)throw new TypeError;const s=j(e,t);if(1===s||0===s&&(r||u))throw new A;return e=E(e),t=E(t),new x(e,t,r,u)}constructor(e,t,r,u){this.lower=e,this.upper=t,this.lowerOpen=r,this.upperOpen=u}includes(e){if(0===arguments.length)throw new TypeError;if(e=E(e),void 0!==this.lower){const t=j(this.lower,e);if(1===t||0===t&&this.lowerOpen)return!1}if(void 0!==this.upper){const t=j(this.upper,e);if(-1===t||0===t&&this.upperOpen)return!1}return!0}get[Symbol.toStringTag](){return"IDBKeyRange"}}const k=x,O=(e,t)=>{if(Array.isArray(e)){const r=[];for(let u of e){null!=u&&"string"!=typeof u&&u.toString&&(u=u.toString());const e=O(u,t).key;r.push(E(e))}return{type:"found",key:r}}if(""===e)return{type:"found",key:t};let r=e,u=t;for(;null!==r;){let e;const t=r.indexOf(".");t>=0?(e=r.slice(0,t),r=r.slice(t+1)):(e=r,r=null);if(!("length"===e&&("string"==typeof u||Array.isArray(u))||("size"===e||"type"===e)&&"undefined"!=typeof Blob&&u instanceof Blob||("name"===e||"lastModified"===e)&&"undefined"!=typeof File&&u instanceof File||"object"==typeof u&&null!==u&&Object.hasOwn(u,e)))return{type:"notFound"};u=u[e]}return{type:"found",key:u}},I=O;function q(e,t){if("active"!==t._state)throw new Error("Assert: transaction state is active");t._state="inactive";try{return structuredClone(e)}finally{t._state="active"}}const T=e=>e.source instanceof _e?e.source:e.source.objectStore,N=(e,t,r)=>{let u=void 0!==e?e.lower:void 0,s=void 0!==e?e.upper:void 0;for(const e of t)void 0!==e&&(void 0!==u&&1!==j(u,e)||(u=e));for(const e of r)void 0!==e&&(void 0!==s&&-1!==j(s,e)||(s=e));return void 0!==u&&void 0!==s?k.bound(u,s):void 0!==u?k.lowerBound(u):void 0!==s?k.upperBound(s):void 0};class R{_gotValue=!1;_position=void 0;_objectStorePosition=void 0;_keyOnly=!1;_key=void 0;_primaryKey=void 0;constructor(e,t,r="next",u,s=!1){this._range=t,this._source=e,this._direction=r,this._request=u,this._keyOnly=s}get source(){return this._source}set source(e){}get request(){return this._request}set request(e){}get direction(){return this._direction}set direction(e){}get key(){return this._key}set key(e){}get primaryKey(){return this._primaryKey}set primaryKey(e){}_iterate(e,t){const r=this.source instanceof _e,u=this.source instanceof _e?this.source._rawObjectStore.records:this.source._rawIndex.records;let s,n;if("next"===this.direction){const n=N(this._range,[e,this._position],[]);for(const o of u.values(n)){const u=void 0!==e?j(o.key,e):void 0,n=void 0!==this._position?j(o.key,this._position):void 0;if(void 0===e||-1!==u){if(void 0!==t){if(-1===u)continue;const e=j(o.value,t);if(0===u&&-1===e)continue}if(void 0===this._position||!r||1===n){if(void 0!==this._position&&!r){if(-1===n)continue;if(0===n&&1!==j(o.value,this._objectStorePosition))continue}if(void 0===this._range||this._range.includes(o.key)){s=o;break}}}}}else if("nextunique"===this.direction){const t=N(this._range,[e,this._position],[]);for(const r of u.values(t))if((void 0===e||-1!==j(r.key,e))&&(void 0===this._position||1===j(r.key,this._position))&&(void 0===this._range||this._range.includes(r.key))){s=r;break}}else if("prev"===this.direction){const n=N(this._range,[],[e,this._position]);for(const o of u.values(n,"prev")){const u=void 0!==e?j(o.key,e):void 0,n=void 0!==this._position?j(o.key,this._position):void 0;if(void 0===e||1!==u){if(void 0!==t){if(1===u)continue;const e=j(o.value,t);if(0===u&&1===e)continue}if(void 0===this._position||!r||-1===n){if(void 0!==this._position&&!r){if(1===n)continue;if(0===n&&-1!==j(o.value,this._objectStorePosition))continue}if(void 0===this._range||this._range.includes(o.key)){s=o;break}}}}}else if("prevunique"===this.direction){let t;const r=N(this._range,[],[e,this._position]);for(const s of u.values(r,"prev"))if((void 0===e||1!==j(s.key,e))&&(void 0===this._position||-1===j(s.key,this._position))&&(void 0===this._range||this._range.includes(s.key))){t=s;break}t&&(s=u.get(t.key))}if(s){if(this._position=s.key,r||(this._objectStorePosition=s.value),this._key=s.key,r)this._primaryKey=structuredClone(s.key),this._keyOnly||"[object IDBCursorWithValue]"!==this.toString()||(this.value=structuredClone(s.value));else if(this._primaryKey=structuredClone(s.value),!this._keyOnly&&"[object IDBCursorWithValue]"===this.toString()){if(this.source instanceof _e)throw new Error("This should never happen");const e=this.source.objectStore._rawObjectStore.getValue(s.value);this.value=structuredClone(e)}this._gotValue=!0,n=this}else this._key=void 0,r||(this._objectStorePosition=void 0),this._keyOnly||"[object IDBCursorWithValue]"!==this.toString()||(this.value=void 0),n=null;return n}update(e){if(void 0===e)throw new TypeError;const t=T(this),r=Object.hasOwn(this.source,"_rawIndex")?this.primaryKey:this._position,u=t.transaction;if("active"!==u._state)throw new p;if("readonly"===u.mode)throw new b;if(t._rawObjectStore.deleted)throw new f;if(!(this.source instanceof _e)&&this.source._rawIndex.deleted)throw new f;if(!this._gotValue||!Object.hasOwn(this,"value"))throw new f;const s=q(e,u);if(null!==t.keyPath){let e;try{e=I(t.keyPath,s).key}catch(e){}if(0!==j(e,r))throw new A}const n={key:r,value:s};return u._execRequestAsync({operation:t._rawObjectStore.storeRecord.bind(t._rawObjectStore,n,!1,u._rollbackLog),source:this})}advance(e){if(!Number.isInteger(e)||e<=0)throw new TypeError;const t=T(this),r=t.transaction;if("active"!==r._state)throw new p;if(t._rawObjectStore.deleted)throw new f;if(!(this.source instanceof _e)&&this.source._rawIndex.deleted)throw new f;if(!this._gotValue)throw new f;this._request&&(this._request.readyState="pending"),r._execRequestAsync({operation:()=>{let t;for(let r=0;r<e&&(t=this._iterate(),t);r++);return t},request:this._request,source:this.source}),this._gotValue=!1}continue(e){const t=T(this),r=t.transaction;if("active"!==r._state)throw new p;if(t._rawObjectStore.deleted)throw new f;if(!(this.source instanceof _e)&&this.source._rawIndex.deleted)throw new f;if(!this._gotValue)throw new f;if(void 0!==e){e=E(e);const t=j(e,this._position);if(t<=0&&("next"===this.direction||"nextunique"===this.direction)||t>=0&&("prev"===this.direction||"prevunique"===this.direction))throw new A}this._request&&(this._request.readyState="pending"),r._execRequestAsync({operation:this._iterate.bind(this,e),request:this._request,source:this.source}),this._gotValue=!1}continuePrimaryKey(e,t){const r=T(this),u=r.transaction;if("active"!==u._state)throw new p;if(r._rawObjectStore.deleted)throw new f;if(!(this.source instanceof _e)&&this.source._rawIndex.deleted)throw new f;if(this.source instanceof _e||"next"!==this.direction&&"prev"!==this.direction)throw new w;if(!this._gotValue)throw new f;if(void 0===e||void 0===t)throw new A;e=E(e);const s=j(e,this._position);if(-1===s&&"next"===this.direction||1===s&&"prev"===this.direction)throw new A;const n=j(t,this._objectStorePosition);if(0===s&&(n<=0&&"next"===this.direction||n>=0&&"prev"===this.direction))throw new A;this._request&&(this._request.readyState="pending"),u._execRequestAsync({operation:this._iterate.bind(this,e,t),request:this._request,source:this.source}),this._gotValue=!1}delete(){const e=T(this),t=Object.hasOwn(this.source,"_rawIndex")?this.primaryKey:this._position,r=e.transaction;if("active"!==r._state)throw new p;if("readonly"===r.mode)throw new b;if(e._rawObjectStore.deleted)throw new f;if(!(this.source instanceof _e)&&this.source._rawIndex.deleted)throw new f;if(!this._gotValue||!Object.hasOwn(this,"value"))throw new f;return r._execRequestAsync({operation:e._rawObjectStore.deleteRecord.bind(e._rawObjectStore,t,r._rollbackLog),source:this})}get[Symbol.toStringTag](){return"IDBCursor"}}const P=R;class V extends P{value=void 0;constructor(e,t,r,u){super(e,t,r,u)}get[Symbol.toStringTag](){return"IDBCursorWithValue"}}const L=V,K=(e,t)=>e.immediatePropagationStopped||e.eventPhase===e.CAPTURING_PHASE&&!1===t.capture||e.eventPhase===e.BUBBLING_PHASE&&!0===t.capture,M=(e,t)=>{e.currentTarget=t;const r=[],u=t=>{try{("function"==typeof t?t:t.handleEvent).call(e.currentTarget,e)}catch(e){r.push(e)}};for(const r of t.listeners.slice())e.type!==r.type||K(e,r)||u(r.callback);const s={abort:"onabort",blocked:"onblocked",close:"onclose",complete:"oncomplete",error:"onerror",success:"onsuccess",upgradeneeded:"onupgradeneeded",versionchange:"onversionchange"}[e.type];if(void 0===s)throw new Error(`Unknown event type: "${e.type}"`);const n=e.currentTarget[s];if(n){const t={callback:n,capture:!1,type:e.type};K(e,t)||u(t.callback)}if(r.length)throw new AggregateError(r)};const z=class{listeners=[];addEventListener(e,t,r){const u=!!("object"==typeof r&&r?r.capture:r);this.listeners.push({callback:t,capture:u,type:e})}removeEventListener(e,t,r){const u=!!("object"==typeof r&&r?r.capture:r),s=this.listeners.findIndex(r=>r.type===e&&r.callback===t&&r.capture===u);this.listeners.splice(s,1)}dispatchEvent(e){if(e.dispatched||!e.initialized)throw new f("The object is in an invalid state.");e.isTrusted=!1,e.dispatched=!0,e.target=this,e.eventPhase=e.CAPTURING_PHASE;for(const t of e.eventPath)e.propagationStopped||M(e,t);if(e.eventPhase=e.AT_TARGET,e.propagationStopped||M(e,e.target),e.bubbles){e.eventPath.reverse(),e.eventPhase=e.BUBBLING_PHASE;for(const t of e.eventPath)e.propagationStopped||M(e,t)}return e.dispatched=!1,e.eventPhase=e.NONE,e.currentTarget=null,!e.canceled}};class G extends z{_result=null;_error=null;source=null;transaction=null;readyState="pending";onsuccess=null;onerror=null;get error(){if("pending"===this.readyState)throw new f;return this._error}set error(e){this._error=e}get result(){if("pending"===this.readyState)throw new f;return this._result}set result(e){this._result=e}get[Symbol.toStringTag](){return"IDBRequest"}}const U=G;class ${constructor(...e){this._values=e;for(let t=0;t<e.length;t++)this[t]=e[t]}contains(e){return this._values.includes(e)}item(e){return e<0||e>=this._values.length?null:this._values[e]}get length(){return this._values.length}[Symbol.iterator](){return this._values[Symbol.iterator]()}_push(...e){for(let t=0;t<e.length;t++)this[this._values.length+t]=e[t];this._values.push(...e)}_sort(...e){this._values.sort(...e);for(let e=0;e<this._values.length;e++)this[e]=this._values[e];return this}}const H=$,W=(e,t=!1)=>{if(e instanceof k)return e;if(null==e){if(t)throw new A;return new k(void 0,void 0,!1,!1)}const r=E(e);return k.only(r)},Q=e=>"object"==typeof e&&e?e+"":e;function Z(e){return Array.isArray(e)?e.map(Q):Q(e)}const X=e=>{if(e instanceof k)return!0;return C(e)!==B},Y=(e,t)=>{const r="unsigned long"===t?4294967295:9007199254740991;if(isNaN(e)||e<0||e>r)throw new TypeError;if(e>=0)return Math.floor(e)},J=(e,t,r)=>{let u,s;if(null==e||X(e))u=e,r>1&&void 0!==t&&(t=Y(t,"unsigned long"));else{const r=e;void 0!==r.query&&(u=r.query),void 0!==r.count&&(t=Y(r.count,"unsigned long")),void 0!==r.direction&&(s=r.direction)}return{query:u,count:t,direction:s}},ee=e=>{if(e._rawIndex.deleted||e.objectStore._rawObjectStore.deleted)throw new f;if("active"!==e.objectStore.transaction._state)throw new p};class te{constructor(e,t){this._rawIndex=t,this._name=t.name,this.objectStore=e,this.keyPath=Z(t.keyPath),this.multiEntry=t.multiEntry,this.unique=t.unique}get name(){return this._name}set name(e){const t=this.objectStore.transaction;if(!t.db._runningVersionchangeTransaction)throw"active"===t._state?new f:new p;if("active"!==t._state)throw new p;if(this._rawIndex.deleted||this.objectStore._rawObjectStore.deleted)throw new f;if((e=String(e))===this._name)return;if(this.objectStore.indexNames.contains(e))throw new l;const r=this._name,u=[...this.objectStore.indexNames];this._name=e,this._rawIndex.name=e,this.objectStore._indexesCache.delete(r),this.objectStore._indexesCache.set(e,this),this.objectStore._rawObjectStore.rawIndexes.delete(r),this.objectStore._rawObjectStore.rawIndexes.set(e,this._rawIndex),this.objectStore.indexNames=new H(...Array.from(this.objectStore._rawObjectStore.rawIndexes.keys()).filter(e=>{const t=this.objectStore._rawObjectStore.rawIndexes.get(e);return t&&!t.deleted}).sort()),this.objectStore.transaction._createdIndexes.has(this._rawIndex)||t._rollbackLog.push(()=>{this._name=r,this._rawIndex.name=r,this.objectStore._indexesCache.delete(e),this.objectStore._indexesCache.set(r,this),this.objectStore._rawObjectStore.rawIndexes.delete(e),this.objectStore._rawObjectStore.rawIndexes.set(r,this._rawIndex),this.objectStore.indexNames=new H(...u)})}openCursor(e,t){ee(this),null===e&&(e=void 0),void 0===e||e instanceof k||(e=k.only(E(e)));const r=new U;r.source=this,r.transaction=this.objectStore.transaction;const u=new L(this,e,t,r);return this.objectStore.transaction._execRequestAsync({operation:u._iterate.bind(u),request:r,source:this})}openKeyCursor(e,t){ee(this),null===e&&(e=void 0),void 0===e||e instanceof k||(e=k.only(E(e)));const r=new U;r.source=this,r.transaction=this.objectStore.transaction;const u=new P(this,e,t,r,!0);return this.objectStore.transaction._execRequestAsync({operation:u._iterate.bind(u),request:r,source:this})}get(e){return ee(this),e instanceof k||(e=E(e)),this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getValue.bind(this._rawIndex,e),source:this})}getAll(e,t){const r=J(e,t,arguments.length);ee(this);const u=W(r.query);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllValues.bind(this._rawIndex,u,r.count,r.direction),source:this})}getKey(e){return ee(this),e instanceof k||(e=E(e)),this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getKey.bind(this._rawIndex,e),source:this})}getAllKeys(e,t){const r=J(e,t,arguments.length);ee(this);const u=W(r.query);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllKeys.bind(this._rawIndex,u,r.count,r.direction),source:this})}getAllRecords(e){let t,r,u;void 0!==e&&(void 0!==e.query&&(t=e.query),void 0!==e.count&&(r=Y(e.count,"unsigned long")),void 0!==e.direction&&(u=e.direction)),ee(this);const s=W(t);return this.objectStore.transaction._execRequestAsync({operation:this._rawIndex.getAllRecords.bind(this._rawIndex,s,r,u),source:this})}count(e){return ee(this),null===e&&(e=void 0),void 0===e||e instanceof k||(e=k.only(E(e))),this.objectStore.transaction._execRequestAsync({operation:()=>this._rawIndex.count(e),source:this})}get[Symbol.toStringTag](){return"IDBIndex"}}const re=te,ue=(e,t)=>{if(Array.isArray(e))throw new Error("The key paths used in this section are always strings and never sequences, since it is not possible to create a object store which has a key generator and also has a key path that is a sequence.");const r=e.split(".");if(0===r.length)throw new Error("Assert: identifiers is not empty");r.pop();for(const e of r){if("object"!=typeof t&&!Array.isArray(t))return!1;if(!Object.hasOwn(t,e))return!0;t=t[e]}return"object"==typeof t||Array.isArray(t)};class se{constructor(e,t,r){this._key=e,this._primaryKey=t,this._value=r}get key(){return this._key}set key(e){}get primaryKey(){return this._primaryKey}set primaryKey(e){}get value(){return this._value}set value(e){}get[Symbol.toStringTag](){return"IDBRecord"}}const ne=se,oe=2/3,ie=new k(void 0,void 0,!1,!1);class ae{_numTombstones=0;_numNodes=0;constructor(e){this._keysAreUnique=!!e}size(){return this._numNodes-this._numTombstones}get(e){return this._getByComparator(this._root,t=>this._compare(e,t))}contains(e){return!!this.get(e)}_compare(e,t){const r=j(e.key,t.key);return 0!==r?r:this._keysAreUnique?0:j(e.value,t.value)}_getByComparator(e,t){let r=e;for(;r;){const e=t(r.record);if(e<0)r=r.left;else{if(!(e>0))return r.record;r=r.right}}}put(e,t=!1){return this._root?this._put(this._root,e,t):(this._root={record:e,left:void 0,right:void 0,parent:void 0,deleted:!1,red:!1},void this._numNodes++)}_put(e,t,r){const u=this._compare(t,e.record);if(u<0){if(e.left)return this._put(e.left,t,r);e.left={record:t,left:void 0,right:void 0,parent:e,deleted:!1,red:!0},this._onNewNodeInserted(e.left)}else if(u>0){if(e.right)return this._put(e.right,t,r);e.right={record:t,left:void 0,right:void 0,parent:e,deleted:!1,red:!0},this._onNewNodeInserted(e.right)}else{if(!e.deleted){if(r)throw new l;{const r=e.record;return e.record=t,r}}e.deleted=!1,e.record=t,this._numTombstones--}}delete(e){if(this._root&&(this._delete(this._root,e),this._numTombstones>this._numNodes*oe)){const e=[...this.getAllRecords()];this._root=this._rebuild(e,void 0,!1),this._numNodes=e.length,this._numTombstones=0}}_delete(e,t){if(!e)return;const r=this._compare(t,e.record);r<0?this._delete(e.left,t):r>0?this._delete(e.right,t):e.deleted||(this._numTombstones++,e.deleted=!0)}*getAllRecords(e=!1){yield*this.getRecords(ie,e)}*getRecords(e,t=!1){yield*this._getRecordsForNode(this._root,e,t)}*_getRecordsForNode(e,t,r=!1){e&&(yield*this._findRecords(e,t,r))}*_findRecords(e,t,r=!1){const{lower:u,upper:s,lowerOpen:n,upperOpen:o}=t,{record:{key:i}}=e,a=void 0===u?-1:j(u,i),c=void 0===s?1:j(s,i),h=this._keysAreUnique?a<0:a<=0,d=this._keysAreUnique?c>0:c>=0,l=r?h:d,A=r?"right":"left",w=r?"left":"right",f=n?a<0:a<=0,_=o?c>0:c>=0;(r?d:h)&&e[A]&&(yield*this._findRecords(e[A],t,r)),f&&_&&!e.deleted&&(yield e.record),l&&e[w]&&(yield*this._findRecords(e[w],t,r))}_onNewNodeInserted(e){this._numNodes++,this._rebalanceTree(e)}_rebalanceTree(e){let t=e.parent;do{if(!t.red)return;const r=t.parent;if(!r)return void(t.red=!1);const u=t===r.right,s=u?r.left:r.right;if(!s||!s.red)return e===(u?t.left:t.right)&&(this._rotateSubtree(t,u),e=t,t=u?r.right:r.left),this._rotateSubtree(r,!u),t.red=!1,void(r.red=!0);t.red=!1,s.red=!1,r.red=!0,e=r}while(e.parent&&(t=e.parent))}_rotateSubtree(e,t){const r=e.parent,u=t?e.left:e.right,s=t?u.right:u.left;return e[t?"left":"right"]=s,s&&(s.parent=e),u[t?"right":"left"]=e,u.parent=r,e.parent=u,r?r[e===r.right?"right":"left"]=u:this._root=u,u}_rebuild(e,t,r){const{length:u}=e;if(!u)return;const s=u>>>1,n={record:e[s],left:void 0,right:void 0,parent:t,deleted:!1,red:r},o=this._rebuild(e.slice(0,s),n,!r),i=this._rebuild(e.slice(s+1),n,!r);return n.left=o,n.right=i,n}}const ce=class{constructor(e){this.keysAreUnique=e,this.records=new ae(this.keysAreUnique)}get(e){const t=e instanceof k?e:k.only(e);return this.records.getRecords(t).next().value}put(e,t=!1){return this.records.put(e,t)}delete(e){const t=e instanceof k?e:k.only(e),r=[...this.records.getRecords(t)];for(const e of r)this.records.delete(e);return r}deleteByValue(e){const t=e instanceof k?e:k.only(e),r=[];for(const e of this.records.getAllRecords())t.includes(e.value)&&(this.records.delete(e),r.push(e));return r}clear(){const e=[...this.records.getAllRecords()];return this.records=new ae(this.keysAreUnique),e}values(e,t="next"){const r="prev"===t||"prevunique"===t,u=e?this.records.getRecords(e,r):this.records.getAllRecords(r);return{[Symbol.iterator]:()=>{const e=()=>u.next();if("next"===t||"prev"===t)return{next:e};if("nextunique"===t){let t;return{next:()=>{let r=e();for(;!r.done&&void 0!==t&&0===j(t.key,r.value.key);)r=e();return t=r.value,r}}}let r=e(),s=e();return{next:()=>{for(;!s.done&&0===j(r.value.key,s.value.key);)r=s,s=e();const t=r;return r=s,s=e(),t}}}}}size(){return this.records.size()}};const he=class{deleted=!1;initialized=!1;constructor(e,t,r,u,s){this.rawObjectStore=e,this.name=t,this.keyPath=r,this.multiEntry=u,this.unique=s,this.records=new ce(s)}getKey(e){const t=this.records.get(e);return void 0!==t?t.value:void 0}getAllKeys(e,t,r){void 0!==t&&0!==t||(t=1/0);const u=[];for(const s of this.records.values(e,r))if(u.push(structuredClone(s.value)),u.length>=t)break;return u}getValue(e){const t=this.records.get(e);return void 0!==t?this.rawObjectStore.getValue(t.value):void 0}getAllValues(e,t,r){void 0!==t&&0!==t||(t=1/0);const u=[];for(const s of this.records.values(e,r))if(u.push(this.rawObjectStore.getValue(s.value)),u.length>=t)break;return u}getAllRecords(e,t,r){void 0!==t&&0!==t||(t=1/0);const u=[];for(const s of this.records.values(e,r))if(u.push(new ne(structuredClone(s.key),structuredClone(this.rawObjectStore.getKey(s.value)),this.rawObjectStore.getValue(s.value))),u.length>=t)break;return u}storeRecord(e){let t;try{t=I(this.keyPath,e.value).key}catch(e){if("DataError"===e.name)return;throw e}if(this.multiEntry&&Array.isArray(t)){const e=[];for(const r of t)if(e.indexOf(r)<0)try{e.push(E(r))}catch(e){}t=e}else try{E(t)}catch(e){return}if(this.multiEntry&&Array.isArray(t)){if(this.unique)for(const e of t){if(this.records.get(e))throw new l}}else if(this.unique){if(this.records.get(t))throw new l}if(this.multiEntry&&Array.isArray(t))for(const r of t)this.records.put({key:r,value:e.key});else this.records.put({key:t,value:e.key})}initialize(e){if(this.initialized)throw new Error("Index already initialized");e._execRequestAsync({operation:()=>{try{for(const e of this.rawObjectStore.records.values())this.storeRecord(e);this.initialized=!0}catch(t){e._abort(t.name)}},source:null})}count(e){let t=0;for(const r of this.records.values(e))t+=1;return t}},de=(e,t)=>{if(null==e||"string"==typeof e||!e.toString||"array"!==t&&Array.isArray(e)||(e=e.toString()),"string"==typeof e){if(""===e&&"string"!==t)return;try{const t=/^(?:[$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])(?:[$0-9A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])*$/;if(e.length>=1&&t.test(e))return}catch(e){throw new y(e.message)}if(e.indexOf(" ")>=0)throw new y("The keypath argument contains an invalid key path (no spaces allowed).")}if(Array.isArray(e)&&e.length>0){if(t)throw new y("The keypath argument contains an invalid key path (nested arrays).");for(const t of e)de(t,"array")}else{if(!("string"==typeof e&&e.indexOf(".")>=0))throw new y;e=e.split(".");for(const t of e)de(t,"string")}},le=de,Ae=e=>{if(e._rawObjectStore.deleted)throw new f;if("active"!==e.transaction._state)throw new p},we=(e,t,r)=>{if(Ae(e),"readonly"===e.transaction.mode)throw new b;if(null!==e.keyPath&&void 0!==r)throw new A;const u=q(t,e.transaction);if(null!==e.keyPath){const t=I(e.keyPath,u);if("found"===t.type)E(t.key);else{if(!e._rawObjectStore.keyGenerator)throw new A;if(!ue(e.keyPath,u))throw new A}}if(null===e.keyPath&&null===e._rawObjectStore.keyGenerator&&void 0===r)throw new A;return void 0!==r&&(r=E(r)),{key:r,value:u}};class fe{_indexesCache=new Map;constructor(e,t){this._rawObjectStore=t,this._name=t.name,this.keyPath=Z(t.keyPath),this.autoIncrement=t.autoIncrement,this.transaction=e,this.indexNames=new H(...Array.from(t.rawIndexes.keys()).sort())}get name(){return this._name}set name(e){const t=this.transaction;if(!t.db._runningVersionchangeTransaction)throw"active"===t._state?new f:new p;if(Ae(this),(e=String(e))===this._name)return;if(this._rawObjectStore.rawDatabase.rawObjectStores.has(e))throw new l;const r=this._name,u=[...t.db.objectStoreNames];this._name=e,this._rawObjectStore.name=e,this.transaction._objectStoresCache.delete(r),this.transaction._objectStoresCache.set(e,this),this._rawObjectStore.rawDatabase.rawObjectStores.delete(r),this._rawObjectStore.rawDatabase.rawObjectStores.set(e,this._rawObjectStore),t.db.objectStoreNames=new H(...Array.from(this._rawObjectStore.rawDatabase.rawObjectStores.keys()).filter(e=>{const t=this._rawObjectStore.rawDatabase.rawObjectStores.get(e);return t&&!t.deleted}).sort());const s=new Set(t._scope),n=[...t.objectStoreNames];this.transaction._scope.delete(r),t._scope.add(e),t.objectStoreNames=new H(...Array.from(t._scope).sort()),this.transaction._createdObjectStores.has(this._rawObjectStore)||t._rollbackLog.push(()=>{this._name=r,this._rawObjectStore.name=r,this.transaction._objectStoresCache.delete(e),this.transaction._objectStoresCache.set(r,this),this._rawObjectStore.rawDatabase.rawObjectStores.delete(e),this._rawObjectStore.rawDatabase.rawObjectStores.set(r,this._rawObjectStore),t.db.objectStoreNames=new H(...u),t._scope=s,t.objectStoreNames=new H(...n)})}put(e,t){if(0===arguments.length)throw new TypeError;const r=we(this,e,t);return this.transaction._execRequestAsync({operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,r,!1,this.transaction._rollbackLog),source:this})}add(e,t){if(0===arguments.length)throw new TypeError;const r=we(this,e,t);return this.transaction._execRequestAsync({operation:this._rawObjectStore.storeRecord.bind(this._rawObjectStore,r,!0,this.transaction._rollbackLog),source:this})}delete(e){if(0===arguments.length)throw new TypeError;if(Ae(this),"readonly"===this.transaction.mode)throw new b;return e instanceof k||(e=E(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.deleteRecord.bind(this._rawObjectStore,e,this.transaction._rollbackLog),source:this})}get(e){if(0===arguments.length)throw new TypeError;return Ae(this),e instanceof k||(e=E(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.getValue.bind(this._rawObjectStore,e),source:this})}getAll(e,t){const r=J(e,t,arguments.length);Ae(this);const u=W(r.query);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllValues.bind(this._rawObjectStore,u,r.count,r.direction),source:this})}getKey(e){if(0===arguments.length)throw new TypeError;return Ae(this),e instanceof k||(e=E(e)),this.transaction._execRequestAsync({operation:this._rawObjectStore.getKey.bind(this._rawObjectStore,e),source:this})}getAllKeys(e,t){const r=J(e,t,arguments.length);Ae(this);const u=W(r.query);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllKeys.bind(this._rawObjectStore,u,r.count,r.direction),source:this})}getAllRecords(e){let t,r,u;void 0!==e&&(void 0!==e.query&&(t=e.query),void 0!==e.count&&(r=Y(e.count,"unsigned long")),void 0!==e.direction&&(u=e.direction)),Ae(this);const s=W(t);return this.transaction._execRequestAsync({operation:this._rawObjectStore.getAllRecords.bind(this._rawObjectStore,s,r,u),source:this})}clear(){if(Ae(this),"readonly"===this.transaction.mode)throw new b;return this.transaction._execRequestAsync({operation:this._rawObjectStore.clear.bind(this._rawObjectStore,this.transaction._rollbackLog),source:this})}openCursor(e,t){Ae(this),null===e&&(e=void 0),void 0===e||e instanceof k||(e=k.only(E(e)));const r=new U;r.source=this,r.transaction=this.transaction;const u=new L(this,e,t,r);return this.transaction._execRequestAsync({operation:u._iterate.bind(u),request:r,source:this})}openKeyCursor(e,t){Ae(this),null===e&&(e=void 0),void 0===e||e instanceof k||(e=k.only(E(e)));const r=new U;r.source=this,r.transaction=this.transaction;const u=new P(this,e,t,r,!0);return this.transaction._execRequestAsync({operation:u._iterate.bind(u),request:r,source:this})}createIndex(e,t,r={}){if(arguments.length<2)throw new TypeError;const u=void 0!==r.multiEntry&&r.multiEntry,s=void 0!==r.unique&&r.unique;if("versionchange"!==this.transaction.mode)throw new f;if(Ae(this),this.indexNames.contains(e))throw new l;if(le(t),Array.isArray(t)&&u)throw new w;const n=[...this.indexNames],o=new he(this._rawObjectStore,e,t,u,s);return this.indexNames._push(e),this.indexNames._sort(),this.transaction._createdIndexes.add(o),this._rawObjectStore.rawIndexes.set(e,o),o.initialize(this.transaction),this.transaction._rollbackLog.push(()=>{o.deleted=!0,this.indexNames=new H(...n),this._rawObjectStore.rawIndexes.delete(o.name)}),new re(this,o)}index(e){if(0===arguments.length)throw new TypeError;if(this._rawObjectStore.deleted||"finished"===this.transaction._state)throw new f;const t=this._indexesCache.get(e);if(void 0!==t)return t;const r=this._rawObjectStore.rawIndexes.get(e);if(!this.indexNames.contains(e)||void 0===r)throw new _;const u=new re(this,r);return this._indexesCache.set(e,u),u}deleteIndex(e){if(0===arguments.length)throw new TypeError;if("versionchange"!==this.transaction.mode)throw new f;Ae(this);const t=this._rawObjectStore.rawIndexes.get(e);if(void 0===t)throw new _;this.transaction._rollbackLog.push(()=>{t.deleted=!1,this._rawObjectStore.rawIndexes.set(t.name,t),this.indexNames._push(t.name),this.indexNames._sort()}),this.indexNames=new H(...Array.from(this.indexNames).filter(t=>t!==e)),t.deleted=!0,this.transaction._execRequestAsync({operation:()=>{const r=this._rawObjectStore.rawIndexes.get(e);t===r&&this._rawObjectStore.rawIndexes.delete(e)},source:this})}count(e){return Ae(this),null===e&&(e=void 0),void 0===e||e instanceof k||(e=k.only(E(e))),this.transaction._execRequestAsync({operation:()=>this._rawObjectStore.count(e),source:this})}get[Symbol.toStringTag](){return"IDBObjectStore"}}const _e=fe;const be=class{eventPath=[];NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;propagationStopped=!1;immediatePropagationStopped=!1;canceled=!1;initialized=!0;dispatched=!1;target=null;currentTarget=null;eventPhase=0;defaultPrevented=!1;isTrusted=!1;timeStamp=Date.now();constructor(e,t={}){this.type=e,this.bubbles=void 0!==t.bubbles&&t.bubbles,this.cancelable=void 0!==t.cancelable&&t.cancelable}preventDefault(){this.cancelable&&(this.canceled=!0)}stopPropagation(){this.propagationStopped=!0}stopImmediatePropagation(){this.propagationStopped=!0,this.immediatePropagationStopped=!0}};const ye="undefined"!=typeof scheduler&&(e=>scheduler.postTask(e)),pe=e=>setTimeout(e,0),Fe=e=>{(globalThis.setImmediate||function(){if("undefined"!=typeof navigator&&/jsdom/.test(navigator.userAgent))return new(0,Node.constructor)("return setImmediate")()}()||ye||pe)(e)},De=["error","abort","complete"];class Be extends z{_state="active";_started=!1;_rollbackLog=[];_objectStoresCache=new Map;_openRequest=null;error=null;onabort=null;oncomplete=null;onerror=null;_prioritizedListeners=new Map;_requests=[];_createdIndexes=new Set;_createdObjectStores=new Set;constructor(e,t,r,u){super(),this._scope=new Set(e),this.mode=t,this.durability=r,this.db=u,this.objectStoreNames=new H(...Array.from(this._scope).sort());for(const e of De)this.addEventListener(e,()=>{this._prioritizedListeners.get(e)?.()})}_abort(e){for(const e of this._rollbackLog.reverse())e();if(null!==e){const t=new DOMException(void 0,e);this.error=t}for(const{request:e}of this._requests)"done"!==e.readyState&&(e.readyState="done",e.source&&Fe(()=>{e.result=void 0,e.error=new d;const t=new be("error",{bubbles:!0,cancelable:!0});t.eventPath=[this.db,this];try{e.dispatchEvent(t)}catch(e){"active"===this._state&&this._abort("AbortError")}}));Fe(()=>{const e="versionchange"===this.mode;e&&(this.db._rawDatabase.connections=this.db._rawDatabase.connections.filter(e=>!e._rawDatabase.transactions.includes(this)));const t=new be("abort",{bubbles:!0,cancelable:!1});if(t.eventPath=[this.db],this.dispatchEvent(t),e){const e=this._openRequest;e.transaction=null,e.result=void 0}}),this._state="finished"}abort(){if("committing"===this._state||"finished"===this._state)throw new f;this._state="active",this._abort(null)}objectStore(e){if("active"!==this._state)throw new f;const t=this._objectStoresCache.get(e);if(void 0!==t)return t;const r=this.db._rawDatabase.rawObjectStores.get(e);if(!this._scope.has(e)||void 0===r)throw new _;const u=new _e(this,r);return this._objectStoresCache.set(e,u),u}_execRequestAsync(e){const t=e.source,r=e.operation;let u=Object.hasOwn(e,"request")?e.request:null;if("active"!==this._state)throw new p;return u||(t?(u=new U,u.source=t,u.transaction=t.transaction):u=new U),this._requests.push({operation:r,request:u}),u}_start(){let e,t;for(this._started=!0;this._requests.length>0;){const r=this._requests.shift();if(r&&"done"!==r.request.readyState){t=r.request,e=r.operation;break}}if(t&&e){if(t.source){let r,u;try{const r=e();t.readyState="done",t.result=r,t.error=void 0,"inactive"===this._state&&(this._state="active"),u=new be("success",{bubbles:!1,cancelable:!1})}catch(e){t.readyState="done",t.result=void 0,t.error=e,"inactive"===this._state&&(this._state="active"),u=new be("error",{bubbles:!0,cancelable:!0}),r=this._abort.bind(this,e.name)}try{u.eventPath=[this.db,this],t.dispatchEvent(u)}catch(e){"active"===this._state&&(this._abort("AbortError"),r=void 0)}u.canceled||r&&r()}else e();Fe(this._start.bind(this))}else if("finished"!==this._state&&(this._state="finished",!this.error)){const e=new be("complete");this.dispatchEvent(e)}}commit(){if("active"!==this._state)throw new f;this._state="committing"}get[Symbol.toStringTag](){return"IDBTransaction"}}const ge=Be,ve=9007199254740992;const Ce=class{num=0;next(){if(this.num>=ve)throw new l;return this.num+=1,this.num}setIfLarger(e){const t=Math.floor(Math.min(e,ve))-1;t>=this.num&&(this.num=t+1)}};const Ee=class{deleted=!1;records=new ce(!0);rawIndexes=new Map;constructor(e,t,r,u){this.rawDatabase=e,this.keyGenerator=!0===u?new Ce:null,this.deleted=!1,this.name=t,this.keyPath=r,this.autoIncrement=u}getKey(e){const t=this.records.get(e);return void 0!==t?structuredClone(t.key):void 0}getAllKeys(e,t,r){void 0!==t&&0!==t||(t=1/0);const u=[];for(const s of this.records.values(e,r))if(u.push(structuredClone(s.key)),u.length>=t)break;return u}getValue(e){const t=this.records.get(e);return void 0!==t?structuredClone(t.value):void 0}getAllValues(e,t,r){void 0!==t&&0!==t||(t=1/0);const u=[];for(const s of this.records.values(e,r))if(u.push(structuredClone(s.value)),u.length>=t)break;return u}getAllRecords(e,t,r){void 0!==t&&0!==t||(t=1/0);const u=[];for(const s of this.records.values(e,r))if(u.push(new ne(structuredClone(s.key),structuredClone(s.key),structuredClone(s.value))),u.length>=t)break;return u}storeRecord(e,t,r){if(null!==this.keyPath){const t=I(this.keyPath,e.value).key;void 0!==t&&(e.key=t)}const u=[];if(null!==this.keyGenerator&&void 0===e.key){let t=!1;const s=this.keyGenerator.num,n=()=>{t||(t=!0,this.keyGenerator&&(this.keyGenerator.num=s))};if(u.push(n),r&&r.push(n),e.key=this.keyGenerator.next(),null!==this.keyPath){if(Array.isArray(this.keyPath))throw new Error("Cannot have an array key path in an object store with a key generator");let t,r=this.keyPath,u=e.value,s=0;for(;s>=0;){if("object"!=typeof u)throw new A;s=r.indexOf("."),s>=0&&(t=r.slice(0,s),r=r.slice(s+1),Object.hasOwn(u,t)||Object.defineProperty(u,t,{configurable:!0,enumerable:!0,writable:!0,value:{}}),u=u[t])}t=r,Object.defineProperty(u,t,{configurable:!0,enumerable:!0,writable:!0,value:e.key})}}else null!==this.keyGenerator&&"number"==typeof e.key&&this.keyGenerator.setIfLarger(e.key);const s=this.records.put(e,t);let n=!1;const o=()=>{n||(n=!0,s?this.storeRecord(s,!1):this.deleteRecord(e.key))};if(u.push(o),r&&r.push(o),s)for(const t of this.rawIndexes.values())t.records.deleteByValue(e.key);try{for(const t of this.rawIndexes.values())t.initialized&&t.storeRecord(e)}catch(e){if("ConstraintError"===e.name)for(const e of u)e();throw e}return e.key}deleteRecord(e,t){const r=this.records.delete(e);if(t)for(const e of r)t.push(()=>{this.storeRecord(e,!0)});for(const t of this.rawIndexes.values())t.records.deleteByValue(e)}clear(e){const t=this.records.clear();if(e)for(const r of t)e.push(()=>{this.storeRecord(r,!0)});for(const e of this.rawIndexes.values())e.records.clear()}count(e){if(void 0===e||void 0===e.lower&&void 0===e.upper)return this.records.size();let t=0;for(const r of this.records.values(e))t+=1;return t}},me=(e,t=!1)=>{e._closePending=!0;if(e._rawDatabase.transactions.every(e=>"finished"===e._state)){if(e._closed=!0,e._rawDatabase.connections=e._rawDatabase.connections.filter(t=>e!==t),t){const t=new be("close",{bubbles:!1,cancelable:!1});t.eventPath=[],e.dispatchEvent(t)}}else Fe(()=>{me(e,t)})},Se=me,je=e=>{let t;if(e._runningVersionchangeTransaction&&(t=e._rawDatabase.transactions.findLast(e=>"versionchange"===e.mode)),!t)throw new f;if("active"!==t._state)throw new p;return t};class xe extends z{_closePending=!1;_closed=!1;_runningVersionchangeTransaction=!1;constructor(e){super(),this._rawDatabase=e,this._rawDatabase.connections.push(this),this.name=e.name,this.version=e.version,this.objectStoreNames=new H(...Array.from(e.rawObjectStores.keys()).sort())}createObjectStore(e,t={}){if(void 0===e)throw new TypeError;const r=je(this),u=null!==t&&void 0!==t.keyPath?t.keyPath:null,s=null!==t&&void 0!==t.autoIncrement&&t.autoIncrement;if(null!==u&&le(u),this._rawDatabase.rawObjectStores.has(e))throw new l;if(s&&(""===u||Array.isArray(u)))throw new w;const n=[...this.objectStoreNames],o=[...r.objectStoreNames],i=new Ee(this._rawDatabase,e,u,s);return this.objectStoreNames._push(e),this.objectStoreNames._sort(),r._scope.add(e),r._createdObjectStores.add(i),this._rawDatabase.rawObjectStores.set(e,i),r.objectStoreNames=new H(...this.objectStoreNames),r._rollbackLog.push(()=>{i.deleted=!0,this.objectStoreNames=new H(...n),r.objectStoreNames=new H(...o),r._scope.delete(i.name),this._rawDatabase.rawObjectStores.delete(i.name)}),r.objectStore(e)}deleteObjectStore(e){if(void 0===e)throw new TypeError;const t=je(this),r=this._rawDatabase.rawObjectStores.get(e);if(void 0===r)throw new _;this.objectStoreNames=new H(...Array.from(this.objectStoreNames).filter(t=>t!==e)),t.objectStoreNames=new H(...this.objectStoreNames);const u=t._objectStoresCache.get(e);let s;u&&(s=[...u.indexNames],u.indexNames=new H),t._rollbackLog.push(()=>{r.deleted=!1,this._rawDatabase.rawObjectStores.set(r.name,r),this.objectStoreNames._push(r.name),t.objectStoreNames._push(r.name),this.objectStoreNames._sort(),u&&s&&(u.indexNames=new H(...s))}),r.deleted=!0,this._rawDatabase.rawObjectStores.delete(e),t._objectStoresCache.delete(e)}transaction(e,t,r){if("readonly"!==(t=void 0!==t?t:"readonly")&&"readwrite"!==t&&"versionchange"!==t)throw new TypeError("Invalid mode: "+t);if(this._rawDatabase.transactions.some(e=>"active"===e._state&&"versionchange"===e.mode&&e.db===this))throw new f;if(this._closePending)throw new f;if(Array.isArray(e)||(e=[e]),0===e.length&&"versionchange"!==t)throw new w;for(const t of e)if(!this.objectStoreNames.contains(t))throw new _("No objectStore named "+t+" in this database");const u=r?.durability??"default";if("default"!==u&&"strict"!==u&&"relaxed"!==u)throw new TypeError(`'${u}' (value of 'durability' member of IDBTransactionOptions) is not a valid value for enumeration IDBTransactionDurability`);const s=new ge(e,t,u,this);return this._rawDatabase.transactions.push(s),this._rawDatabase.processTransactions(),s}close(){Se(this)}get[Symbol.toStringTag](){return"IDBDatabase"}}const ke=xe;class Oe extends U{onupgradeneeded=null;onblocked=null;get[Symbol.toStringTag](){return"IDBOpenDBRequest"}}const Ie=Oe;class qe extends be{constructor(e,t={}){super(e),this.newVersion=void 0!==t.newVersion?t.newVersion:null,this.oldVersion=void 0!==t.oldVersion?t.oldVersion:0}get[Symbol.toStringTag](){return"IDBVersionChangeEvent"}}const Te=qe;function Ne(e,t){return"intersection"in e?e.intersection(t):new Set([...e].filter(e=>t.has(e)))}const Re=class{transactions=[];rawObjectStores=new Map;connections=[];constructor(e,t){this.name=e,this.version=t,this.processTransactions=this.processTransactions.bind(this)}processTransactions(){Fe(()=>{const e=this.transactions.filter(e=>e._started&&"finished"!==e._state),t=this.transactions.filter(e=>!e._started&&"finished"!==e._state),r=t.find((r,u)=>{if(e.some(e=>!("readonly"===r.mode&&"readonly"===e.mode)&&Ne(e._scope,r._scope).size>0))return!1;return!t.slice(0,u).some(e=>Ne(e._scope,r._scope).size>0)});r&&(r.addEventListener("complete",this.processTransactions),r.addEventListener("abort",this.processTransactions),r._start())})}};function Pe(e,t,r){if(e<t)throw new TypeError(`${r}: At least ${t} ${1===t?"argument":"arguments"} required, but only ${arguments.length} passed`)}const Ve=(e,t,r)=>{const u=e.get(t)??Promise.resolve();e.set(t,u.then(r))},Le=(e,t,r,u)=>{r.some(e=>!e._closed&&!e._closePending)?Fe(()=>Le(e,t,r,u)):(e.delete(t),u(null))},Ke=(e,t,r,u,s,n)=>{Ve(t,r,()=>new Promise(t=>{const o=e=>{try{e?n(e):n(null,a)}finally{t()}};let i=e.get(r);if(void 0===i&&(i=new Re(r,0),e.set(r,i)),void 0===u&&(u=0!==i.version?i.version:1),i.version>u)return o(new F);const a=new ke(i);i.version<u?((e,t,r,u)=>{e._runningVersionchangeTransaction=!0;const s=e._oldVersion=e.version,n=e._rawDatabase.connections.filter(t=>e!==t);for(const e of n)e._closed||e._closePending||Fe(()=>{const r=new Te("versionchange",{newVersion:t,oldVersion:s});e.dispatchEvent(r)});Fe(()=>{n.some(e=>!e._closed&&!e._closePending)&&Fe(()=>{const e=new Te("blocked",{newVersion:t,oldVersion:s});r.dispatchEvent(e)});const o=()=>{if(n.some(e=>!e._closed&&!e._closePending))return void Fe(o);e._rawDatabase.version=t,e.version=t;const i=e.transaction(Array.from(e.objectStoreNames),"versionchange");i._openRequest=r,r.result=e,r.readyState="done",r.transaction=i,i._rollbackLog.push(()=>{e._rawDatabase.version=s,e.version=s}),i._state="active";const a=new Te("upgradeneeded",{newVersion:t,oldVersion:s});let c=!1;try{r.dispatchEvent(a)}catch(e){c=!0}const h=()=>{"active"===i._state&&(i._state="inactive",c&&i._abort("AbortError"))};c?h():Fe(h),i._prioritizedListeners.set("error",()=>{e._runningVersionchangeTransaction=!1,e._oldVersion=void 0}),i._prioritizedListeners.set("abort",()=>{e._runningVersionchangeTransaction=!1,e._oldVersion=void 0,Fe(()=>{r.transaction=null,u(new d)})}),i._prioritizedListeners.set("complete",()=>{e._runningVersionchangeTransaction=!1,e._oldVersion=void 0,Fe(()=>{r.transaction=null,e._closePending?u(new d):u(null)})})};o()})})(a,u,s,e=>{o(e)}):o(null)}))};class Me{_databases=new Map;_connectionQueues=new Map;cmp(e,t){return Pe(arguments.length,2,"IDBFactory.cmp"),j(e,t)}deleteDatabase(e){Pe(arguments.length,1,"IDBFactory.deleteDatabase");const t=new Ie;return t.source=null,Fe(()=>{((e,t,r,u,s)=>{Ve(t,r,()=>new Promise(t=>{const n=e.get(r),o=void 0!==n?n.version:0,i=e=>{try{e?s(e):s(null,o)}finally{t()}};try{const t=e.get(r);if(void 0===t)return void i(null);const s=t.connections.filter(e=>!e._closed);for(const e of s)e._closePending||Fe(()=>{const r=new Te("versionchange",{newVersion:null,oldVersion:t.version});e.dispatchEvent(r)});Fe(()=>{s.some(e=>!e._closed&&!e._closePending)&&Fe(()=>{const e=new Te("blocked",{newVersion:null,oldVersion:t.version});u.dispatchEvent(e)}),Le(e,r,s,i)})}catch(e){i(e)}}))})(this._databases,this._connectionQueues,e,t,(e,r)=>{if(e){t.error=new DOMException(e.message,e.name),t.readyState="done";const r=new be("error",{bubbles:!0,cancelable:!0});return r.eventPath=[],void t.dispatchEvent(r)}t.result=void 0,t.readyState="done";const u=new Te("success",{newVersion:null,oldVersion:r});t.dispatchEvent(u)})}),t}open(e,t){if(Pe(arguments.length,1,"IDBFactory.open"),arguments.length>1&&void 0!==t&&(t=Y(t,"MAX_SAFE_INTEGER")),0===t)throw new TypeError("Database version cannot be 0");const r=new Ie;return r.source=null,Fe(()=>{Ke(this._databases,this._connectionQueues,e,t,r,(e,t)=>{if(e){r.result=void 0,r.readyState="done",r.error=new DOMException(e.message,e.name);const t=new be("error",{bubbles:!0,cancelable:!0});return t.eventPath=[],void r.dispatchEvent(t)}r.result=t,r.readyState="done";const u=new be("success");u.eventPath=[],r.dispatchEvent(u)})}),r}databases(){return Promise.resolve(Array.from(this._databases.entries(),([e,t])=>{const r=t.connections.find(e=>e._runningVersionchangeTransaction);return{name:e,version:r?r._oldVersion:t.version}}).filter(({version:e})=>e>0))}get[Symbol.toStringTag](){return"IDBFactory"}}const ze=Me,Ge=new ze;var Ue="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:void 0!==e.g?e.g:Function("return this;")();const $e=e=>({value:e,enumerable:!1,configurable:!0,writable:!0});Object.defineProperties(Ue,{indexedDB:$e(Ge),IDBCursor:$e(P),IDBCursorWithValue:$e(L),IDBDatabase:$e(ke),IDBFactory:$e(ze),IDBIndex:$e(re),IDBKeyRange:$e(k),IDBObjectStore:$e(_e),IDBOpenDBRequest:$e(Ie),IDBRecord:$e(ne),IDBRequest:$e(U),IDBTransaction:$e(ge),IDBVersionChangeEvent:$e(Te)}),globalThis.pako={gzip:e=>"string"==typeof e?(new TextEncoder).encode(e):new Uint8Array(e),ungzip:(e,t)=>"string"===t?.to?(new TextDecoder).decode(e):e};
//# sourceMappingURL=setup.js.map