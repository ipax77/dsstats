var e={307(e,r,t){t.d(r,{P2:()=>a,ZZ:()=>o});const o={replays:"Replays",lists:"ReplayLists",meta:"ReplayMeta",config:"Config",directoryHandles:"DirectoryHandles"};let n=null;function a(){return new Promise((e,r)=>{if(n)return void e(n);const t=indexedDB.open("ReplayDB",3);t.onupgradeneeded=e=>{const r=e.target.result,t=e.target.transaction;for(let o=e.oldVersion;o<3;o++){const e=i[o];e?.schema&&e.schema(r,t)}},t.onsuccess=()=>{n=t.result,e(n)},t.onerror=()=>r(t.error)})}const s={schema:(e,r)=>{const t=e.objectStoreNames.contains(o.replays)?r.objectStore(o.replays):e.createObjectStore(o.replays,{keyPath:"replayHash"});t.indexNames.contains("gametime")||t.createIndex("gametime","gametime",{unique:!1});const n=e.objectStoreNames.contains(o.lists)?r.objectStore(o.lists):e.createObjectStore(o.lists,{keyPath:"replayHash"});if(n.indexNames.contains("gametime")||n.createIndex("gametime","gametime",{unique:!1}),n.indexNames.contains("gameMode")||n.createIndex("gameMode","gameMode",{unique:!1}),n.indexNames.contains("playerNames")||n.createIndex("playerNames","playerNames",{multiEntry:!0}),n.indexNames.contains("commandersTeam1")||n.createIndex("commandersTeam1","commandersTeam1",{multiEntry:!0}),n.indexNames.contains("commandersTeam2")||n.createIndex("commandersTeam2","commandersTeam2",{multiEntry:!0}),!e.objectStoreNames.contains(o.meta)){const r=e.createObjectStore(o.meta,{keyPath:"replayHash"});r.createIndex("uploaded","uploaded",{unique:!1}),r.createIndex("filePath","filePath",{unique:!1}),r.createIndex("skip","skip",{unique:!1})}e.objectStoreNames.contains(o.config)||e.createObjectStore(o.config)}},c={schema:(e,r)=>{e.objectStoreNames.contains(o.directoryHandles)||e.createObjectStore(o.directoryHandles)}},i={0:s,1:{data:e=>{const r=e.stores[o.meta];if(r)for(const e of r)"boolean"==typeof e.uploaded&&(e.uploaded=e.uploaded?1:0);const t=e.stores[o.lists];if(t)for(const e of t)e.playerNames||(e.playerNames=[]);return e.__meta.dbVersion=2,e}},2:c}}},r={};function t(o){var n=r[o];if(void 0!==n)return n.exports;var a=r[o]={exports:{}};return e[o](a,a.exports,t),a.exports}t.d=(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var o={};t.d(o,{LB:()=>a,SO:()=>c,Wm:()=>s,Xg:()=>i,sf:()=>d,xV:()=>l});var n=t(307);async function a(e,r){const t=await(0,n.P2)();return new Promise((o,a)=>{const s=t.transaction(n.ZZ.directoryHandles,"readwrite").objectStore(n.ZZ.directoryHandles).put(r,e);s.onsuccess=()=>o(),s.onerror=()=>a(s.error)})}async function s(e){const r=await(0,n.P2)();return new Promise(t=>{const o=r.transaction(n.ZZ.directoryHandles,"readonly").objectStore(n.ZZ.directoryHandles).get(e);o.onsuccess=()=>t(o.result??null),o.onerror=()=>t(null)})}async function c(){const e=await(0,n.P2)();return new Promise(r=>{const t=e.transaction(n.ZZ.directoryHandles,"readonly").objectStore(n.ZZ.directoryHandles).getAllKeys();t.onsuccess=()=>r(t.result),t.onerror=()=>r([])})}async function i(e){const r=await(0,n.P2)();return new Promise((t,o)=>{const a=r.transaction(n.ZZ.directoryHandles,"readwrite");a.objectStore(n.ZZ.directoryHandles).delete(e),a.oncomplete=()=>t(!0),a.onerror=()=>o(a.error)})}async function d(e,r="read"){if(!e)return!1;const t={mode:r};if("granted"===await(e.queryPermission?.(t)))return!0;return"granted"===await(e.requestPermission?.(t))}async function l(){if(!("showDirectoryPicker"in window))throw new Error("showDirectoryPicker is not supported in this browser. File selection requires a Chromium-based browser.");try{return await window.showDirectoryPicker()}catch(e){if("AbortError"===e?.name)return null;throw new Error(`Failed to pick directory: ${e?.message??e}`)}}const m=o.Xg,u=o.SO,y=o.Wm,p=o.xV,f=o.LB,w=o.sf;export{m as deleteDirectoryHandle,u as getAllDirectoryHandles,y as getDirectoryHandle,p as getDirectoryHandleFromUser,f as saveDirectoryHandle,w as verifyDirectoryPermission};
//# sourceMappingURL=file-handle-repository.js.map