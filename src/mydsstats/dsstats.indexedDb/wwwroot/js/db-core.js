var e={d:(a,t)=>{for(var o in t)e.o(t,o)&&!e.o(a,o)&&Object.defineProperty(a,o,{enumerable:!0,get:t[o]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)},a={};e.d(a,{$u:()=>t,G8:()=>o,OA:()=>i,P2:()=>r,R0:()=>m,R2:()=>c,ZZ:()=>n});const t="ReplayDB",o=3,n={replays:"Replays",lists:"ReplayLists",meta:"ReplayMeta",config:"Config",directoryHandles:"DirectoryHandles"};let s=null;function r(){return new Promise((e,a)=>{if(s)return void e(s);const n=indexedDB.open(t,o);n.onupgradeneeded=e=>{const a=e.target.result,t=e.target.transaction;for(let n=e.oldVersion;n<o;n++){const e=l[n];e?.schema&&e.schema(a,t)}},n.onsuccess=()=>{s=n.result,e(s)},n.onerror=()=>a(n.error)})}function c(){s&&(s.close(),s=null)}function i(e){let a=e.__meta.dbVersion;for(;a<o;){const t=l[a];t?.data?e=t.data(e):e.__meta.dbVersion=a+1,a=e.__meta.dbVersion}return e}const m={schema:(e,a)=>{const t=e.objectStoreNames.contains(n.replays)?a.objectStore(n.replays):e.createObjectStore(n.replays,{keyPath:"replayHash"});t.indexNames.contains("gametime")||t.createIndex("gametime","gametime",{unique:!1});const o=e.objectStoreNames.contains(n.lists)?a.objectStore(n.lists):e.createObjectStore(n.lists,{keyPath:"replayHash"});if(o.indexNames.contains("gametime")||o.createIndex("gametime","gametime",{unique:!1}),o.indexNames.contains("gameMode")||o.createIndex("gameMode","gameMode",{unique:!1}),o.indexNames.contains("playerNames")||o.createIndex("playerNames","playerNames",{multiEntry:!0}),o.indexNames.contains("commandersTeam1")||o.createIndex("commandersTeam1","commandersTeam1",{multiEntry:!0}),o.indexNames.contains("commandersTeam2")||o.createIndex("commandersTeam2","commandersTeam2",{multiEntry:!0}),!e.objectStoreNames.contains(n.meta)){const a=e.createObjectStore(n.meta,{keyPath:"replayHash"});a.createIndex("uploaded","uploaded",{unique:!1}),a.createIndex("filePath","filePath",{unique:!1}),a.createIndex("skip","skip",{unique:!1})}e.objectStoreNames.contains(n.config)||e.createObjectStore(n.config)}},d={schema:(e,a)=>{e.objectStoreNames.contains(n.directoryHandles)||e.createObjectStore(n.directoryHandles)}},l={0:m,1:{data:e=>{const a=e.stores[n.meta];if(a)for(const e of a)"boolean"==typeof e.uploaded&&(e.uploaded=e.uploaded?1:0);const t=e.stores[n.lists];if(t)for(const e of t)e.playerNames||(e.playerNames=[]);return e.__meta.dbVersion=2,e}},2:d},u=a.$u,p=a.G8,y=a.ZZ,f=a.R2,b=a.OA,g=a.R0,N=a.P2;export{u as DB_NAME,p as DB_VERSION,y as STORES,f as closeDB,b as migrateDump,g as migration0,N as openDB};